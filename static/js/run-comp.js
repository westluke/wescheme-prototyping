/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var COMPILED=false;var goog=goog||{};goog.global=this||self;goog.global.CLOSURE_UNCOMPILED_DEFINES;goog.global.CLOSURE_DEFINES;
goog.exportPath_=function(name,object,overwriteImplicit,objectToExportTo){var parts=name.split(".");var cur=objectToExportTo||goog.global;if(!(parts[0]in cur)&&typeof cur.execScript!="undefined")cur.execScript("var "+parts[0]);for(var part;parts.length&&(part=parts.shift());)if(!parts.length&&object!==undefined)if(!overwriteImplicit&&goog.isObject(object)&&goog.isObject(cur[part]))for(var prop in object){if(object.hasOwnProperty(prop))cur[part][prop]=object[prop]}else cur[part]=object;else if(cur[part]&&
cur[part]!==Object.prototype[part])cur=cur[part];else cur=cur[part]={}};
goog.define=function(name,defaultValue){var value=defaultValue;if(!COMPILED){var uncompiledDefines=goog.global.CLOSURE_UNCOMPILED_DEFINES;var defines=goog.global.CLOSURE_DEFINES;if(uncompiledDefines&&uncompiledDefines.nodeType===undefined&&Object.prototype.hasOwnProperty.call(uncompiledDefines,name))value=uncompiledDefines[name];else if(defines&&defines.nodeType===undefined&&Object.prototype.hasOwnProperty.call(defines,name))value=defines[name]}return value};
goog.FEATURESET_YEAR=goog.define("goog.FEATURESET_YEAR",2012);goog.DEBUG=goog.define("goog.DEBUG",true);goog.LOCALE=goog.define("goog.LOCALE","en");goog.TRUSTED_SITE=goog.define("goog.TRUSTED_SITE",true);goog.DISALLOW_TEST_ONLY_CODE=goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG);goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=goog.define("goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING",false);
goog.provide=function(name){if(goog.isInModuleLoader_())throw new Error("goog.provide cannot be used within a module.");if(!COMPILED)if(goog.isProvided_(name))throw new Error('Namespace "'+name+'" already declared.');goog.constructNamespace_(name)};
goog.constructNamespace_=function(name,object,overwriteImplicit){if(!COMPILED){delete goog.implicitNamespaces_[name];var namespace=name;while(namespace=namespace.substring(0,namespace.lastIndexOf("."))){if(goog.getObjectByName(namespace))break;goog.implicitNamespaces_[namespace]=true}}goog.exportPath_(name,object,overwriteImplicit)};goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/;
goog.getScriptNonce_=function(opt_window){var doc=(opt_window||goog.global).document;var script=doc.querySelector&&doc.querySelector("script[nonce]");if(script){var nonce=script["nonce"]||script.getAttribute("nonce");if(nonce&&goog.NONCE_PATTERN_.test(nonce))return nonce}return""};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;
goog.module=function(name){if(typeof name!=="string"||!name||name.search(goog.VALID_MODULE_RE_)==-1)throw new Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw new Error("Module "+name+" has been loaded incorrectly. Note, "+"modules cannot be loaded as normal scripts. They require some kind of "+"pre-processing step. You're likely trying to load a module via a "+"script tag or as a part of a concatenated bundle without rewriting the "+"module. For more info see: "+"https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");
if(goog.moduleLoaderState_.moduleName)throw new Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=name;if(!COMPILED){if(goog.isProvided_(name))throw new Error('Namespace "'+name+'" already declared.');delete goog.implicitNamespaces_[name]}};goog.module.get=function(name){return goog.module.getInternal_(name)};
goog.module.getInternal_=function(name){if(!COMPILED)if(name in goog.loadedModules_)return goog.loadedModules_[name].exports;else if(!goog.implicitNamespaces_[name]){var ns=goog.getObjectByName(name);return ns!=null?ns:null}return null};goog.ModuleType={ES6:"es6",GOOG:"goog"};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()};
goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG};goog.isInEs6ModuleLoader_=function(){var inLoader=!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6;if(inLoader)return true;var jscomp=goog.global["$jscomp"];if(jscomp){if(typeof jscomp.getCurrentModulePath!="function")return false;return!!jscomp.getCurrentModulePath()}return false};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInGoogModuleLoader_())throw new Error("goog.module.declareLegacyNamespace must be called from "+"within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw new Error("goog.module must be called prior to "+"goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=true};
goog.declareModuleId=function(namespace){if(!COMPILED){if(!goog.isInEs6ModuleLoader_())throw new Error("goog.declareModuleId may only be called from "+"within an ES6 module");if(goog.moduleLoaderState_&&goog.moduleLoaderState_.moduleName)throw new Error("goog.declareModuleId may only be called once per module.");if(namespace in goog.loadedModules_)throw new Error('Module with namespace "'+namespace+'" already exists.');}if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=namespace;else{var jscomp=
goog.global["$jscomp"];if(!jscomp||typeof jscomp.getCurrentModulePath!="function")throw new Error('Module with namespace "'+namespace+'" has been loaded incorrectly.');var exports=jscomp.require(jscomp.getCurrentModulePath());goog.loadedModules_[namespace]={exports:exports,type:goog.ModuleType.ES6,moduleId:namespace}}};
goog.setTestOnly=function(opt_message){if(goog.DISALLOW_TEST_ONLY_CODE){opt_message=opt_message||"";throw new Error("Importing test-only code into non-debug environment"+(opt_message?": "+opt_message:"."));}};goog.forwardDeclare=function(name){};goog.forwardDeclare("Document");goog.forwardDeclare("HTMLScriptElement");goog.forwardDeclare("XMLHttpRequest");
if(!COMPILED){goog.isProvided_=function(name){return name in goog.loadedModules_||!goog.implicitNamespaces_[name]&&goog.getObjectByName(name)!=null};goog.implicitNamespaces_={"goog.module":true}}goog.getObjectByName=function(name,opt_obj){var parts=name.split(".");var cur=opt_obj||goog.global;for(var i=0;i<parts.length;i++){cur=cur[parts[i]];if(cur==null)return null}return cur};
goog.addDependency=function(relPath,provides,requires,opt_loadFlags){if(!COMPILED&&goog.DEPENDENCIES_ENABLED)goog.debugLoader_.addDependency(relPath,provides,requires,opt_loadFlags)};goog.ENABLE_DEBUG_LOADER=goog.define("goog.ENABLE_DEBUG_LOADER",false);goog.logToConsole_=function(msg){if(goog.global.console)goog.global.console["error"](msg)};
goog.require=function(namespace){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER)goog.debugLoader_.requested(namespace);if(goog.isProvided_(namespace)){if(goog.isInModuleLoader_())return goog.module.getInternal_(namespace)}else if(goog.ENABLE_DEBUG_LOADER){var moduleLoaderState=goog.moduleLoaderState_;goog.moduleLoaderState_=null;try{goog.debugLoader_.load_(namespace)}finally{goog.moduleLoaderState_=moduleLoaderState}}return null}};goog.requireType=function(namespace){return{}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;
goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.abstractMethod=function(){throw new Error("unimplemented abstract method");};goog.addSingletonGetter=function(ctor){ctor.instance_=undefined;ctor.getInstance=function(){if(ctor.instance_)return ctor.instance_;if(goog.DEBUG)goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=ctor;return ctor.instance_=new ctor}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=goog.define("goog.LOAD_MODULE_USING_EVAL",true);
goog.SEAL_MODULE_EXPORTS=goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG);goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;goog.TRANSPILE=goog.define("goog.TRANSPILE","detect");goog.ASSUME_ES_MODULES_TRANSPILED=goog.define("goog.ASSUME_ES_MODULES_TRANSPILED",false);goog.TRUSTED_TYPES_POLICY_NAME=goog.define("goog.TRUSTED_TYPES_POLICY_NAME","goog");goog.hasBadLetScoping=null;
goog.loadModule=function(moduleDef){var previousState=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:false,type:goog.ModuleType.GOOG};var origExports={};var exports=origExports;if(typeof moduleDef==="function")exports=moduleDef.call(undefined,exports);else if(typeof moduleDef==="string")exports=goog.loadModuleFromSource_.call(undefined,exports,moduleDef);else throw new Error("Invalid module definition");var moduleName=goog.moduleLoaderState_.moduleName;if(typeof moduleName===
"string"&&moduleName){if(goog.moduleLoaderState_.declareLegacyNamespace){var isDefaultExport=origExports!==exports;goog.constructNamespace_(moduleName,exports,isDefaultExport)}else if(goog.SEAL_MODULE_EXPORTS&&Object.seal&&typeof exports=="object"&&exports!=null)Object.seal(exports);var data={exports:exports,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName};goog.loadedModules_[moduleName]=data}else throw new Error('Invalid module name "'+moduleName+'"');}finally{goog.moduleLoaderState_=
previousState}};goog.loadModuleFromSource_=function(exports){eval(goog.CLOSURE_EVAL_PREFILTER_.createScript(arguments[1]));return exports};goog.normalizePath_=function(path){var components=path.split("/");var i=0;while(i<components.length)if(components[i]==".")components.splice(i,1);else if(i&&components[i]==".."&&components[i-1]&&components[i-1]!="..")components.splice(--i,2);else i++;return components.join("/")};goog.global.CLOSURE_LOAD_FILE_SYNC;
goog.loadFileSync_=function(src){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(src);else try{var xhr=new goog.global["XMLHttpRequest"];xhr.open("get",src,false);xhr.send();return xhr.status==0||xhr.status==200?xhr.responseText:null}catch(err){return null}};goog.typeOf=function(value){var s=typeof value;if(s!="object")return s;if(!value)return"null";if(Array.isArray(value))return"array";return s};
goog.isArrayLike=function(val){var type=goog.typeOf(val);return type=="array"||type=="object"&&typeof val.length=="number"};goog.isDateLike=function(val){return goog.isObject(val)&&typeof val.getFullYear=="function"};goog.isObject=function(val){var type=typeof val;return type=="object"&&val!=null||type=="function"};goog.getUid=function(obj){return Object.prototype.hasOwnProperty.call(obj,goog.UID_PROPERTY_)&&obj[goog.UID_PROPERTY_]||(obj[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(obj){return!!obj[goog.UID_PROPERTY_]};
goog.removeUid=function(obj){if(obj!==null&&"removeAttribute"in obj)obj.removeAttribute(goog.UID_PROPERTY_);try{delete obj[goog.UID_PROPERTY_]}catch(ex){}};goog.UID_PROPERTY_="closure_uid_"+(Math.random()*1E9>>>0);goog.uidCounter_=0;
goog.cloneObject=function(obj){var type=goog.typeOf(obj);if(type=="object"||type=="array"){if(typeof obj.clone==="function")return obj.clone();if(typeof Map!=="undefined"&&obj instanceof Map)return new Map(obj);else if(typeof Set!=="undefined"&&obj instanceof Set)return new Set(obj);var clone=type=="array"?[]:{};for(var key in obj)clone[key]=goog.cloneObject(obj[key]);return clone}return obj};goog.bindNative_=function(fn,selfObj,var_args){return fn.call.apply(fn.bind,arguments)};
goog.bindJs_=function(fn,selfObj,var_args){if(!fn)throw new Error;if(arguments.length>2){var boundArgs=Array.prototype.slice.call(arguments,2);return function(){var newArgs=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(newArgs,boundArgs);return fn.apply(selfObj,newArgs)}}else return function(){return fn.apply(selfObj,arguments)}};
goog.bind=function(fn,selfObj,var_args){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1)goog.bind=goog.bindNative_;else goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(fn,var_args){var args=Array.prototype.slice.call(arguments,1);return function(){var newArgs=args.slice();newArgs.push.apply(newArgs,arguments);return fn.apply(this,newArgs)}};goog.now=function(){return Date.now()};goog.globalEval=function(script){(0,eval)(script)};
goog.cssNameMapping_;goog.cssNameMappingStyle_;goog.global.CLOSURE_CSS_NAME_MAP_FN;
goog.getCssName=function(className,opt_modifier){if(String(className).charAt(0)==".")throw new Error('className passed in goog.getCssName must not start with ".".'+" You passed: "+className);var getMapping=function(cssName){return goog.cssNameMapping_[cssName]||cssName};var renameByParts=function(cssName){var parts=cssName.split("-");var mapped=[];for(var i=0;i<parts.length;i++)mapped.push(getMapping(parts[i]));return mapped.join("-")};var rename;if(goog.cssNameMapping_)rename=goog.cssNameMappingStyle_==
"BY_WHOLE"?getMapping:renameByParts;else rename=function(a){return a};var result=opt_modifier?className+"-"+rename(opt_modifier):rename(className);if(goog.global.CLOSURE_CSS_NAME_MAP_FN)return goog.global.CLOSURE_CSS_NAME_MAP_FN(result);return result};goog.setCssNameMapping=function(mapping,opt_style){goog.cssNameMapping_=mapping;goog.cssNameMappingStyle_=opt_style};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING)goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING;
goog.GetMsgOptions=function(){};goog.GetMsgOptions.prototype.html;goog.GetMsgOptions.prototype.unescapeHtmlEntities;goog.GetMsgOptions.prototype.original_code;goog.GetMsgOptions.prototype.example;
goog.getMsg=function(str,opt_values,opt_options){if(opt_options&&opt_options.html)str=str.replace(/</g,"&lt;");if(opt_options&&opt_options.unescapeHtmlEntities)str=str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&");if(opt_values)str=str.replace(/\{\$([^}]+)}/g,function(match,key){return opt_values!=null&&key in opt_values?opt_values[key]:match});return str};goog.getMsgWithFallback=function(a,b){return a};
goog.exportSymbol=function(publicPath,object,objectToExportTo){goog.exportPath_(publicPath,object,true,objectToExportTo)};goog.exportProperty=function(object,publicName,symbol){object[publicName]=symbol};
goog.inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor;childCtor.prototype.constructor=childCtor;childCtor.base=function(me,methodName,var_args){var args=new Array(arguments.length-2);for(var i=2;i<arguments.length;i++)args[i-2]=arguments[i];return parentCtor.prototype[methodName].apply(me,args)}};
goog.scope=function(fn){if(goog.isInModuleLoader_())throw new Error("goog.scope is not supported within a module.");fn.call(goog.global)};if(!COMPILED)goog.global["COMPILED"]=COMPILED;
goog.defineClass=function(superClass,def){var constructor=def.constructor;var statics=def.statics;if(!constructor||constructor==Object.prototype.constructor)constructor=function(){throw new Error("cannot instantiate an interface (no constructor defined).");};var cls=goog.defineClass.createSealingConstructor_(constructor,superClass);if(superClass)goog.inherits(cls,superClass);delete def.constructor;delete def.statics;goog.defineClass.applyProperties_(cls.prototype,def);if(statics!=null)if(statics instanceof
Function)statics(cls);else goog.defineClass.applyProperties_(cls,statics);return cls};goog.defineClass.ClassDescriptor;goog.defineClass.SEAL_CLASS_INSTANCES=goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG);goog.defineClass.createSealingConstructor_=function(ctr,superClass){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return ctr;var wrappedCtr=function(){var instance=ctr.apply(this,arguments)||this;instance[goog.UID_PROPERTY_]=instance[goog.UID_PROPERTY_];return instance};return wrappedCtr};
goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.defineClass.applyProperties_=function(target,source){var key;for(key in source)if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key];for(var i=0;i<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;i++){key=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[i];if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key]}};
goog.identity_=function(s){return s};goog.createTrustedTypesPolicy=function(name){var policy=null;var policyFactory=goog.global.trustedTypes;if(!policyFactory||!policyFactory.createPolicy)return policy;try{policy=policyFactory.createPolicy(name,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_})}catch(e){goog.logToConsole_(e.message)}return policy};
if(!COMPILED&&goog.DEPENDENCIES_ENABLED){goog.isEdge_=function(){var userAgent=goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"";var edgeRe=/Edge\/(\d+)(\.\d)*/i;return!!userAgent.match(edgeRe)};goog.inHtmlDocument_=function(){var doc=goog.global.document;return doc!=null&&"write"in doc};goog.isDocumentLoading_=function(){var doc=goog.global.document;return doc.attachEvent?doc.readyState!="complete":doc.readyState=="loading"};goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH!=
undefined&&typeof goog.global.CLOSURE_BASE_PATH==="string"){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else if(!goog.inHtmlDocument_())return;var doc=goog.global.document;var currentScript=doc.currentScript;if(currentScript)var scripts=[currentScript];else var scripts=doc.getElementsByTagName("SCRIPT");for(var i=scripts.length-1;i>=0;--i){var script=scripts[i];var src=script.src;var qmark=src.lastIndexOf("?");var l=qmark==-1?src.length:qmark;if(src.slice(l-7,l)=="base.js"){goog.basePath=src.slice(0,
l-7);return}}};goog.findBasePath_();goog.protectScriptTag_=function(str){return str.replace(/<\/(SCRIPT)/ig,"\\x3c/$1")};goog.DebugLoader_=function(){this.dependencies_={};this.idToPath_={};this.written_={};this.loadingDeps_=[];this.depsToLoad_=[];this.paused_=false;this.factory_=new goog.DependencyFactory;this.deferredCallbacks_={};this.deferredQueue_=[]};goog.DebugLoader_.prototype.bootstrap=function(namespaces,callback){var cb=callback;function resolve(){if(cb){goog.global.setTimeout(cb,0);cb=
null}}if(!namespaces.length){resolve();return}var deps=[];for(var i=0;i<namespaces.length;i++){var path=this.getPathFromDeps_(namespaces[i]);if(!path)throw new Error("Unregonized namespace: "+namespaces[i]);deps.push(this.dependencies_[path])}var require=goog.require;var loaded=0;for(var i=0;i<namespaces.length;i++){require(namespaces[i]);deps[i].onLoad(function(){if(++loaded==namespaces.length)resolve()})}};goog.DebugLoader_.prototype.loadClosureDeps=function(){var relPath="deps.js";this.depsToLoad_.push(this.factory_.createDependency(goog.normalizePath_(goog.basePath+
relPath),relPath,[],[],{}));this.loadDeps_()};goog.DebugLoader_.prototype.requested=function(absPathOrId,opt_force){var path=this.getPathFromDeps_(absPathOrId);if(path&&(opt_force||this.areDepsLoaded_(this.dependencies_[path].requires))){var callback=this.deferredCallbacks_[path];if(callback){delete this.deferredCallbacks_[path];callback()}}};goog.DebugLoader_.prototype.setDependencyFactory=function(factory){this.factory_=factory};goog.DebugLoader_.prototype.load_=function(namespace){if(!this.getPathFromDeps_(namespace)){var errorMessage=
"goog.require could not find: "+namespace;goog.logToConsole_(errorMessage)}else{var loader=this;var deps=[];var visit=function(namespace){var path=loader.getPathFromDeps_(namespace);if(!path)throw new Error("Bad dependency path or symbol: "+namespace);if(loader.written_[path])return;loader.written_[path]=true;var dep=loader.dependencies_[path];for(var i=0;i<dep.requires.length;i++)if(!goog.isProvided_(dep.requires[i]))visit(dep.requires[i]);deps.push(dep)};visit(namespace);var wasLoading=!!this.depsToLoad_.length;
this.depsToLoad_=this.depsToLoad_.concat(deps);if(!this.paused_&&!wasLoading)this.loadDeps_()}};goog.DebugLoader_.prototype.loadDeps_=function(){var loader=this;var paused=this.paused_;while(this.depsToLoad_.length&&!paused)(function(){var loadCallDone=false;var dep=loader.depsToLoad_.shift();var loaded=false;loader.loading_(dep);var controller={pause:function(){if(loadCallDone)throw new Error("Cannot call pause after the call to load.");else paused=true},resume:function(){if(loadCallDone)loader.resume_();
else paused=false},loaded:function(){if(loaded)throw new Error("Double call to loaded.");loaded=true;loader.loaded_(dep)},pending:function(){var pending=[];for(var i=0;i<loader.loadingDeps_.length;i++)pending.push(loader.loadingDeps_[i]);return pending},setModuleState:function(type){goog.moduleLoaderState_={type:type,moduleName:"",declareLegacyNamespace:false}},registerEs6ModuleExports:function(path,exports,opt_closureNamespace){if(opt_closureNamespace)goog.loadedModules_[opt_closureNamespace]={exports:exports,
type:goog.ModuleType.ES6,moduleId:opt_closureNamespace||""}},registerGoogModuleExports:function(moduleId,exports){goog.loadedModules_[moduleId]={exports:exports,type:goog.ModuleType.GOOG,moduleId:moduleId}},clearModuleState:function(){goog.moduleLoaderState_=null},defer:function(callback){if(loadCallDone)throw new Error("Cannot register with defer after the call to load.");loader.defer_(dep,callback)},areDepsLoaded:function(){return loader.areDepsLoaded_(dep.requires)}};try{dep.load(controller)}finally{loadCallDone=
true}})();if(paused)this.pause_()};goog.DebugLoader_.prototype.pause_=function(){this.paused_=true};goog.DebugLoader_.prototype.resume_=function(){if(this.paused_){this.paused_=false;this.loadDeps_()}};goog.DebugLoader_.prototype.loading_=function(dep){this.loadingDeps_.push(dep)};goog.DebugLoader_.prototype.loaded_=function(dep){for(var i=0;i<this.loadingDeps_.length;i++)if(this.loadingDeps_[i]==dep){this.loadingDeps_.splice(i,1);break}for(var i=0;i<this.deferredQueue_.length;i++)if(this.deferredQueue_[i]==
dep.path){this.deferredQueue_.splice(i,1);break}if(this.loadingDeps_.length==this.deferredQueue_.length&&!this.depsToLoad_.length)while(this.deferredQueue_.length)this.requested(this.deferredQueue_.shift(),true);dep.loaded()};goog.DebugLoader_.prototype.areDepsLoaded_=function(pathsOrIds){for(var i=0;i<pathsOrIds.length;i++){var path=this.getPathFromDeps_(pathsOrIds[i]);if(!path||!(path in this.deferredCallbacks_)&&!goog.isProvided_(pathsOrIds[i]))return false}return true};goog.DebugLoader_.prototype.getPathFromDeps_=
function(absPathOrId){if(absPathOrId in this.idToPath_)return this.idToPath_[absPathOrId];else if(absPathOrId in this.dependencies_)return absPathOrId;else return null};goog.DebugLoader_.prototype.defer_=function(dependency,callback){this.deferredCallbacks_[dependency.path]=callback;this.deferredQueue_.push(dependency.path)};goog.LoadController=function(){};goog.LoadController.prototype.pause=function(){};goog.LoadController.prototype.resume=function(){};goog.LoadController.prototype.loaded=function(){};
goog.LoadController.prototype.pending=function(){};goog.LoadController.prototype.registerEs6ModuleExports=function(path,exports,opt_closureNamespace){};goog.LoadController.prototype.setModuleState=function(type){};goog.LoadController.prototype.clearModuleState=function(){};goog.LoadController.prototype.defer=function(callback){};goog.LoadController.prototype.areDepsLoaded=function(){};goog.Dependency=function(path,relativePath,provides,requires,loadFlags){this.path=path;this.relativePath=relativePath;
this.provides=provides;this.requires=requires;this.loadFlags=loadFlags;this.loaded_=false;this.loadCallbacks_=[]};goog.Dependency.prototype.getPathName=function(){var pathName=this.path;var protocolIndex=pathName.indexOf("://");if(protocolIndex>=0){pathName=pathName.substring(protocolIndex+3);var slashIndex=pathName.indexOf("/");if(slashIndex>=0)pathName=pathName.substring(slashIndex+1)}return pathName};goog.Dependency.prototype.onLoad=function(callback){if(this.loaded_)callback();else this.loadCallbacks_.push(callback)};
goog.Dependency.prototype.loaded=function(){this.loaded_=true;var callbacks=this.loadCallbacks_;this.loadCallbacks_=[];for(var i=0;i<callbacks.length;i++)callbacks[i]()};goog.Dependency.defer_=false;goog.Dependency.callbackMap_={};goog.Dependency.registerCallback_=function(callback){var key=Math.random().toString(32);goog.Dependency.callbackMap_[key]=callback;return key};goog.Dependency.unregisterCallback_=function(key){delete goog.Dependency.callbackMap_[key]};goog.Dependency.callback_=function(key,
var_args){if(key in goog.Dependency.callbackMap_){var callback=goog.Dependency.callbackMap_[key];var args=[];for(var i=1;i<arguments.length;i++)args.push(arguments[i]);callback.apply(undefined,args)}else{var errorMessage="Callback key "+key+" does not exist (was base.js loaded more than once?).";throw Error(errorMessage);}};goog.Dependency.prototype.load=function(controller){if(goog.global.CLOSURE_IMPORT_SCRIPT){if(goog.global.CLOSURE_IMPORT_SCRIPT(this.path))controller.loaded();else controller.pause();
return}if(!goog.inHtmlDocument_()){goog.logToConsole_("Cannot use default debug loader outside of HTML documents.");if(this.relativePath=="deps.js"){goog.logToConsole_("Consider setting CLOSURE_IMPORT_SCRIPT before loading base.js, "+"or setting CLOSURE_NO_DEPS to true.");controller.loaded()}else controller.pause();return}var doc=goog.global.document;if(doc.readyState=="complete"&&!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING){var isDeps=/\bdeps.js$/.test(this.path);if(isDeps){controller.loaded();return}else throw Error('Cannot write "'+
this.path+'" after document load');}var nonce=goog.getScriptNonce_();if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&goog.isDocumentLoading_()){var key;var callback=function(script){if(script.readyState&&script.readyState!="complete"){script.onload=callback;return}goog.Dependency.unregisterCallback_(key);controller.loaded()};key=goog.Dependency.registerCallback_(callback);var defer=goog.Dependency.defer_?" defer":"";var nonceAttr=nonce?' nonce="'+nonce+'"':"";var script='<script src="'+this.path+
'"'+nonceAttr+defer+' id="script-'+key+'">\x3c/script>';script+="<script"+nonceAttr+">";if(goog.Dependency.defer_)script+="document.getElementById('script-"+key+"').onload = function() {\n"+"  goog.Dependency.callback_('"+key+"', this);\n"+"};\n";else script+="goog.Dependency.callback_('"+key+"', document.getElementById('script-"+key+"'));";script+="\x3c/script>";doc.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(script):script)}else{var scriptEl=doc.createElement("script");
scriptEl.defer=goog.Dependency.defer_;scriptEl.async=false;if(nonce)scriptEl.nonce=nonce;scriptEl.onload=function(){scriptEl.onload=null;controller.loaded()};scriptEl.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(this.path):this.path;doc.head.appendChild(scriptEl)}};goog.Es6ModuleDependency=function(path,relativePath,provides,requires,loadFlags){goog.Es6ModuleDependency.base(this,"constructor",path,relativePath,provides,requires,loadFlags)};goog.inherits(goog.Es6ModuleDependency,
goog.Dependency);goog.Es6ModuleDependency.prototype.load=function(controller){if(goog.global.CLOSURE_IMPORT_SCRIPT){if(goog.global.CLOSURE_IMPORT_SCRIPT(this.path))controller.loaded();else controller.pause();return}if(!goog.inHtmlDocument_()){goog.logToConsole_("Cannot use default debug loader outside of HTML documents.");controller.pause();return}var doc=goog.global.document;var dep=this;function write(src,contents){var nonceAttr="";var nonce=goog.getScriptNonce_();if(nonce)nonceAttr=' nonce="'+
nonce+'"';if(contents){var script='<script type="module" crossorigin'+nonceAttr+">"+contents+"</"+"script>";doc.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(script):script)}else{var script='<script type="module" crossorigin src="'+src+'"'+nonceAttr+"></"+"script>";doc.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(script):script)}}function append(src,contents){var scriptEl=doc.createElement("script");scriptEl.defer=true;scriptEl.async=false;scriptEl.type=
"module";scriptEl.setAttribute("crossorigin",true);var nonce=goog.getScriptNonce_();if(nonce)scriptEl.nonce=nonce;if(contents)scriptEl.text=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScript(contents):contents;else scriptEl.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(src):src;doc.head.appendChild(scriptEl)}var create;if(goog.isDocumentLoading_()){create=write;goog.Dependency.defer_=true}else create=append;var beforeKey=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(beforeKey);
controller.setModuleState(goog.ModuleType.ES6)});create(undefined,'goog.Dependency.callback_("'+beforeKey+'")');create(this.path,undefined);var registerKey=goog.Dependency.registerCallback_(function(exports){goog.Dependency.unregisterCallback_(registerKey);controller.registerEs6ModuleExports(dep.path,exports,goog.moduleLoaderState_.moduleName)});create(undefined,'import * as m from "'+this.path+'"; goog.Dependency.callback_("'+registerKey+'", m)');var afterKey=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(afterKey);
controller.clearModuleState();controller.loaded()});create(undefined,'goog.Dependency.callback_("'+afterKey+'")')};goog.TransformedDependency=function(path,relativePath,provides,requires,loadFlags){goog.TransformedDependency.base(this,"constructor",path,relativePath,provides,requires,loadFlags);this.contents_=null;this.lazyFetch_=!goog.inHtmlDocument_()||!("noModule"in goog.global.document.createElement("script"))};goog.inherits(goog.TransformedDependency,goog.Dependency);goog.TransformedDependency.prototype.load=
function(controller){var dep=this;function fetch(){dep.contents_=goog.loadFileSync_(dep.path);if(dep.contents_){dep.contents_=dep.transform(dep.contents_);if(dep.contents_)dep.contents_+="\n//# sourceURL="+dep.path}}if(goog.global.CLOSURE_IMPORT_SCRIPT){fetch();if(this.contents_&&goog.global.CLOSURE_IMPORT_SCRIPT("",this.contents_)){this.contents_=null;controller.loaded()}else controller.pause();return}var isEs6=this.loadFlags["module"]==goog.ModuleType.ES6;if(!this.lazyFetch_)fetch();function load(){if(dep.lazyFetch_)fetch();
if(!dep.contents_)return;if(isEs6)controller.setModuleState(goog.ModuleType.ES6);var namespace;try{var contents=dep.contents_;dep.contents_=null;goog.globalEval(goog.CLOSURE_EVAL_PREFILTER_.createScript(contents));if(isEs6)namespace=goog.moduleLoaderState_.moduleName}finally{if(isEs6)controller.clearModuleState()}if(isEs6)goog.global["$jscomp"]["require"]["ensure"]([dep.getPathName()],function(){controller.registerEs6ModuleExports(dep.path,goog.global["$jscomp"]["require"](dep.getPathName()),namespace)});
controller.loaded()}function fetchInOwnScriptThenLoad(){var doc=goog.global.document;var key=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(key);load()});var nonce=goog.getScriptNonce_();var nonceAttr=nonce?' nonce="'+nonce+'"':"";var script="<script"+nonceAttr+">"+goog.protectScriptTag_('goog.Dependency.callback_("'+key+'");')+"</"+"script>";doc.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(script):script)}var anythingElsePending=controller.pending().length>
1;var needsAsyncLoading=goog.Dependency.defer_&&(anythingElsePending||goog.isDocumentLoading_());if(needsAsyncLoading){controller.defer(function(){load()});return}var doc=goog.global.document;var isInternetExplorerOrEdge=goog.inHtmlDocument_()&&("ActiveXObject"in goog.global||goog.isEdge_());if(isEs6&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()&&!isInternetExplorerOrEdge){goog.Dependency.defer_=true;controller.pause();var oldCallback=doc.onreadystatechange;doc.onreadystatechange=function(){if(doc.readyState==
"interactive"){doc.onreadystatechange=oldCallback;load();controller.resume()}if(typeof oldCallback==="function")oldCallback.apply(undefined,arguments)}}else if(!goog.inHtmlDocument_()||!goog.isDocumentLoading_())load();else fetchInOwnScriptThenLoad()};goog.TransformedDependency.prototype.transform=function(contents){};goog.PreTranspiledEs6ModuleDependency=function(path,relativePath,provides,requires,loadFlags){goog.PreTranspiledEs6ModuleDependency.base(this,"constructor",path,relativePath,provides,
requires,loadFlags)};goog.inherits(goog.PreTranspiledEs6ModuleDependency,goog.TransformedDependency);goog.PreTranspiledEs6ModuleDependency.prototype.transform=function(contents){return contents};goog.GoogModuleDependency=function(path,relativePath,provides,requires,loadFlags){goog.GoogModuleDependency.base(this,"constructor",path,relativePath,provides,requires,loadFlags)};goog.inherits(goog.GoogModuleDependency,goog.TransformedDependency);goog.GoogModuleDependency.prototype.transform=function(contents){if(!goog.LOAD_MODULE_USING_EVAL||
goog.global.JSON===undefined)return""+"goog.loadModule(function(exports) {"+'"use strict";'+contents+"\n"+";return exports"+"});"+"\n//# sourceURL="+this.path+"\n";else return""+"goog.loadModule("+goog.global.JSON.stringify(contents+"\n//# sourceURL="+this.path+"\n")+");"};goog.DebugLoader_.prototype.addDependency=function(relPath,provides,requires,opt_loadFlags){provides=provides||[];relPath=relPath.replace(/\\/g,"/");var path=goog.normalizePath_(goog.basePath+relPath);if(!opt_loadFlags||typeof opt_loadFlags===
"boolean")opt_loadFlags=opt_loadFlags?{"module":goog.ModuleType.GOOG}:{};var dep=this.factory_.createDependency(path,relPath,provides,requires,opt_loadFlags);this.dependencies_[path]=dep;for(var i=0;i<provides.length;i++)this.idToPath_[provides[i]]=path;this.idToPath_[relPath]=path};goog.DependencyFactory=function(){};goog.DependencyFactory.prototype.createDependency=function(path,relativePath,provides,requires,loadFlags){if(loadFlags["module"]==goog.ModuleType.GOOG)return new goog.GoogModuleDependency(path,
relativePath,provides,requires,loadFlags);else if(loadFlags["module"]==goog.ModuleType.ES6)if(goog.ASSUME_ES_MODULES_TRANSPILED)return new goog.PreTranspiledEs6ModuleDependency(path,relativePath,provides,requires,loadFlags);else return new goog.Es6ModuleDependency(path,relativePath,provides,requires,loadFlags);else return new goog.Dependency(path,relativePath,provides,requires,loadFlags)};goog.debugLoader_=new goog.DebugLoader_;goog.loadClosureDeps=function(){goog.debugLoader_.loadClosureDeps()};
goog.setDependencyFactory=function(factory){goog.debugLoader_.setDependencyFactory(factory)};goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null;if(!goog.global.CLOSURE_NO_DEPS)goog.debugLoader_.loadClosureDeps();goog.bootstrap=function(namespaces,callback){goog.debugLoader_.bootstrap(namespaces,callback)}}
if(!COMPILED){var isChrome87=false;try{isChrome87=eval(goog.global.trustedTypes.emptyScript)!==goog.global.trustedTypes.emptyScript}catch(err){}goog.CLOSURE_EVAL_PREFILTER_=goog.global.trustedTypes&&isChrome87&&goog.createTrustedTypesPolicy("goog#base#devonly#eval")||{createScript:goog.identity_}};goog.provide("plt.wescheme.SharedAs");plt.wescheme.SharedAs=function(entries){this.entries=entries};plt.wescheme.SharedAs.fromDom=function(dom){var entries=[];jQuery(dom).children("Entry").each(function(){var publicId=jQuery(this).children("publicId").text();var title=jQuery(this).children("title").text();var modified=parseInt(jQuery(this).children("modified").text());entries.push({publicId:publicId,title:title,modified:modified})});return new plt.wescheme.SharedAs(entries)};
plt.wescheme.SharedAs.prototype.getEntries=function(){return this.entries};goog.provide("plt.wescheme.WeSchemeProperties");plt.wescheme.WeSchemeProperties.wescheme_server_base="http://www.wescheme.org";goog.provide("plt.wescheme.base64");
(function(){plt.wescheme.base64.encode=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data)return data;do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join("");var r=data.length%3;return(r?
enc.slice(0,r-3):enc)+"===".slice(r||3)};plt.wescheme.base64.decode=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data)return data;data+="";do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&255;o2=bits>>8&255;o3=bits&255;if(h3==64)tmp_arr[ac++]=String.fromCharCode(o1);else if(h4==
64)tmp_arr[ac++]=String.fromCharCode(o1,o2);else tmp_arr[ac++]=String.fromCharCode(o1,o2,o3)}while(i<data.length);dec=tmp_arr.join("");return dec}})();goog.provide("plt.wescheme.Program");goog.require("plt.wescheme.SharedAs");goog.require("plt.wescheme.WeSchemeProperties");goog.require("plt.wescheme.base64");
(function(){plt.wescheme.Program=function(json){this.json=json};plt.wescheme.Program.prototype.getId=function(){return this.json.id};plt.wescheme.Program.prototype.hasSharingUrls=function(){return this.getSharedAsEntries().length>0};plt.wescheme.Program.prototype.getSharedAsEntries=function(){return new plt.wescheme.SharedAs(this.json.sharedAs)};plt.wescheme.Program.prototype.isPublished=function(){return this.json.published};plt.wescheme.Program.prototype.getTitle=function(){return this.json.title};
plt.wescheme.Program.prototype.getOwner=function(){return this.json.owner};plt.wescheme.Program.prototype.getPublicId=function(){return this.json.publicId};plt.wescheme.Program.prototype.getNotes=function(){return this.json.notes};plt.wescheme.Program.prototype.getSourceCode=function(){return this.json.source.src};plt.wescheme.Program.prototype.getPermissions=function(){return this.json.permissions};plt.wescheme.Program.prototype.getProvides=function(){return this.json.provides};plt.wescheme.Program.prototype.isSourcePublic=
function(){return this.json.isSourcePublic};plt.wescheme.Program.prototype.getObjectCode=function(){return this.json.object.obj};plt.wescheme.Program.prototype.isAndroidPackageBuilt=function(){return false};plt.wescheme.Program.prototype.getAndroidPackageUrl=function(){return""};plt.wescheme.Program.prototype.getPublicEditingUrl=function(){return plt.wescheme.WeSchemeProperties.wescheme_server_base+"/openEditor?publicId="+encodeURIComponent(this.getPublicId())}})();goog.provide("plt.wescheme.AjaxActions");goog.require("plt.wescheme.Program");
(function(){plt.wescheme.AjaxActions=function(){};plt.wescheme.AjaxActions.prototype.loadProject=function(pid,publicId,onSuccess,onFailure){var pid;if(pid)data={pid:pid};else data={publicId:publicId};data.gensym=Math.random();jQuery.ajax({cache:false,data:data,dataType:"json",type:"GET",url:"/loadProject",success:function(json){onSuccess(new plt.wescheme.Program(json))},error:function(xhr){onFailure(xhr.statusText)},xhr:function(settings){return new XMLHttpRequest(settings)}})};plt.wescheme.AjaxActions.prototype.listProjects=
function(onSuccess,onFailure){var callback=function(data){var dom=jQuery(data);onSuccess(dom)};var data={};data.gensym=Math.random();jQuery.ajax({cache:false,data:data,dataType:"xml",type:"GET",url:"/listProjects",success:callback,error:function(xhr){onFailure(xhr.statusText)},xhr:function(settings){return new XMLHttpRequest(settings)}})};plt.wescheme.AjaxActions.prototype.makeAClone=function(pid,code,onSuccess,onFailure){jQuery.ajax({cache:false,data:code===null?{pid:pid}:{pid:pid,code:code},dataType:"text",
type:"POST",url:"/cloneProject",success:function(data){var newPid=parseInt(data);onSuccess(newPid)},error:function(xhr){onFailure(xhr.statusText)},xhr:function(settings){return new XMLHttpRequest(settings)}})};plt.wescheme.AjaxActions.prototype.share=function(pid,isPublic,onSuccess,onFailure){jQuery.ajax({cache:false,data:{pid:pid,isPublic:isPublic},dataType:"xml",type:"POST",url:"/shareProject",success:function(data){onSuccess(jQuery(data))},error:function(xhr){onFailure(xhr.statusText)},xhr:function(settings){return new XMLHttpRequest(settings)}})};
plt.wescheme.AjaxActions.prototype.deleteProject=function(pid,onSuccess,onFailure){jQuery.ajax({cache:false,data:{pid:pid},dataType:"xml",type:"POST",url:"/deleteProject",success:function(data){onSuccess(jQuery(data))},error:function(xhr){onFailure(xhr.statusText)},xhr:function(settings){return new XMLHttpRequest(settings)}})};plt.wescheme.AjaxActions.prototype.save=function(attrs,onSuccess,onFailure){var i;var data={};var attrNames=["title","code","notes"];if(attrs.pid)data.pid=attrs.pid;for(i=0;i<
attrNames.length;i++)if(Object.hasOwnProperty.call(attrs,attrNames[i]))data[attrNames[i]]=attrs[attrNames[i]];jQuery.ajax({cache:false,data:data,dataType:"text",type:"POST",url:"/saveProject",success:function(data){var newPid=parseInt(data);onSuccess(newPid)},error:function(xhr){onFailure(xhr.statusText)},xhr:function(settings){return new XMLHttpRequest(settings)}})};plt.wescheme.AjaxActions.prototype.sendFeedback=function(author,type,feedbackText,onSuccess){jQuery.ajax({cache:false,data:{author:author,
type:type,feedbackText:feedbackText},datatype:"text",type:"POST",url:"/addFeedback",success:function(data){onSuccess()},error:function(xhr){onSuccess()},xhr:function(settings){return new XMLHttpRequest(settings)}})}})();goog.provide("plt.wescheme.makeDynamicModuleLoader");goog.require("plt.wescheme.AjaxActions");
(function(){plt.wescheme.makeDynamicModuleLoader=function(rootLibraryPath){var actions=new plt.wescheme.AjaxActions;var handleBuiltInCollection=function(aName,onSuccess,onFail){loadScript(rootLibraryPath+"/"+aName+"-min.js?__gensym="+encodeURIComponent(""+Math.random()),onSuccess,onFail)};var handleWeschemeModule=function(aName,onSuccess,onFail){var m=aName.match(/wescheme\/(\w+)/);var publicId=m[1];actions.loadProject(null,publicId,function(aProgram){try{window.COLLECTIONS[aName]={"name":aName,"bytecode":(0,eval)("("+
aProgram.getObjectCode()+")"),"provides":aProgram.getProvides()}}catch(e){onFail();return}onSuccess()},onFail)};var isWeschemeModule=function(aName){var m=aName.match(/^wescheme\/(\w+)$/);if(m)return true;return false};return function(aName,onSuccess,onFail){window.COLLECTIONS=window.COLLECTIONS||{};if(isWeschemeModule(aName))handleWeschemeModule(aName,onSuccess,onFail);else handleBuiltInCollection(aName,onSuccess,onFail)}}})();goog.provide("plt.compiler.throwError");goog.provide("plt.compiler.Program");goog.provide("plt.compiler.comment");goog.provide("plt.compiler.couple");goog.provide("plt.compiler.defFunc");goog.provide("plt.compiler.defVar");goog.provide("plt.compiler.defVars");goog.provide("plt.compiler.defStruct");goog.provide("plt.compiler.beginExpr");goog.provide("plt.compiler.lambdaExpr");goog.provide("plt.compiler.localExpr");goog.provide("plt.compiler.letrecExpr");goog.provide("plt.compiler.letExpr");goog.provide("plt.compiler.letStarExpr");
goog.provide("plt.compiler.condExpr");goog.provide("plt.compiler.caseExpr");goog.provide("plt.compiler.andExpr");goog.provide("plt.compiler.orExpr");goog.provide("plt.compiler.callExpr");goog.provide("plt.compiler.ifExpr");goog.provide("plt.compiler.whenUnlessExpr");goog.provide("plt.compiler.symbolExpr");goog.provide("plt.compiler.literal");goog.provide("plt.compiler.quotedExpr");goog.provide("plt.compiler.unquotedExpr");goog.provide("plt.compiler.quasiquotedExpr");goog.provide("plt.compiler.unquoteSplice");
goog.provide("plt.compiler.requireExpr");goog.provide("plt.compiler.provideStatement");goog.provide("plt.compiler.unsupportedExpr");goog.provide("plt.compiler.pinfo");goog.provide("plt.compiler.getBasePinfo");goog.provide("plt.compiler.isExpression");goog.provide("plt.compiler.isDefinition");goog.provide("plt.compiler.env");goog.provide("plt.compiler.emptyEnv");goog.provide("plt.compiler.localEnv");goog.provide("plt.compiler.globalEnv");goog.provide("plt.compiler.moduleBinding");goog.provide("plt.compiler.functionBinding");
goog.provide("plt.compiler.constantBinding");goog.provide("plt.compiler.structBinding");goog.provide("plt.compiler.unnamedEnv");window.plt=window.plt||{};plt.compiler=plt.compiler||{};
(function(){var unimplementedException=function(str){this.str=str};function throwError(msg,loc,errorClass){loc.source=loc.source||"<unknown>";function rewritePart(part){if(typeof part==="string")return part;else if(part instanceof symbolExpr){return'["span", [["class", "SchemeValue-Symbol"]], '+part.val+"]";return part.val}else if(part.location!==undefined)return{text:part.text,type:"ColoredPart",loc:part.location.toString(),toString:function(){return part.text}};else if(part.locations!==undefined)return{text:part.text,
type:"MultiPart",solid:part.solid,locs:part.locations.map(function(l){return l.toString()}),toString:function(){return part.text}}}msg.args=msg.args.map(rewritePart);var json={type:"moby-failure","dom-message":["span",[["class","Error"]],["span",[["class",errorClass||"Message"]]].concat(errorClass?[["span",[["class","Error.reason"]],msg.toString()],["span",[["class",(errorClass||"message")+(errorClass==="Error-GenericReadError"?".locations":".otherLocations")]]]]:msg.args.map(function(x){return x.toString()})),
["br",[],""],["span",[["class","Error.location"]],["span",[["class","location-reference"],["style","display:none"]],["span",[["class","location-offset"]],(loc.startChar+1).toString()],["span",[["class","location-line"]],loc.startRow.toString()],["span",[["class","location-column"]],loc.startCol.toString()],["span",[["class","location-span"]],loc.span.toString()],["span",[["class","location-id"]],loc.source.toString()]]]],"structured-error":JSON.stringify({message:errorClass?false:msg.args,location:loc.toString()})};
throw JSON.stringify(json);}function couple(first,second){this.first=first;this.second=second;this.toString=function(){return"("+this.first.toString()+" "+this.second.toString()+")"}}var heir=function(p){var f=function(){};f.prototype=p;return new f};var Program=function(){this.toString=function(){return this.val.toString()};this.location=null};function comment(txt){Program.call(this);this.txt=txt;this.toString=function(){return";"+this.txt}}comment.prototype=heir(Program.prototype);function defFunc(name,
args,body,stx){Program.call(this);this.name=name;this.args=args;this.body=body;this.stx=stx;this.toString=function(){return"(define ("+this.name.toString()+" "+this.args.join(" ")+")\n    "+this.body.toString()+")"}}defFunc.prototype=heir(Program.prototype);function defVar(name,expr,stx){Program.call(this);this.name=name;this.expr=expr;this.stx=stx;this.toString=function(){return"(define "+this.name.toString()+" "+this.expr.toString()+")"}}defVar.prototype=heir(Program.prototype);function defVars(names,
expr,stx){Program.call(this);this.names=names;this.expr=expr;this.stx=stx;this.toString=function(){return"(define-values ("+this.names.join(" ")+") "+this.expr.toString()+")"}}defVars.prototype=heir(Program.prototype);function defStruct(name,fields,stx){Program.call(this);this.name=name;this.fields=fields;this.stx=stx;this.toString=function(){return"(define-struct "+this.name.toString()+" ("+this.fields.toString()+"))"}}defStruct.prototype=heir(Program.prototype);function beginExpr(exprs,stx){Program.call(this);
this.exprs=exprs;this.stx=stx;this.toString=function(){return"(begin "+this.exprs.join(" ")+")"}}beginExpr.prototype=heir(Program.prototype);function lambdaExpr(args,body,stx){Program.call(this);this.args=args;this.body=body;this.stx=stx;this.toString=function(){return"(lambda ("+this.args.join(" ")+") "+this.body.toString()+")"}}lambdaExpr.prototype=heir(Program.prototype);function localExpr(defs,body,stx){Program.call(this);this.defs=defs;this.body=body;this.stx=stx;this.toString=function(){return"(local ("+
this.defs.toString()+") "+this.body.toString()+")"}}localExpr.prototype=heir(Program.prototype);function letrecExpr(bindings,body,stx){this.bindings=bindings;this.body=body;this.stx=stx;this.toString=function(){return"(letrec ("+this.bindings.toString()+") ("+this.body.toString()+"))"}}function letExpr(bindings,body,stx){this.bindings=bindings;this.body=body;this.stx=stx;this.toString=function(){return"(let ("+this.bindings.toString()+") ("+this.body.toString()+"))"}}function letStarExpr(bindings,
body,stx){this.bindings=bindings;this.body=body;this.stx=stx;this.toString=function(){return"(let* ("+this.bindings.toString()+") ("+this.body.toString()+"))"}}function condExpr(clauses,stx){this.clauses=clauses;this.stx=stx;this.toString=function(){return"(cond\n    "+this.clauses.join("\n    ")+")"}}function caseExpr(expr,clauses,stx){Program.call(this);this.expr=expr;this.clauses=clauses;this.stx=stx;this.toString=function(){return"(case "+this.expr.toString()+"\n    "+this.clauses.join("\n    ")+
")"}}caseExpr.prototype=heir(Program.prototype);function andExpr(exprs,stx){this.exprs=exprs;this.stx=stx;this.toString=function(){return"(and "+this.exprs.join(" ")+")"}}function orExpr(exprs,stx){this.exprs=exprs;this.stx=stx;this.toString=function(){return"(or "+this.exprs.toString()+")"}}function callExpr(func,args,stx){Program.call(this);this.func=func;this.args=args;this.stx=stx;this.toString=function(){return"("+[this.func].concat(this.args).join(" ")+")"}}callExpr.prototype=heir(Program.prototype);
function ifExpr(predicate,consequence,alternative,stx){Program.call(this);this.predicate=predicate;this.consequence=consequence;this.alternative=alternative;this.stx=stx;this.toString=function(){return"(if "+this.predicate.toString()+" "+this.consequence.toString()+" "+this.alternative.toString()+")"}}ifExpr.prototype=heir(Program.prototype);function whenUnlessExpr(predicate,exprs,stx){Program.call(this);this.predicate=predicate;this.exprs=exprs;this.stx=stx;this.toString=function(){return"("+this.stx[0]+
" "+this.predicate.toString()+" "+this.exprs.toString()+")"}}whenUnlessExpr.prototype=heir(Program.prototype);function symbolExpr(val,stx){Program.call(this);this.val=val;this.stx=stx}symbolExpr.prototype=heir(Program.prototype);function literal(val){Program.call(this);this.val=val;this.toString=function(){if(this.val===true)return"#t";if(this.val===false)return"#f";if(this.val instanceof Char){var c=this.val.val;return c==="\b"?"#\\backspace":c==="\t"?"#\\tab":c==="\n"?"#\\newline":c===" "?"#\\space":
c==="\v"?"#\\vtab":this.val.toWrittenString()}return types.toWrittenString(this.val)}}literal.prototype=heir(Program.prototype);Vector.prototype.toString=Vector.prototype.toWrittenString=function(){var filtered=this.elts.filter(function(e){return e!==undefined}),last=filtered[filtered.length-1];return"#("+this.elts.map(function(elt){return elt===undefined?last:elt})+")"};function quotedExpr(val){Program.call(this);this.val=val;this.toString=function(){function quoteLikePairP(v){return v instanceof
Array&&v.length===2&&v[0]instanceof symbolExpr&&(v[0].val==="quasiquote"||v[0].val==="quote"||v[0].val==="unquote"||v[0].val==="unquote-splicing")}function shortName(lexeme){var s=lexeme.val;return s==="quasiquote"?"`":s==="quote"?"'":s==="unquote"?",":s==="unquote-splicing"?",@":function(){throw"impossible quote-like string";}()}function elementToString(v){if(quoteLikePairP(v))return shortName(v[0]).concat(elementToString(v[1]));else if(v instanceof Array)return v.reduce(function(acc,x){return acc.concat(elementToString(x))},
"(").concat(")");else return v.toString()}return"'"+elementToString(this.val)}}quotedExpr.prototype=heir(Program.prototype);function unquotedExpr(val){Program.call(this);this.val=val;this.toString=function(){return","+this.val.toString()}}unquotedExpr.prototype=heir(Program.prototype);function quasiquotedExpr(val){Program.call(this);this.val=val;this.toString=function(){if(this.val instanceof Array)return"`("+this.val.toString()+")";else return"`"+this.val.toString()}}quasiquotedExpr.prototype=heir(Program.prototype);
function unquoteSplice(val){Program.call(this);this.val=val;this.toString=function(){return",@"+this.val.toString()}}unquoteSplice.prototype=heir(Program.prototype);function requireExpr(spec,stx){Program.call(this);this.spec=spec;this.stx=stx;this.toString=function(){return"(require "+this.spec.toString()+")"}}requireExpr.prototype=heir(Program.prototype);function provideStatement(clauses,stx){Program.call(this);this.clauses=clauses;this.stx=stx;this.toString=function(){return"(provide "+this.clauses.toString()+
")"}}provideStatement.prototype=heir(Program.prototype);function unsupportedExpr(val,errorMsg,errorSpan){Program.call(this);this.val=val;this.errorMsg=errorMsg;this.errorSpan=errorSpan;this.toString=function(){return this.val.toString()}}unsupportedExpr.prototype=heir(Program.prototype);function isExpression(node){return!(node instanceof defVar||node instanceof defVars||node instanceof defStruct||node instanceof defFunc||node instanceof provideStatement||node instanceof unsupportedExpr||node instanceof
requireExpr)}function isDefinition(node){return node instanceof defVar||node instanceof defVars||node instanceof defStruct||node instanceof defFunc}function moduleBinding(name,bindings){this.name=name;this.bindings=bindings}function constantBinding(name,moduleSource,permissions,loc){this.name=name;this.moduleSource=moduleSource;this.permissions=permissions;this.loc=loc;this.toString=function(){return this.name};return this}function functionBinding(name,moduleSource,minArity,isVarArity,permissions,
isCps,loc){this.name=name;this.moduleSource=moduleSource;this.minArity=minArity;this.isVarArity=isVarArity;this.permissions=permissions;this.isCps=isCps;this.loc=loc;this.toString=function(){return this.name};return this}function structBinding(name,moduleSource,fields,constructor,predicate,accessors,mutators,permissions,loc){this.name=name;this.moduleSource=moduleSource;this.fields=fields;this.constructor=constructor;this.predicate=predicate;this.accessors=accessors;this.mutators=mutators;this.permissions=
permissions;this.loc=loc;this.toString=function(){return this.name};return this}var makeHash=types.makeLowLevelEqHash;plt.compiler.keywords=["cond","else","let","case","let*","letrec","quote","quasiquote","unquote","unquote-splicing","local","begin","if","or","and","when","unless","lambda","\u03bb","define","define-struct","define-values"];function env(bindings){var that=this;this.bindings=bindings||makeHash();this.lookup=function(id){return this.bindings.containsKey(id)?this.bindings.get(id):false};
this.peek=function(depth){return depth==0?this:this instanceof emptyEnv?"IMPOSSIBLE - peeked at an emptyEnv!":this.parent.peek(depth-1)};this.contains=function(name){return this.lookup(name)!==false};this.keys=this.bindings.keys;this.extend=function(binding){this.bindings.put(binding.name,binding);return new plt.compiler.env(this.bindings)};this.extendFunction=function(id,moduleSource,minArity,isVarArity,loc){return this.extend(new functionBinding(id,moduleSource,minArity,isVarArity,[],false,loc))};
this.extendConstant=function(id,moduleSource,loc){return this.extend(new constantBinding(id,moduleSource,[],loc))};this.lookup_context=function(id){if(id.context instanceof env)return id.context.contains(id)?id.context.lookup(id):false;else return that.contains(id)?that.lookup(id):false};this.extendEnv_moduleBinding=function(module){return module.bindings.reduceRight(function(env,binding){return env.extend(binding)},this)};this.toString=function(){return this.bindings.values().reduce(function(s,b){return s+
"\n  |---"+b.name},"")}}function emptyEnv(){env.call(this);this.lookup=function(name,depth){return new plt.compiler.unboundStackReference(name)}}emptyEnv.prototype=heir(env.prototype);function unnamedEnv(parent){env.call(this);this.parent=parent;this.lookup=function(name,depth){return this.parent.lookup(name,depth+1)}}unnamedEnv.prototype=heir(env.prototype);function localEnv(name,boxed,parent){env.call(this);this.name=name;this.boxed=boxed;this.parent=parent;this.lookup=function(name,depth){return name===
this.name?new plt.compiler.localStackReference(name,this.boxed,depth):this.parent.lookup(name,depth+1)}}localEnv.prototype=heir(env.prototype);function globalEnv(names,boxed,parent){env.call(this);this.names=names;this.boxed=boxed;this.parent=parent;var that=this;this.lookup=function(name,depth){var pos=this.names.indexOf(name);return pos>-1?new plt.compiler.globalStackReference(name,depth,pos):this.parent.lookup(name,depth+1)}}globalEnv.prototype=heir(env.prototype);var defaultCurrentModulePath=
"";plt.compiler.defaultModuleResolver=function(name){for(var i=0;i<plt.compiler.knownModules.length;i++)if(plt.compiler.knownModules[i].name===name)return plt.compiler.knownModules[i];return false};function levenshteinDistance(a,b){if(a.length===0)return b.length;if(b.length===0)return a.length;var matrix=[];for(var i=0;i<=b.length;i++)matrix[i]=[i];for(var j=0;j<=a.length;j++)matrix[0][j]=j;for(i=1;i<=b.length;i++)for(j=1;j<=a.length;j++)if(b.charAt(i-1)==a.charAt(j-1))matrix[i][j]=matrix[i-1][j-
1];else matrix[i][j]=Math.min(matrix[i-1][j-1]+1,Math.min(matrix[i][j-1]+1,matrix[i-1][j]+1));return matrix[b.length][a.length]}plt.compiler.moduleGuess=function(wrongName){return plt.compiler.knownModules.reduce(function(best,module){var dist=levenshteinDistance(module.name,wrongName);return dist<best.distance?{name:module.name,distance:dist}:best},{name:wrongName,distance:5})};plt.compiler.defaultModulePathResolver=function(path,parentPath){var parts=path.toString().split("/"),collectionName=parts[0],
moduleName=parts.slice(1).join();return plt.compiler.knownCollections.indexOf(collectionName)>-1&&plt.compiler.defaultModuleResolver(path.toString())||/^wescheme\/\w+$/.exec(path)};function pinfo(env,modules,usedBindingsHash,freeVariables,gensymCounter,providedNames,definedNames,sharedExpressions,withLocationEmits,allowRedefinition,moduleResolver,modulePathResolver,currentModulePath,declaredPermissions){this.env=env||new emptyEnv;this.modules=modules||[];this.usedBindingsHash=usedBindingsHash||makeHash();
this.freeVariables=freeVariables||[];this.gensymCounter=gensymCounter||0;this.providedNames=providedNames||makeHash();this.definedNames=definedNames||makeHash();this.sharedExpressions=sharedExpressions||makeHash();this.withLocationEmits=withLocationEmits||true;this.allowRedefinition=allowRedefinition||false;this.moduleResolver=moduleResolver||plt.compiler.defaultModuleResolver;this.modulePathResolver=modulePathResolver||plt.compiler.defaultModulePathResolver;this.currentModulePath=currentModulePath||
defaultCurrentModulePath;this.declaredPermissions=declaredPermissions||[];this.isRedefinition=function(name){return this.env.lookup(name)};this.usedBindings=this.usedBindingsHash.values;this.accumulateDeclaredPermission=function(name,permission){this.declaredPermissions=[[name,permission]].concat(this.declaredPermissions);return this};this.accumulateSharedExpression=function(expression,translation){var labeledTranslation=makeLabeledTranslation(this.gensymCounter,translation);this.sharedExpressions.put(labeledTranslation,
expression);return this};this.accumulateDefinedBinding=function(binding,loc){if(plt.compiler.keywords.indexOf(binding.name)>-1)throwError(new types.Message([new types.ColoredPart(binding.name,binding.loc),": this is a reserved keyword and cannot be used"+" as a variable or function name"]),binding.loc);else if(!this.allowRedefinition&&this.isRedefinition(binding.name)){var prevBinding=this.env.lookup(binding.name);if(prevBinding.loc)throwError(new types.Message([new types.ColoredPart(binding.name,
binding.loc),": this name has a ",new types.ColoredPart("previous definition",prevBinding.loc)," and cannot be re-defined"]),binding.loc);else throwError(new types.Message([new types.ColoredPart(binding.name,binding.loc),": this name has a ","previous definition"," and cannot be re-defined"]),binding.loc)}else{this.env.extend(binding);this.definedNames.put(binding.name,binding);return this}};this.accumulateDefinedBindings=function(bindings,loc){var that=this;bindings.forEach(function(b){that.accumulateDefinedBinding(b,
loc)});return this};this.accumulateModuleBindings=function(bindings){var that=this;bindings.forEach(function(b){that.env.extend(b)});return this};this.accumulateModule=function(module){this.modules=[module].concat(this.modules);return this};this.accumulateBindingUse=function(binding){var alreadyExists=this.usedBindingsHash.get(binding.name);if(!(alreadyExists&&alreadyExists.moduleSource))this.usedBindingsHash.put(binding.name,binding);return this};this.accumulateFreeVariableUse=function(sym){this.freeVariables=
this.freeVariables.indexOf(sym)>-1?this.freeVariables:[sym].concat(this.freeVariables);return this};this.gensym=function(label){return[this,new symbolExpr(label+this.gensymCounter++)]};this.permissions=function(){function onlyUnique(value,index,self){return self.indexOf(value)===index}function reducePermissions(permissions,b){return(b instanceof functionBinding||b instanceof constantBinding)&&b.permissions.length>0?permissions.concat(b.permissions):permissions}return this.usedBindings().reduce(reducePermissions,
[]).filter(onlyUnique)};this.getExposedBindings=function(){var that=this;function lookupProvideBindingInDefinitionBindings(provideBinding){if(!that.definedNames.containsKey(provideBinding.symbl))throwError(new types.Message(["provided-name-not-defined: ",provideBinding.symbl]));var binding=checkBindingCompatibility(binding,that.definedNames.get(provideBinding.symbl));function ref(id){return that.definedNames.get(id)}if(provideBinding instanceof plt.compiler.provideBindingStructId)return[ref(binding.constructor),
ref(binding.predicate)].concat(binding.accessors.map(ref),binding.mutators.map(ref));else return[binding]}function decorateWithPermissions(binding){var bindingEntry=function(entry){return entry[0]===binding.name},filteredPermissions=that.declaredPermissions.filter(bindingEntry);binding.permissions=filteredPermissions.map(function(p){return p[1]});return binding}function checkBindingCompatibility(binding,exportedBinding){if(binding instanceof plt.compiler.provideBindingStructId&&!(exportedBinding instanceof
structBinding))throwError(new types.Message(["provided-structure-not-structure: ",exportedBinding.symbl]));else return exportedBinding}bindings=bindings.reduce(function(acc,b){return acc.concat(lookupProvideBindingInDefinitionBindings(b))},[]);return bindings.map(decorateWithPermissions)};this.toString=function(){var s="pinfo-------------";s+="\n**env****: "+this.env.toString();s+="\n**modules**: "+this.modules.join(",");s+="\n**used bindings**: "+this.usedBindings();s+="\n**free variables**: "+this.freeVariables.join(",");
s+="\n**gensym counter**: "+this.gensymCounter;s+="\n**provided names**: "+this.providedNames.values();s+="\n**defined names**: "+this.definedNames.values();s+="\n**permissions**: "+this.permissions();return s}}function getBasePinfo(language){var baseConstantsEnv=["null","empty","true","false","eof","pi","e","js-undefined","js-null"].reduce(function(env,id){return env.extendConstant(id.toString(),'"moby/toplevel"',false)},new emptyEnv);var pinfo=new plt.compiler.pinfo,topLevelEnv=plt.compiler.topLevelModules.reduceRight(function(env,
mod){return env.extendEnv_moduleBinding(mod)},baseConstantsEnv);if(language==="moby")pinfo.env=topLevelEnv.extendEnv_moduleBinding(mobyModuleBinding);else if(language==="base")pinfo.env=topLevelEnv;return pinfo}plt.compiler.throwError=throwError;plt.compiler.Program=Program;plt.compiler.comment=comment;plt.compiler.couple=couple;plt.compiler.defFunc=defFunc;plt.compiler.defVar=defVar;plt.compiler.defVars=defVars;plt.compiler.defStruct=defStruct;plt.compiler.beginExpr=beginExpr;plt.compiler.lambdaExpr=
lambdaExpr;plt.compiler.localExpr=localExpr;plt.compiler.letrecExpr=letrecExpr;plt.compiler.letExpr=letExpr;plt.compiler.letStarExpr=letStarExpr;plt.compiler.condExpr=condExpr;plt.compiler.caseExpr=caseExpr;plt.compiler.andExpr=andExpr;plt.compiler.orExpr=orExpr;plt.compiler.callExpr=callExpr;plt.compiler.ifExpr=ifExpr;plt.compiler.whenUnlessExpr=whenUnlessExpr;plt.compiler.symbolExpr=symbolExpr;plt.compiler.literal=literal;plt.compiler.quotedExpr=quotedExpr;plt.compiler.unquotedExpr=unquotedExpr;
plt.compiler.quasiquotedExpr=quasiquotedExpr;plt.compiler.unquoteSplice=unquoteSplice;plt.compiler.requireExpr=requireExpr;plt.compiler.provideStatement=provideStatement;plt.compiler.unsupportedExpr=unsupportedExpr;plt.compiler.pinfo=pinfo;plt.compiler.getBasePinfo=getBasePinfo;plt.compiler.isExpression=isExpression;plt.compiler.isDefinition=isDefinition;plt.compiler.env=env;plt.compiler.emptyEnv=emptyEnv;plt.compiler.localEnv=localEnv;plt.compiler.globalEnv=globalEnv;plt.compiler.moduleBinding=moduleBinding;
plt.compiler.functionBinding=functionBinding;plt.compiler.constantBinding=constantBinding;plt.compiler.structBinding=structBinding;plt.compiler.unnamedEnv=unnamedEnv})();goog.provide("plt.compiler.lex");goog.provide("plt.compiler.sexpToString");goog.require("plt.compiler.comment");goog.require("plt.compiler.literal");goog.require("plt.compiler.symbolExpr");goog.require("plt.compiler.unsupportedExpr");goog.require("plt.compiler.throwError");window.plt=window.plt||{};plt.compiler=plt.compiler||{};
(function(){var comment=plt.compiler.comment;var literal=plt.compiler.literal;var symbolExpr=plt.compiler.symbolExpr;var unsupportedExpr=plt.compiler.unsupportedExpr;var throwError=plt.compiler.throwError;var leftListDelims=/[(\u005B\u007B]/,rightListDelims=/[)\u005D\u007D]/,matchUntilDelim=/^[^(\u005B\u007B)\u005D\u007D\s]+/,quotes=/['`,]/,hex2=new RegExp("^([0-9a-f]{1,2})","i"),hex4=new RegExp("^([0-9a-f]{1,4})","i"),hex6=new RegExp("^([0-9a-f]{1,6})","i"),hex8=new RegExp("^([0-9a-f]{1,8})","i"),
oct3=new RegExp("^([0-7]{1,3})","i");var delims,line,column,startCol,startRow,source,caseSensitiveSymbols,i;var endOfError;var Location=function(startCol,startRow,startChar,span,theSource){this.startCol=startCol;this.startRow=startRow;this.startChar=startChar;this.span=span;this.source=theSource||source;this.endCol=column;this.endRow=line;this.endChar=startChar+span;this.start=function(){return new Location("","",this.startChar,1)};this.end=function(){return new Location("","",this.startChar+this.span-
1,1)};this.toString=function(){return"Loc("+this.startCol+", "+this.startRow+", "+(this.startChar+1)+","+this.span+")"};this.toVector=function(){return new types.vector(['"'+this.source+'"',this.startChar+1,this.startRow,this.startCol,this.span])};this.toString=function(){return{line:this.startRow.toString(),id:this.source,span:this.span.toString(),offset:(this.startChar+1).toString(),column:this.startCol.toString()}}};function isWhiteSpace(str){return/\s/.test(str)}function isDelim(x){return x===
"("||x===")"||x==="["||x==="]"||x==="{"||x==="}"}function isValidSymbolCharP(x){return!isDelim(x)&&!isWhiteSpace(x)&&x!=='"'&&x!==","&&x!=="'"&&x!=="`"&&x!==";"}function matchingDelims(x,y){return x==="("&&y===")"||x==="["&&y==="]"||x==="{"&&y==="}"}function otherDelim(x){return x==="("?")":x==="["?"]":x==="{"?"}":x===")"?"(":x==="]"?"[":x==="}"?"{":throwError(new types.Message(["otherDelim: Unknown delimiter: ",x]))}function chewWhiteSpace(str,i){var p;if(i<str.length){p=str.charAt(i);while(isWhiteSpace(p)&&
i<str.length){if(p==="\n"){line++;column=0}else column++;p=str.charAt(++i)}}return i}Array.prototype.toString=function(){return this.join(" ")};function sexpToString(sexp){return sexp instanceof Array?"("+sexp.map(sexpToString).toString()+")":sexp.toString()}function readProg(str,strSource){var i=0;startCol=column=0;startRow=line=1,caseSensitiveSymbols=true;source=strSource||"<definitions>";var sexp,sexps=[];delims=[];i=chewWhiteSpace(str,0);while(i<str.length){sexp=readSExpByIndex(str,i);if(!(sexp instanceof
comment))sexps.push(sexp);i=chewWhiteSpace(str,sexp.location.startChar+sexp.location.span)}sexps.location=new Location(startCol,startRow,0,i,source);return sexps}function readSSFile(str,strSource){var i=0;startCol=column=0;startRow=line=1,caseSensitiveSymbols=true;source=strSource||"<definitions>";var crs=0;while(i<str.length&&crs<3)if(str.charAt(i++)==="\n")crs++;var sexp,sexps=[];delims=[];while(i<str.length){sexp=readSExpByIndex(str,i);if(!(sexp instanceof comment))sexps.push(sexp);i=chewWhiteSpace(str,
sexp.location.startChar+sexp.location.span)}return sexps}function readSExp(str,source){delims=[];var sexp=readSExpByIndex(str,0);return sexp instanceof comment?null:sexp}function readSExpByIndex(str,i){startCol=column;startRow=line;var iStart=i;i=chewWhiteSpace(str,i);var p=str.charAt(i);if(i>=str.length){endOfError=i;throwError(new types.Message([source,":",startRow.toString(),":",(startCol-1).toString(),": read: (found end-of-file)"]),new Location(startCol-1,startRow,i-2,2),"Error-GenericReadError")}var sexp=
rightListDelims.test(p)?throwError(new types.Message(["read: expected an open '",otherDelim(p),"' to open ",new types.ColoredPart(" "+p+" ",new Location(column,startRow,iStart,1))]),new Location(column,startRow,iStart,1)):leftListDelims.test(p)?readList(str,i):p==='"'?readString(str,i):p==="#"?readPoundSExp(str,i):p===";"?readLineComment(str,i):quotes.test(p)?readQuote(str,i):readSymbolOrNumber(str,i);return sexp}function readList(str,i){var startCol=column,startRow=line,iStart=i,innerError=false,
errorLocation=new Location(startCol,startRow,iStart,1),openingDelim=str.charAt(i++),dot1Idx=false,dot2Idx=false;column++;var sexp,list=[];delims.push(openingDelim);i=chewWhiteSpace(str,i);function readListItem(str,i,list){var sexp=readSExpByIndex(str,i);i=sexp.location.end().startChar+1;if(sexp instanceof symbolExpr&&sexp.val=="."){if(dot2Idx){var msg=new types.Message(["A syntax list may have only 2 `.'s"]);throwError(msg,list[dot1Idx].location)}dot2Idx=dot1Idx?list.length:false;dot1Idx=dot1Idx||
list.length}if(!(sexp instanceof comment)){sexp.parent=list;list.push(sexp)}return i}function processDots(list,dot1Idx,dot2Idx){if(dot1Idx===0){var msg=new types.Message(["A `.' cannot be the first element in a syntax list"]);throwError(msg,list[dot1Idx].location)}if(dot1Idx===list.length-1||dot2Idx===list.length-1){var msg=new types.Message(["A `.' cannot be the last element in a syntax list"]);throwError(msg,list[dot2Idx||dot1Idx].location)}if(dot2Idx)if(dot2Idx-dot1Idx!==2){var msg=new types.Message(["Two `.'s may only surround one syntax item"]);
throwError(msg,list[dot2Idx].location)}else return list.slice(dot1Idx+1,dot1Idx+2).concat(list.slice(0,dot1Idx),list.slice(dot2Idx+1));if(!(list[dot1Idx+1]instanceof Array)){var msg=new types.Message(["A `.' must be followed by a syntax list, but found ",new types.ColoredPart("something else",list[dot1Idx+1].location)]);throwError(msg,list[dot1Idx+1].location)}if(list.length>dot1Idx+2){var msg=new types.Message(["A `.' followed by a syntax list must be followed by a closing delimeter, but found ",
new types.ColoredPart("something else",list[dot1Idx+2].location)]);throwError(msg,list[dot1Idx+1].location)}else return list.slice(0,dot1Idx).concat(list[dot1Idx+1],list.slice(dot1Idx+2))}function handleError(e){if(/expected a .+ to (close|open)/.exec(e)||/unexpected/.exec(e)||/syntax list/.exec(e)||/bad syntax/.exec(e)||/bad character constant/.exec(e))throw e;else{var eLoc=JSON.parse(JSON.parse(e)["structured-error"]).location;errorLocation=new Location(Number(eLoc.column),Number(eLoc.line),Number(eLoc.offset)-
1,Number(eLoc.span));i=endOfError;innerError=e}return i}while(i<str.length&&!rightListDelims.test(str.charAt(i))){if(str.charAt(i)==="\n"){line++;column=0}try{i=readListItem(str,i,list)}catch(e){var i=handleError(e)}i=chewWhiteSpace(str,i)}if(i>=str.length){var msg=new types.Message(["read: expected a closing '",otherDelim(openingDelim),"' to close ",new types.ColoredPart(" "+openingDelim.toString()+" ",new Location(startCol,startRow,iStart,1))]);throwError(msg,errorLocation)}if(!matchingDelims(openingDelim,
str.charAt(i))){var msg=new types.Message(["read: expected a closing '",otherDelim(openingDelim),"' to close ",new types.ColoredPart(" "+openingDelim.toString()+" ",new Location(startCol,startRow,iStart,1))," but found a ",new types.ColoredPart(" "+str.charAt(i).toString()+" ",new Location(column,line,i,1))]);throwError(msg,new Location(column,line,i,1))}column++;i++;if(innerError){endOfError=i;throw innerError;}if(dot1Idx||dot2Idx)list=processDots(list,dot1Idx,dot2Idx);list.location=new Location(startCol,
startRow,iStart,i-iStart);return list}function readString(str,i){var startCol=column,startRow=line,iStart=i;var closedString=/^"[^"]*(\\"[^"]*)*[^\\]"|""/.test(str.slice(i)),greedy=/^"[^"]*(\\"[^"]*)*/.exec(str.slice(iStart))[0];i++;column++;var chr,datum="";while(i<str.length&&str.charAt(i)!=='"'){chr=str.charAt(i++);if(chr==="\n"){line++;column=0}else column++;if(chr==="\\"){column++;chr=str.charAt(i++);if(i>=str.length)break;switch(true){case /a/.test(chr):chr="\u0007";break;case /b/.test(chr):chr=
"\b";break;case /t/.test(chr):chr="\t";break;case /n/.test(chr):chr="\n";break;case /v/.test(chr):chr="\v";break;case /f/.test(chr):chr="\f";break;case /r/.test(chr):chr="\r";break;case /e/.test(chr):chr="'";break;case /\n/.test(chr):chr="";break;case /["'\\]/.test(chr):break;case /[xuU]/.test(chr):var regexp=chr==="x"?hex2:chr==="u"?hex4:hex8;if(!regexp.test(str.slice(i))){endOfError=iStart+greedy.length+1;throwError(new types.Message([source,":",startRow.toString(),":",startCol.toString(),": read: no hex digit following \\"+
chr+" in string"]),new Location(startCol,startRow,iStart,i-iStart+1),"Error-GenericReadError")}var match=regexp.exec(str.slice(i))[1];chr=String.fromCharCode(parseInt(match,16));i+=match.length;column+=match.length;break;case oct3.test(str.slice(i-1)):var match=oct3.exec(str.slice(i-1))[1];chr=String.fromCharCode(parseInt(match,8));i+=match.length-1;column+=match.length-1;break;default:endOfError=iStart+greedy.length+1;throwError(new types.Message([source,":",startRow.toString(),":",startCol.toString(),
": read: unknown escape sequence \\"+chr+" in string"]),new Location(startCol,startRow,iStart,i-iStart),"Error-GenericReadError")}}datum+=chr}if(!closedString){endOfError=iStart+greedy.length;throwError(new types.Message([source,":",startRow.toString(),":",startCol.toString(),": read: expected a closing '\"'"]),new Location(startCol,startRow,iStart,1),"Error-GenericReadError")}var strng=new literal(new types.string(datum));i++;column++;strng.location=new Location(startCol,startRow,iStart,i-iStart);
return strng}function readPoundSExp(str,i){var startCol=column,startRow=line,iStart=i,datum;i++;column++;var unsupportedError;function throwUnsupportedError(errorStr,token){var msg=new types.Message([source,":",line.toString(),":",(column-1).toString(),errorStr]);throwError(msg,new Location(startCol,startRow,iStart,token.length+1),"Error-GenericReadError")}if(i<str.length){var p=str.charAt(i).toLowerCase();var unsupportedMatch=new RegExp('^(((fl|fx|s|hash|hasheq)[[({])|((rx|px)#{0,1}"))',"g"),unsupportedTest=
unsupportedMatch.exec(str.slice(i));var badExtensionMatch=/^(!(?!\/)|reader|lang[\s]{0,1})/,badExtensionTest=badExtensionMatch.exec(str.slice(i));var caseSensitiveMatch=new RegExp("^(c|C)(i|I|s|S)"),caseSensitiveTest=caseSensitiveMatch.exec(str.slice(i));var vectorMatch=new RegExp("^([0-9]*)[[({]","g"),vectorTest=vectorMatch.exec(str.slice(i));if(unsupportedTest&&unsupportedTest[0].length>0){var sexp=readSExpByIndex(str,i+unsupportedTest[0].length-1),kind,span=unsupportedTest[0].length,base=unsupportedTest[0].replace(/[\(\[\{"|#"]/g,
"");switch(base){case "fl":kind="flvectors";break;case "fx":kind="fxvectors";break;case "s":kind="structs";break;case "hash":case "hasheq":kind="hashtables";break;case "px":case "rx":kind="regular expressions";break;default:throw"IMPOSSIBLE: unsupportedMatch captured something it shouldn't: "+base;}var error=new types.Message([source,":",line.toString(),":","0",": read-syntax: literal "+kind+" not allowed"]);datum=new unsupportedExpr(sexp,error,span);datum.location=new Location(startCol,startRow,
iStart,unsupportedTest[0].length+sexp.location.span);return datum}else if(badExtensionTest&&badExtensionTest[0].length>0)throwUnsupportedError(": read: #"+badExtensionTest[0].trim()+" not enabled in the current context",badExtensionTest[0]);else if(caseSensitiveTest&&caseSensitiveTest[0].length>0){caseSensitiveSymbols=caseSensitiveTest[0].toLowerCase()==="cs";i+=2;column+=2;return readSExpByIndex(str,i)}else if(vectorTest&&vectorTest[0].length>0){var size=vectorTest[1]?parseInt(vectorTest[1]):"",
sizeChars=size.toString().length;i+=sizeChars;column+=sizeChars;var elts=readList(str,i),len=size===""?elts.length:parseInt(vectorTest[1]);if(elts.length>len){var msg=new types.Message(["read: vector length "+len+" is too small, ",elts.length+" value"+(elts.length>1?"s":"")," provided"]);throwError(msg,new Location(startCol,startRow,iStart,vectorTest[0].length))}i+=elts.location.span;datum=new literal(new Vector(len,elts));datum.location=new Location(startCol,startRow,iStart,i-iStart);return datum}else{var poundChunk=
new RegExp("^(hasheq|hash|fl|fx|\\d+|true|false|[tfeibdox]|\\<\\<|[\\\\\\\"\\%\\:\\&\\|\\;\\!\\`\\,\\']|)","i"),chunk=poundChunk.exec(str.slice(i))[0],nextChar=str.charAt(i+chunk.length);var p=chunk.charAt(0).toLowerCase();switch(p){case "\\":datum=readChar(str,i-1);i+=datum.location.span-1;break;case '"':throwUnsupportedError(": byte strings are not supported in WeScheme",'#"');case "%":datum=readSymbolOrNumber(str,i);datum.val="#"+datum.val;i+=datum.location.span;break;case ":":datum=readSymbolOrNumber(str,
i-1);var error=new types.Message([source,":",line.toString(),":","0",": read-syntax: Keyword internment is not supported in WeScheme"]);datum=new unsupportedExpr(datum.val,error,datum.location.span);i+=datum.val.length-1;break;case "&":column++;sexp=readSExpByIndex(str,i+1);var boxCall=new symbolExpr("box"),datum=[boxCall,sexp];i+=sexp.location.span+1;boxCall.location=new Location(startCol,startRow,iStart,i-iStart);break;case "|":i--;datum=readBlockComment(str,i);i+=datum.location.span+1;break;case ";":datum=
readSExpComment(str,i+1);i+=datum.location.span+1;break;case "!":datum=readLineComment(str,i-1);i+=datum.location.span;break;case "`":case ",":case "'":datum=readQuote(str,i);datum.location.startChar--;datum.location.span++;endOfError=i+datum.location.span;var msg=new types.Message([source,":",startRow.toString(),":",(column-1).toString()," read: WeScheme does not support the '#"+p+"' notation for ",p===","?"unsyntax":p==="'"?"syntax":"quasisyntax"]);throwError(msg,datum.location);break;case "<<":datum=
readString(str,i-1);i+=datum.location.span;break;case "e":case "i":case "b":case "o":case "d":case "x":column--;datum=readSymbolOrNumber(str,i-1);i+=datum.location.span-1;break;case "true":case "false":case "t":case "f":if(!matchUntilDelim.exec(nextChar)){datum=new literal(p==="t"||chunk==="true");i+=chunk.length;column+=chunk.length;break}default:endOfError=i;var msg=new types.Message([source,":",line.toString(),":",(column-1).toString(),": read: bad syntax `#",chunk+nextChar,"'"]);throwError(msg,
new Location(startCol,startRow,iStart,(chunk+nextChar).length+1),"Error-GenericReadError")}}}else{endOfError=i;throwError(new types.Message([source,":",line.toString(),":",(column-1).toString(),": read: bad syntax `#'"]),new Location(startCol,startRow,iStart,i-iStart),"Error-GenericReadError")}datum.location=new Location(startCol,startRow,iStart,i-iStart);return datum}function readChar(str,i){var startCol=column,startRow=line,iStart=i;i+=2;column++;var datum="",isFirstChar=true,regexp;while(i<str.length&&
str.slice(i,i+2)!=="#\\"&&!(!isFirstChar&&(isWhiteSpace(str.charAt(i))||isDelim(str.charAt(i))))){isFirstChar=false;column++;datum+=str.charAt(i++)}var special=new RegExp("(backspace|tab|newline|space|vtab)[^a-zA-Z]*","i"),match=special.exec(datum);if(special.test(datum)){datum=datum==="backspace"?"\b":datum==="tab"?"\t":datum==="newline"?"\n":datum==="space"?" ":datum==="vtab"?"\v":"Impossible: unknown special char was matched by special char!";i=iStart+2+match[1].length}else if(/^[0-9].*/.test(datum)&&
oct3.test(datum)&&oct3.exec(datum)[0]===datum&&parseInt(oct3.exec(datum)[0],8)<256&&parseInt(oct3.exec(datum)[0],8)>31){var match=/[0-7]+/.exec(datum)[0];datum=String.fromCharCode(parseInt(match,8));i=iStart+2+match.length}else if(/[uU]/.test(datum)&&(regexp=datum.charAt(0)==="u"?hex4:hex6)&&regexp.test(datum.slice(1))){var match=regexp.exec(datum.slice(1))[0];column+=match.length-datum.length+1;datum=String.fromCharCode(parseInt(match,16));i=iStart+3+match.length}else if(datum.length===1||/[^\u00C0-\u1FFF\u2C00-\uD7FF\w]$/.test(datum.charAt(1))){datum=
datum.charAt(0);i=iStart+3}else throwError(new types.Message([source,":",startRow.toString(),":",(startCol-1).toString(),": read: bad character constant: #\\",datum]),new Location(startCol-1,startRow,iStart,i-iStart),"Error-GenericReadError");var chr=new literal(new types["char"](datum));chr.location=new Location(startCol,startRow,iStart,i-iStart);return chr}function readBlockComment(str,i){var startCol=column,startRow=line,iStart=i;i+=2;column+=2;var txt="";while(i+1<str.length&&!(str.charAt(i)===
"|"&&str.charAt(i+1)==="#")){if(str.charAt(i)==="\n"){line++;column=0}txt+=str.charAt(i);i++;column++}if(i+1>=str.length)throwError(new types.Message(["read: Unexpected EOF when reading a multiline comment"]),new Location(startCol,startRow,iStart,i-iStart));i++;column++;var cmmt=new comment(txt);cmmt.location=new Location(startCol,startRow,iStart,i-iStart);return cmmt}function readSExpComment(str,i){var startCol=column++,startRow=line,iStart=i,nextSExp;while((i=chewWhiteSpace(str,i))&&i+1<str.length&&
(nextSExp=readSExpByIndex(str,i))&&nextSExp instanceof comment)i=nextSExp.location.endChar;if(i+1>=str.length){endOfError=i;throwError(new types.Message([source,":",startRow.toString(),":",(startCol-1).toString(),": read: expected a commented-out element for `#;' (found end-of-file)"]),new Location(startCol-1,startRow,i-2,2),"Error-GenericReadError")}var atom=new comment("("+nextSExp.toString()+")");i=nextSExp.location.endChar;atom.location=new Location(startCol,startRow,iStart,i-iStart);return atom}
function readLineComment(str,i){var startCol=column,startRow=line,iStart=i;i++;column++;var txt="";while(i<str.length&&str.charAt(i)!=="\n"){txt+=str.charAt(i);column++;i++}if(i>str.length){endOfError=i;throwError(new types.Message(["read: Unexpected EOF when reading a line comment"]),new Location(startCol,startRow,iStart,i-iStart))}var atom=new comment(txt);atom.location=new Location(startCol,startRow,iStart,i+1-iStart);line++;column=0;return atom}function readQuote(str,i){var startCol=column,startRow=
line,iStart=i,nextSExp;var p=str.charAt(i);var symbol=p=="'"?new symbolExpr("quote"):p=="`"?new symbolExpr("quasiquote"):"";function eofError(i){endOfError=i+1;var action=p=="'"?" quoting ":p=="`"?" quasiquoting ":p==","?" unquoting ":p==",@"?" unquoting ":"";throwError(new types.Message([source,":",startRow.toString(),":",startCol.toString(),": read: expected an element for"+action,p," (found end-of-file)"]),new Location(startCol,startRow,iStart,p.length),"Error-GenericReadError")}if(i+1>=str.length)eofError(i);
i++;column++;if(p==",")if(str.charAt(i)=="@"){i++;column++;p+="@";symbol=new symbolExpr("unquote-splicing")}else symbol=new symbolExpr("unquote");symbol.location=new Location(column-1,startRow,iStart,i-iStart);while(!nextSExp||nextSExp instanceof comment){i=chewWhiteSpace(str,i);try{nextSExp=readSExpByIndex(str,i)}catch(e){if(/read: \(found end-of-file\)/.test(e))eofError(i);var unexpected=/expected a .* to open ","(.)"/.exec(e);if(unexpected){endOfError=i+1;throwError(new types.Message([source,":",
line.toString(),":",column.toString(),": read: unexpected `"+unexpected[1]+"'"]),new Location(column,line,i,1),"Error-GenericReadError")}throw e;}i=nextSExp.location.end().startChar+1}var quotedSexp=[symbol,nextSExp],quotedSpan=nextSExp.location.end().startChar+1-iStart;quotedSexp.location=new Location(startCol,startRow,iStart,quotedSpan);return quotedSexp}function readSymbolOrNumber(str,i){var startCol=column,startRow=line,iStart=i;var symOrNum=new RegExp("(\\|(.|\\n)*\\||\\\\(.|\\n)|[^\\(\\)\\{\\}\\[\\]\\,\\'\\`\\s\\\"\\;])+",
"mg");var chunk=symOrNum.exec(str.slice(i))[0];var trailingEscs=/\.*\\+$/.exec(chunk);if(trailingEscs&&trailingEscs[0].length%2>0){i=str.length;endOfError=i;throwError(new types.Message([source,":",line.toString(),":",startCol.toString(),": read: EOF following `\\' in symbol"]),new Location(startCol,startRow,iStart,i-iStart),"Error-GenericReadError")}i+=chunk.length;column+=chunk.length;var unescaped="";for(var j=0;j<chunk.length;j++){if(chunk.charAt(j)=="\\")j++;unescaped+=chunk.charAt(j)}var chunks=
unescaped.split("|");if(chunks.length%2===0){endOfError=str.length;var sizeOfLastChunk=chunks[chunks.length-1].length+1,strBeforeLastChunk=chunk.slice(0,chunk.length-sizeOfLastChunk),lastVerbatimMarkerIndex=iStart+strBeforeLastChunk.length;column=startCol;for(var j=0;j<strBeforeLastChunk.length;j++)if(str.charAt(i)==="\n"){line++;column=0}else column++;throwError(new types.Message([source,":",line.toString(),":",column.toString(),": read: unbalanced `|'"]),new Location(column,line,lastVerbatimMarkerIndex,
str.length-lastVerbatimMarkerIndex),"Error-GenericReadError")}var filtered=chunks.reduce(function(acc,str,i){return acc+=i%2||caseSensitiveSymbols?str:str.toLowerCase()},"");if(filtered==="\n"){line++;column=0}var special_chars=new RegExp("^$|[\\(\\)\\{\\}\\[\\]\\,\\'\\`\\s\\\"\\\\]","g");var escaped_nums=new RegExp("^.*\\\\[\\d]*.*|\\|[\\d]*\\|");filtered=escaped_nums.test(chunk)||special_chars.test(filtered)?"|"+filtered+"|":filtered;var node=new symbolExpr(filtered);if(chunks.length===1&&!/^[a-zA-Z\-\?]+$/.test(filtered))try{var numValue=
jsnums.fromString(filtered,true);if(numValue||numValue===0){if(numValue instanceof Object){numValue.stx=filtered;numValue.location=new Location(startCol,startRow,iStart,i-iStart)}node=new literal(numValue)}}catch(e){endOfError=i;var msg=new types.Message([source,":",startRow.toString(),":",startCol.toString(),": read: "+e.message]);throwError(msg,new Location(startCol,startRow,iStart,i-iStart),"Error-GenericReadError")}node.stx=filtered;node.location=new Location(startCol,startRow,iStart,i-iStart);
return node}plt.compiler.lex=function(str,strSource,debug){var start=(new Date).getTime();try{var sexp=readProg(str,strSource)}catch(e){console.log("LEXING ERROR");throw e;}var end=(new Date).getTime();if(debug){console.log("Lexed in "+Math.floor(end-start)+"ms");console.log(sexp);console.log(sexpToString(sexp))}return sexp};plt.compiler.sexpToString=sexpToString})();goog.provide("plt.compiler.parse");goog.require("plt.compiler.literal");goog.require("plt.compiler.symbolExpr");goog.require("plt.compiler.Program");goog.require("plt.compiler.couple");goog.require("plt.compiler.ifExpr");goog.require("plt.compiler.beginExpr");goog.require("plt.compiler.letExpr");goog.require("plt.compiler.letStarExpr");goog.require("plt.compiler.letrecExpr");goog.require("plt.compiler.localExpr");goog.require("plt.compiler.andExpr");goog.require("plt.compiler.orExpr");goog.require("plt.compiler.condExpr");
goog.require("plt.compiler.caseExpr");goog.require("plt.compiler.lambdaExpr");goog.require("plt.compiler.quotedExpr");goog.require("plt.compiler.unquotedExpr");goog.require("plt.compiler.quasiquotedExpr");goog.require("plt.compiler.unquoteSplice");goog.require("plt.compiler.callExpr");goog.require("plt.compiler.whenUnlessExpr");goog.require("plt.compiler.defFunc");goog.require("plt.compiler.defVar");goog.require("plt.compiler.defVars");goog.require("plt.compiler.defStruct");goog.require("plt.compiler.requireExpr");
goog.require("plt.compiler.provideStatement");goog.require("plt.compiler.unsupportedExpr");goog.require("plt.compiler.throwError");window.plt=window.plt||{};plt.compiler=plt.compiler||{};
(function(){var literal=plt.compiler.literal;var symbolExpr=plt.compiler.symbolExpr;var Program=plt.compiler.Program;var couple=plt.compiler.couple;var ifExpr=plt.compiler.ifExpr;var beginExpr=plt.compiler.beginExpr;var letExpr=plt.compiler.letExpr;var letStarExpr=plt.compiler.letStarExpr;var letrecExpr=plt.compiler.letrecExpr;var localExpr=plt.compiler.localExpr;var andExpr=plt.compiler.andExpr;var orExpr=plt.compiler.orExpr;var condExpr=plt.compiler.condExpr;var caseExpr=plt.compiler.caseExpr;var lambdaExpr=
plt.compiler.lambdaExpr;var quotedExpr=plt.compiler.quotedExpr;var unquotedExpr=plt.compiler.unquotedExpr;var quasiquotedExpr=plt.compiler.quasiquotedExpr;var unquoteSplice=plt.compiler.unquoteSplice;var callExpr=plt.compiler.callExpr;var whenUnlessExpr=plt.compiler.whenUnlessExpr;var defFunc=plt.compiler.defFunc;var defVar=plt.compiler.defVar;var defVars=plt.compiler.defVars;var defStruct=plt.compiler.defStruct;var requireExpr=plt.compiler.requireExpr;var provideStatement=plt.compiler.provideStatement;
var unsupportedExpr=plt.compiler.unsupportedExpr;var throwError=plt.compiler.throwError;function isVector(x){return types.isVector(x.val)}function isString(x){return types.isString(x.val)}function isSymbol(x){return x instanceof symbolExpr}function isLiteral(x){return x instanceof literal}function isUnsupported(x){return x instanceof unsupportedExpr}function isCons(x){return x instanceof Array&&x.length>=1}function rest(ls){return ls.slice(1)}function isSymbolEqualTo(x,y){x=x instanceof symbolExpr?
x.val:x;y=y instanceof symbolExpr?y.val:y;return x===y}function parseStar(sexps){function parseSExp(sexp){return isDefinition(sexp)?parseDefinition(sexp):isExpr(sexp)?parseExpr(sexp):isRequire(sexp)?parseRequire(sexp):isProvide(sexp)?parseProvide(sexp):throwError(new types.Message(["Not a Definition, Expression, Library Require, or Provide"]),sexp.location)}return sexps.map(parseSExp)}function parse(sexp){return sexp.length===0?[]:!isCons(sexp)?throwError(new types.Message(["The sexp is not a list of definitions or expressions: "+
sexp]),sexp.location):parseStar(sexp)}function isStructDefinition(sexp){return isCons(sexp)&&isSymbol(sexp[0])&&isSymbolEqualTo("define-struct",sexp[0])}function isOldDefinition(sexp){return isCons(sexp)&&isSymbol(sexp[0])&&isSymbolEqualTo("define",sexp[0])}function isValueDefinition(sexp){return isCons(sexp)&&isSymbol(sexp[0])&&isSymbolEqualTo("define-val",sexp[0])}function isFunDefinition(sexp){return isCons(sexp)&&isSymbol(sexp[0])&&isSymbolEqualTo("define-fun",sexp[0])}function isMultiValueDefinition(sexp){return isCons(sexp)&&
isSymbol(sexp[0])&&isSymbolEqualTo("define-values",sexp[0])}function isDefinition(sexp){return isStructDefinition(sexp)||isOldDefinition(sexp)||isMultiValueDefinition(sexp)||isValueDefinition(sexp)||isFunDefinition(sexp)}function parseDefinition(sexp){function parseDefStruct(sexp){if(sexp.length<2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected the structure name after define-struct, but nothing's there"]),sexp.location);if(!(sexp[1]instanceof symbolExpr))throwError(new types.Message([new types.ColoredPart(sexp[0].val,
sexp[0].location),": expected the structure name after define-struct, but found ",new types.ColoredPart("something else",sexp[1].location)]),sexp.location);if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least one field name (in parentheses) after the ",new types.ColoredPart("structure name",sexp[1].location),", but nothing's there"]),sexp.location);if(!(sexp[2]instanceof Array))throwError(new types.Message([new types.ColoredPart(sexp[0].val,
sexp[0].location),": expected at least one field name (in parentheses) after the ",new types.ColoredPart("structure name",sexp[1].location),", but found ",new types.ColoredPart("something else",sexp[2].location)]),sexp.location);sexp[2].forEach(function(arg){if(!(arg instanceof symbolExpr))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a field name, but found ",new types.ColoredPart("something else",arg.location)]),sexp.location)});if(sexp.length>3){var extraLocs=
sexp.slice(3).map(function(sexp){return sexp.location}),wording1=sexp[2].length===1?"field name":"field names",wording2=extraLocs.length+" extra "+(extraLocs.length===1?"part":"parts");throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected nothing after the ",new types.ColoredPart(wording1,sexp[2].location),", but found ",new types.MultiPart(wording2,extraLocs,false)]),sexp.location)}return new defStruct(parseIdExpr(sexp[1]),sexp[2].map(parseIdExpr),sexp)}function parseMultiDef(sexp){if(sexp.length<
2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expects a list of variables and a body, but found neither"]),sexp.location);if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expects a list of variables and a body, but found only ",new types.ColoredPart("one part",sexp[1].location)]),sexp.location);if(!(sexp[1]instanceof Array))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),
": expects a list of variables and a body, but found ",new types.ColoredPart("something else",sexp[1].location)]),sexp.location);if(sexp.length>3){var extraLocs=sexp.slice(3).map(function(sexp){return sexp.location}),wording=extraLocs.length+" extra "+(extraLocs.length===1?"part":"parts"),msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expects a list of variables and a body"+", but found ",new types.MultiPart(wording,extraLocs,false)]);throwError(msg,sexp.location)}return new defVars(sexp[1].map(parseIdExpr),
parseExpr(sexp[2]),sexp)}function parseOldDef(sexp){if(sexp.length!==3){var extraLocs=sexp.slice(1).map(function(sexp){return sexp.location});var wording=sexp.length<4?" fewer than two":new types.MultiPart("more than two parts",extraLocs,false);throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected exactly two parts for the definition: a name"+" (or a function name and its variables) and an expression"+", but found",wording]),sexp.location)}if(sexp.length>3){var extraLocs=
sexp.slice(1).map(function(sexp){return sexp.location}),wording=extraLocs.length+" parts";throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected exactly two parts, but found",new types.MultiPart(wording,extraLocs,false)]),sexp.location)}if(sexp[1]instanceof Array){if(sexp[1].length===0)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least a function name within ",new types.ColoredPart("the parentheses",sexp[1].location)]),
sexp.location);if(!(sexp[1][0]instanceof symbolExpr))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a function name after the open parenthesis but found ",new types.ColoredPart("something else",sexp[1][0].location)]),sexp.location);sexp[1].forEach(function(arg){if(!(arg instanceof symbolExpr))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a variable name but found ",new types.ColoredPart("something else",
arg.location)]),sexp.location)});if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected an expression for the function body, but nothing's there"]),sexp.location);var args=rest(sexp[1]).map(parseIdExpr);args.location=sexp[1].location;return new defFunc(parseIdExpr(sexp[1][0]),args,parseExpr(sexp[2]),sexp)}if(sexp[1]instanceof symbolExpr){if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected an expression after the variable ",
new types.ColoredPart(sexp[1].val,sexp[1].location)," but nothing's there"]),sexp.location);return new defVar(parseIdExpr(sexp[1]),parseExpr(sexp[2]),sexp)}throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a name (or a function name and its variables) "," and an expression, but found",new types.ColoredPart("something else",sexp[1].location)]),sexp.location)}function parseValueDef(sexp){if(sexp.length!==3){var extraLocs=sexp.slice(1).map(function(sexp){return sexp.location});
var wording=sexp.length<4?" fewer than two":new types.MultiPart("more than two parts",extraLocs,false);throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected exactly two parts for the value: a name and an expression"+", but found",wording]),sexp.location)}if(sexp[1]instanceof symbolExpr){if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected an expression after the name ",new types.ColoredPart(sexp[1].val,
sexp[1].location)," but nothing's there"]),sexp.location);return new defVar(parseIdExpr(sexp[1]),parseExpr(sexp[2]),sexp)}throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a name but found ",new types.ColoredPart("something else",sexp[1].location)]),sexp.location)}function parseFunDef(sexp){if(sexp.length!==3){var extraLocs=sexp.slice(1).map(function(sexp){return sexp.location});var wording=sexp.length<4?" fewer than two":new types.MultiPart("more than two parts",
extraLocs,false);throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected exactly two parts for the function: a header "+"(function name and variables, in parentheses) and a "+"body (any expression), but found",wording]),sexp.location)}if(sexp[1]instanceof Array){if(sexp[1].length===0)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least a function name within ",new types.ColoredPart("the parentheses",sexp[1].location)]),
sexp.location);if(!(sexp[1][0]instanceof symbolExpr))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a function name after the open parenthesis but found ",new types.ColoredPart("something else",sexp[1][0].location)]),sexp.location);sexp[1].forEach(function(arg){if(!(arg instanceof symbolExpr))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a variable name, but found ",new types.ColoredPart("something else",
arg.location)]),sexp.location)});if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected an expression for the function body after ",new types.ColoredPart("the header",sexp[1].location,false),", but nothing's there"]),sexp.location);var args=rest(sexp[1]).map(parseIdExpr);args.location=sexp[1].location;return new defFunc(parseIdExpr(sexp[1][0]),args,parseExpr(sexp[2]),sexp)}throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),
": expected a header (function name and variables, in parentheses)"+" and a body for the function"]),sexp.location)}var def=isStructDefinition(sexp)?parseDefStruct(sexp):isOldDefinition(sexp)?parseOldDef(sexp):isMultiValueDefinition(sexp)?parseMultiDef(sexp):isValueDefinition(sexp)?parseValueDef(sexp):isFunDefinition(sexp)?parseFunDef(sexp):throwError(new types.Message([": expected to find a definition, but found: "+sexp]),sexp.location);def.location=sexp.location;return def}function isExpr(sexp){return!isDefinition(sexp)&&
!isRequire(sexp)&&!isProvide(sexp)}function parseExpr(sexp){return isCons(sexp)?parseExprList(sexp):parseExprSingleton(sexp)}function parseExprList(sexp){function parseFuncCall(sexp){if(isSymbolEqualTo(sexp[0],"unquote"))throwError(new types.Message(["misuse of a comma or 'unquote, not under a quasiquoting backquote"]),sexp.location,"Error-GenericSyntacticError");if(isSymbolEqualTo(sexp[0],"unquote-splicing"))throwError(new types.Message(["misuse of a ,@ or unquote-splicing, not under a quasiquoting backquote"]),
sexp.location,"Error-GenericSyntacticError");if(isSymbolEqualTo(sexp[0],"else"))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp.location),": not allowed ",new types.ColoredPart("here",sexp.location),", because this is not a question in a clause"]),sexp.location);return isCons(sexp)?new callExpr(parseExpr(sexp[0]),rest(sexp).map(parseExpr),sexp[0]):throwError(new types.Message(["function call sexp"]),sexp.location)}function parseLambdaExpr(sexp){if(sexp.length===1)throwError(new types.Message([new types.ColoredPart(sexp[0].val,
sexp[0].location),": expected at least one variable (in parentheses) after lambda, but nothing's there"]),sexp.location);if(!(sexp[1]instanceof Array))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least one variable (in parentheses) after lambda, but found ",new types.ColoredPart("something else",sexp[1].location)]),sexp.location);sexp[1].forEach(function(arg){if(!(arg instanceof symbolExpr)){var msg=new types.Message([new types.ColoredPart(sexp[0].val,
sexp[0].location),": expected a list of variables after lambda, but found ",new types.ColoredPart("something else",arg.location)]);throwError(msg,sexp.location)}});if(sexp.length===2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected an expression for the function body, but nothing's there"]),sexp.location);if(sexp.length>3){var extraLocs=sexp.slice(3).map(function(sexp){return sexp.location}),wording=extraLocs.length+" extra "+(extraLocs.length===1?"part":
"parts"),msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected only one expression for the function body, but found ",new types.MultiPart(wording,extraLocs,false)]);throwError(msg,sexp.location)}var args=sexp[1].map(parseIdExpr);args.location=sexp[1].location;return new lambdaExpr(args,parseExpr(sexp[2]),sexp[0])}function parseLocalExpr(sexp){if(sexp.length===1)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least one definition (in square brackets) after local,"+
" but nothing's there"]),sexp.location);if(!(sexp[1]instanceof Array))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a collection of definitions, but given ",new types.ColoredPart("something else",sexp[1].location)]),sexp[1].location);sexp[1].forEach(function(def){if(!isDefinition(def))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a definition, but given ",new types.ColoredPart("something else",def.location)]),
def.location)});if(sexp.length===2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single body, but found none"]),sexp.location);if(sexp.length>3){var extraLocs=sexp.slice(3).map(function(sexp){return sexp.location}),wording=extraLocs.length+" extra "+(extraLocs.length===1?"part":"parts");throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single body, but found ",new types.MultiPart(wording,extraLocs,false)]),
sexp.location)}return new localExpr(sexp[1].map(parseDefinition),parseExpr(sexp[2]),sexp[0])}function parseLetrecExpr(sexp){if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected an expression after the bindings, but nothing's there"]),sexp.location);if(!(sexp[1]instanceof Array))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a key/value pair, but given ",new types.ColoredPart("something else",sexp[1].location)]),
sexp.location);sexp[1].forEach(function(binding){if(!sexpIsCouple(binding))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a key/value pair, but given ",new types.ColoredPart("something else",binding.location)]),binding.location)});if(sexp.length===2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected an expression after the bindings, but nothing's there"]),sexp.location);if(sexp.length>3){var extraLocs=sexp.slice(3).map(function(sexp){return sexp.location}),
wording=extraLocs.length+" extra "+(extraLocs.length===1?"part":"parts");throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single body, but found ",new types.MultiPart(wording,extraLocs,false)]),sexp.location)}return new letrecExpr(sexp[1].map(parseBinding),parseExpr(sexp[2]),sexp[0])}function parseLetExpr(sexp){if(sexp.length===1)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least one binding (in parentheses) after let, but nothing's there"]),
sexp.location);if(!(sexp[1]instanceof Array))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected sequence of key value pairs, but given ",new types.ColoredPart("something else",sexp[1].location)]),sexp[1].location);sexp[1].forEach(function(binding){if(!sexpIsCouple(binding))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a key/value pair, but given ",new types.ColoredPart("something else",binding.location)]),binding.location)});
if(sexp.length>3){var extraLocs=sexp.slice(3).map(function(sexp){return sexp.location}),wording=extraLocs.length+" extra "+(extraLocs.length===1?"part":"parts");throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single body, but found ",new types.MultiPart(wording,extraLocs,false)]),sexp.location)}if(sexp.length===2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single body, but found none"]),sexp.location);
return new letExpr(sexp[1].map(parseBinding),parseExpr(sexp[2]),sexp)}function parseLetStarExpr(sexp){if(sexp.length===1)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected an expression after the bindings, but nothing's there"]),sexp.location);if(!(sexp[1]instanceof Array)){var msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected sequence of key/value pairs, but given ",new types.ColoredPart("something else",sexp[1].location)]);
throwError(msg,sexp.location)}sexp[1].forEach(function(binding){if(!sexpIsCouple(binding))throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a key/value pair, but given ",new types.ColoredPart("something else",binding.location)]),binding.location)});if(sexp.length===2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single body, but found none"]),sexp.location);if(sexp.length>3){var extraLocs=sexp.slice(3).map(function(sexp){return sexp.location}),
wording=extraLocs.length+" extra "+(extraLocs.length===1?"part":"parts");throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single body, but found ",new types.MultiPart(wording,extraLocs,false)]),sexp.location)}var bindings=sexp[1].map(parseBinding);bindings.location=sexp[1].location;return new letStarExpr(bindings,parseExpr(sexp[2]),sexp[0])}function parseIfExpr(sexp){if(sexp.length<4)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),
": expected a test, a consequence, and an alternative, but all three were not found"]),sexp.location);if(sexp.length>4){var extraLocs=sexp.slice(1).map(function(sexp){return sexp.location});throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected only a test, a consequence, and an alternative, ","but found ",new types.MultiPart("more than three of these",extraLocs,false)]),sexp.location)}return new ifExpr(parseExpr(sexp[1]),parseExpr(sexp[2]),parseExpr(sexp[3]),
sexp[0])}function parseBeginExpr(sexp){if(sexp.length<2){var msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": Inside a begin, expected to find a body, but nothing was found."]);throwError(msg,sexp.location)}return new beginExpr(rest(sexp).map(parseExpr),sexp[0])}function parseAndExpr(sexp){if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least 2 arguments, but given ",sexp.length===1?"0":new types.ColoredPart((sexp.length-
1).toString(),sexp[1].location)]),sexp.location);return new andExpr(rest(sexp).map(parseExpr),sexp[0])}function parseOrExpr(sexp){if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least 2 arguments, but given ",sexp.length===1?"0":new types.ColoredPart((sexp.length-1).toString(),sexp[1].location)]),sexp.location);var orEx=new orExpr(rest(sexp).map(parseExpr),sexp[0]);return orEx}function parseQuotedExpr(sexp){function parseQuotedItem(sexp){return isCons(sexp)?
sexp.map(parseQuotedItem):sexp instanceof Array&&sexp.length===0?sexp:parseExprSingleton(sexp)}if(sexp.length<2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single argument, but did not find one."]),sexp.location);if(sexp.length>2){var extraLocs=sexp.slice(1).map(function(sexp){return sexp.location});throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single argument, but found ",new types.MultiPart("more than one.",
extraLocs,false)]),sexp.location)}return new quotedExpr(parseQuotedItem(sexp[1]))}return function(){var peek=sexp[0];var expr=!isSymbol(peek)?parseFuncCall(sexp):isSymbolEqualTo("\u03bb",peek)?parseLambdaExpr(sexp):isSymbolEqualTo("lambda",peek)?parseLambdaExpr(sexp):isSymbolEqualTo("local",peek)?parseLocalExpr(sexp):isSymbolEqualTo("letrec",peek)?parseLetrecExpr(sexp):isSymbolEqualTo("let",peek)?parseLetExpr(sexp):isSymbolEqualTo("let*",peek)?parseLetStarExpr(sexp):isSymbolEqualTo("cond",peek)?parseCondExpr(sexp):
isSymbolEqualTo("case",peek)?parseCaseExpr(sexp):isSymbolEqualTo("if",peek)?parseIfExpr(sexp):isSymbolEqualTo("begin",peek)?parseBeginExpr(sexp):isSymbolEqualTo("and",peek)?parseAndExpr(sexp):isSymbolEqualTo("or",peek)?parseOrExpr(sexp):isSymbolEqualTo("when",peek)?parseWhenUnlessExpr(sexp):isSymbolEqualTo("unless",peek)?parseWhenUnlessExpr(sexp):isSymbolEqualTo("quote",peek)?parseQuotedExpr(sexp):isSymbolEqualTo("quasiquote",peek)?parseQuasiQuotedExpr(sexp):isSymbolEqualTo("unquote",peek)?parseUnquoteExpr(sexp):
isSymbolEqualTo("unquote-splicing",peek)?parseUnquoteSplicingExpr(sexp):parseFuncCall(sexp);expr.location=sexp.location;return expr}()}function parseWhenUnlessExpr(sexp){if(sexp.length<3)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at a test and at least one result after "+sexp[0]+", but nothing's there"]),sexp.location);var exprs=sexp.slice(2),result=new whenUnlessExpr(parseExpr(sexp[1]),parse(exprs),sexp[0]);exprs.location=exprs[0].location;result.location=
sexp.location;return result}function parseCondExpr(sexp){if(sexp.length===1)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least one clause after cond, but nothing's there"]),sexp.location);var condLocs=[sexp[0].location,sexp.location.start(),sexp.location.end()];function isElseClause(couple){return isSymbol(couple[0])&&isSymbolEqualTo(couple[0],"else")}function checkCondCouple(clause){var clauseLocations=[clause.location.start(),clause.location.end()];
if(!(clause instanceof Array))throwError(new types.Message([new types.MultiPart(sexp[0].val,condLocs,true),": expected a clause with a question and an answer, but found ",new types.ColoredPart("something else",clause.location)]),clause.location);if(clause.length===0)throwError(new types.Message([new types.MultiPart(sexp[0].val,condLocs,true),": expected a clause with a question and an answer, but found an ",new types.MultiPart("empty part",clauseLocations,true)]),clause.location);if(clause.length===
1)throwError(new types.Message([new types.MultiPart(sexp[0].val,condLocs,true),": expected a clause with a question and an answer, but found a ",new types.MultiPart("clause",clauseLocations,true)," with only ",new types.MultiPart("one part",[clause[0].location],false)]),clause.location);if(clause.length>2){var extraLocs=clause.map(function(sexp){return sexp.location}),wording=extraLocs.length+" parts";throwError(new types.Message([new types.MultiPart(sexp[0].val,condLocs,true),": expected a clause with a question and an answer, but found ",
new types.MultiPart("a clause",clauseLocations,true)," with ",new types.MultiPart(wording,extraLocs,false)]),clause.location)}}function parseCondCouple(clause){var test=parseExpr(clause[0]),result=parseExpr(clause[1]),cpl=new couple(test,result);if(plt.compiler.keywords.indexOf(test.val)>-1&&test.val!=="else")throwError(new types.Message([new types.ColoredPart(test.val,test.location),": expected an open parenthesis before ",test.val,", but found none"]),test.location);test.isClause=true;cpl.location=
clause.location;return cpl}rest(sexp).forEach(checkCondCouple);var numClauses=rest(sexp).length,parsedClauses=rest(sexp).map(parseCondCouple);rest(sexp).forEach(function(couple,idx){if(isElseClause(couple)&&idx<numClauses-1)throwError(new types.Message([new types.MultiPart("cond",condLocs,true),": ","found an ",new types.ColoredPart("else clause",couple.location)," that isn't the last clause in its cond expression; there is ",new types.ColoredPart("another clause",sexp[idx+2].location)," after it"]),
couple.location)});return new condExpr(parsedClauses,sexp[0])}function parseCaseExpr(sexp){if(sexp.length===1){var msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least one clause after case, but nothing's there"]);throwError(msg,sexp.location)}var caseLocs=[sexp[0].location,sexp.location.start(),sexp.location.end()];if(sexp.length===2){var msg=new types.Message([new types.MultiPart(sexp[0].val,caseLocs,true),": expected a clause with at least one choice (in parentheses)"+
" and an answer after the expression, but nothing's there"]);throwError(msg,sexp.location)}function checkCaseCouple(clause){var clauseLocations=[clause.location.start(),clause.location.end()];if(!(clause instanceof Array)){var msg=new types.Message([new types.MultiPart(sexp[0].val,caseLocs,true),": expected a clause with at least one choice (in parentheses), but found ",new types.ColoredPart("something else",clause.location)]);throwError(msg,sexp.location)}if(clause.length===0){var msg=new types.Message([new types.MultiPart(sexp[0].val,
caseLocs,true),": expected at least one choice (in parentheses) and an answer, but found an ",new types.ColoredPart("empty part",clause.location)]);throwError(msg,sexp.location)}if(!(clause[0]instanceof Array||clause[0]instanceof symbolExpr&&isSymbolEqualTo(clause[0],"else"))){var msg=new types.Message([new types.MultiPart(sexp[0].val,caseLocs,true),": expected 'else', or at least one choice in parentheses, but found ",new types.ColoredPart("something else",clause.location)]);throwError(msg,sexp.location)}if(clause.length===
1){var msg=new types.Message([new types.MultiPart(sexp[0].val,caseLocs,true),": expected a clause with a question and an answer, but found a ",new types.MultiPart("clause",clauseLocations,true)," with only ",new types.ColoredPart("one part",clause[0].location)]);throwError(msg,sexp.location)}if(clause.length>2){var extraLocs=clause.map(function(sexp){return sexp.location}),wording=extraLocs.length+" parts",msg=new types.Message([new types.MultiPart(sexp[0].val,caseLocs,true),": expected only one expression for the answer in the case clause, but found a ",
new types.MultiPart("clause",clauseLocations,true)," with ",new types.MultiPart(wording,extraLocs,false)]);throwError(msg,sexp.location)}}function isElseClause(sexp){return isSymbol(sexp[0])&&sexp[0].val==="else"}function parseCaseCouple(sexp){var test=isElseClause(sexp)?sexp[0]:new quotedExpr(sexp[0]),result=parseExpr(sexp[1]),cpl=new couple(test,result);test.isClause=true;cpl.location=sexp.location;return cpl}var clauses=sexp.slice(2);clauses.forEach(checkCaseCouple);var numClauses=clauses.length,
parsedClauses=clauses.map(parseCaseCouple);clauses.forEach(function(couple,idx){if(isElseClause(couple)&&idx<numClauses-1){var msg=new types.Message([new types.MultiPart("case",caseLocs,true),": found an ",new types.ColoredPart("else clause",couple.location),"that isn't the last clause in its case expression; there is ",new types.ColoredPart("another clause",sexp[idx+2].location)," after it"]);throwError(msg,sexp.location)}});return new caseExpr(parseExpr(sexp[1]),parsedClauses,sexp[0])}function parseBinding(sexp){if(sexpIsCouple(sexp)){var binding=
new couple(parseIdExpr(sexp[0]),parseExpr(sexp[1]));binding.location=sexp.location;binding.stx=sexp;return binding}else throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a sequence of key/value pairs, but given ",new types.ColoredPart("something else",sexp[0].location)]),sexp.location)}function parseUnquoteExpr(sexp,depth){if(typeof depth==="undefined")throwError(new types.Message(["misuse of a comma or 'unquote, not under a quasiquoting backquote"]),sexp.location,
"Error-GenericSyntacticError");else if(sexp.length!==2)throwError(new types.Message(["Inside an unquote, expected to find a single argument, but found "+(sexp.length-1)]),sexp.location);else if(depth===1){var result=new unquotedExpr(parseExpr(sexp[1]));result.location=sexp[1].location;return result}else if(depth>1){var result=new unquotedExpr(parseQuasiQuotedItem(sexp[1],depth-1));result.location=sexp[1].location;return result}else throwError(new types.Message(["ASSERTION FAILURE: depth should have been undefined, or a natural number"]),
sexp.location)}function parseUnquoteSplicingExpr(sexp,depth){if(typeof depth==="undefined")throwError(new types.Message(["misuse of a ,@ or unquote-splicing, not under a quasiquoting backquote"]),sexp.location,"Error-GenericSyntacticError");else if(sexp.length!==2)throwError(new types.Message(["Inside an unquote-splicing, expected to find a single argument, but found "+(sexp.length-1)]),sexp.location);else if(depth===1){var result=new unquoteSplice(parseExpr(sexp[1]));result.location=sexp[1].location;
return result}else if(depth>1){var result=new unquoteSplice(parseQuasiQuotedItem(sexp[1],depth-1));result.location=sexp[1].location;return result}else throwError(new types.Message(["ASSERTION FAILURE: depth should have been undefined, or a natural number"]),sexp.location)}function parseQuasiQuotedItem(sexp,depth){if(isCons(sexp)&&sexp[0].val==="unquote")return parseUnquoteExpr(sexp,depth);else if(isCons(sexp)&&sexp[0].val==="unquote-splicing")return parseUnquoteSplicingExpr(sexp,depth);else if(isCons(sexp)&&
sexp[0].val==="quasiquote")return parseQuasiQuotedExpr(sexp,depth);else if(isCons(sexp)){var res=sexp.map(function(x){return parseQuasiQuotedItem(x,depth)});res.location=sexp.location;return res}else if(depth===0)return parseExpr(sexp);else return function(){var res=new quotedExpr(sexp);res.location=sexp.location;return res}()}function parseQuasiQuotedExpr(sexp,depth){depth=typeof depth==="undefined"?0:depth;if(sexp.length<2)throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),
": expected a single argument, but did not find one "]),sexp.location);if(sexp.length>2){var extraLocs=sexp.slice(1).map(function(sexp){return sexp.location});throwError(new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a single argument, but found ",new types.MultiPart("more than one.",extraLocs,false)]),sexp.location)}if(isCons(sexp[1])&&isSymbolEqualTo(sexp[1][0],"unquote-splicing"))throwError(new types.Message(["misuse of ,@ or `unquote-splicing' within a quasiquoting backquote"]),
sexp.location);var quoted=parseQuasiQuotedItem(sexp[1],depth+1);quoted.location=sexp[1].location;var result=new quasiquotedExpr(quoted);result.location=sexp.location;return result}function parseVector(sexp){function buildZero(){var lit=new literal(0);lit.location=sexp.location;return lit}var unParsedVector=sexp.val,vals=parseStar(unParsedVector.elts.filter(function(e){return e!==undefined})),last=vals.length===0?buildZero():vals[vals.length-1],elts=unParsedVector.elts.map(function(v){return v===undefined?
last:parseExpr(v)});var vectorFunc=new symbolExpr("vector"),buildVector=new callExpr(vectorFunc,elts);vectorFunc.location=buildVector.location=sexp.location;return buildVector}function parseExprSingleton(sexp){var singleton=isUnsupported(sexp)?sexp:isVector(sexp)?parseVector(sexp):isSymbol(sexp)?sexp:isLiteral(sexp)?sexp:isSymbolEqualTo("quote",sexp)?new quotedExpr(sexp):isSymbolEqualTo("empty",sexp)?new callExpr(new symbolExpr("list"),[]):new callExpr(null,[]);singleton.location=sexp.location;return singleton}
function parseIdExpr(sexp){return isSymbol(sexp)?sexp:throwError(new types.Message(["ID"]),sexp.location)}function isTupleStartingWithOfLength(sexp,symbol,n){return isCons(sexp)&&sexp.length===n&&isSymbol(sexp[0])&&isSymbolEqualTo(sexp[0],symbol)}function sexpIsCouple(sexp){return isCons(sexp)&&sexp.length===2}function sexpIsCondListP(sexp){return isCons(sexp)&&sexp.length>=2&&isSymbol(sexp[0])&&isSymbolEqualTo(sexp[0],"cond")}function isRequire(sexp){return isCons(sexp)&&isSymbol(sexp[0])&&isSymbolEqualTo(sexp[0],
"require")}function parseRequire(sexp){if(sexp.length<2){var msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a module name after `require', but found nothing"]);throwError(msg,sexp.location)}if(sexp[1]instanceof Array&&isSymbolEqualTo(sexp[1][0],"lib")){if(sexp[1].length<3){var partsNum=sexp[1].slice(1).length,partsStr=partsNum+(partsNum===1?" part":" parts"),msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected at least two strings after ",
new types.ColoredPart("lib",sexp[1][0].location)," but found only ",partsStr]);throwError(msg,sexp.location)}rest(sexp[1]).forEach(function(lit){if(!isString(lit)){var msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a string for a library collection, but found ",new types.ColoredPart("something else",str.location)]);throwError(msg,sexp.location)}})}else if(sexp[1]instanceof Array&&isSymbolEqualTo(sexp[1][0],"planet")){var msg=new types.Message([new types.ColoredPart(sexp[0].val,
sexp[0].location),": Importing PLaneT pacakges is not supported at this time"]);throwError(msg,sexp.location)}else if(!(sexp[1]instanceof symbolExpr||isString(sexp[1]))){var msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": expected a module name as a string or a `(lib ...)' form, but found ",new types.ColoredPart("something else",sexp[1].location)]);throwError(msg,sexp.location)}var req=new requireExpr(sexp[1],sexp[0]);req.location=sexp.location;return req}function isProvide(sexp){return isCons(sexp)&&
isSymbol(sexp[0])&&isSymbolEqualTo(sexp[0],"provide")}function parseProvide(sexp){var clauses=rest(sexp).map(function(p){if(p instanceof symbolExpr)return p;if(p instanceof Array&&p.length==2&&p[0]instanceof symbolExpr&&isSymbolEqualTo(p[0],"struct-out")&&p[1]instanceof symbolExpr)return p;var msg=new types.Message([new types.ColoredPart(sexp[0].val,sexp[0].location),": I don't recognize the syntax of this ",new types.ColoredPart("clause",p.location)]);throwError(msg,sexp.location)});var provide=
new provideStatement(clauses,sexp[0]);provide.location=sexp.location;return provide}plt.compiler.parse=function(sexp,debug){var start=(new Date).getTime();try{var AST=parse(sexp);AST.location=sexp.location}catch(e){console.log("PARSING ERROR");throw e;}var end=(new Date).getTime();if(debug){console.log("Parsed in "+Math.floor(end-start)+"ms");console.log(AST)}return AST}})();goog.provide("plt.compiler.topLevelModules");goog.provide("plt.compiler.knownModules");goog.provide("plt.compiler.knownCollections");goog.require("plt.compiler.moduleBinding");goog.require("plt.compiler.functionBinding");goog.require("plt.compiler.constantBinding");window.plt=window.plt||{};plt.compiler=plt.compiler||{};
(function(){var moduleBinding=plt.compiler.moduleBinding;var functionBinding=plt.compiler.functionBinding;var constantBinding=plt.compiler.constantBinding;function makeFunctionBinding(modulePath){return function(binding){binding[3]=binding[3]||[];binding[4]=binding[4]||false;binding[5]=binding[5]||false;return new functionBinding(binding[0],modulePath,binding[1],binding[2],binding[3],binding[4],binding[5])}}var kernelMiscModule=new moduleBinding("moby/runtime/kernel/misc",[["verify-boolean-branch-value",
2],["throw-cond-exhausted-error",1],["'check-operator-is-function",3],["print-values",0]].map(makeFunctionBinding('"moby/runtime/kernel/misc"')));var foreignModule=new moduleBinding("moby/foreign",[["get-js-object",2,false,["android.permission.FOREIGN-FUNCTION-INTERFACE"]]].map(makeFunctionBinding('"moby/foreign"')));var worldEffectsModule=new moduleBinding("world-effects",[["make-effect:none",0,false],["make-effect:beep",0,false,["android.permission.VIBRATE"]],["make-effect:play-dtmf-tone",2,false],
["make-effect:send-sms",2,false,["android.permission.SEND-SMS"]],["make-effect:play-sound",1,false,["android.permission.INTERNET"]],["make-effect:stop-sound",1,false],["make-effect:pause-sound",1,false],["make-effect:set-sound-volume",1,false],["make-effect:set-beep-volume",1,false],["make-effect:raise-sound-volume",0,false],["make-effect:lower-sound-volume",1,false],["make-effect:set-wake-lock",1,false,["android.permission.WAKE-LOCK"]],["make-effect:release-wake-lock",1,false,["android.permission.WAKE-LOCK"]],
["make-effect:pick-playlist",1,false],["make-effect:pick-random",2,false]].map(makeFunctionBinding('"moby/world-effects"')));var worldHandlersModule=new moduleBinding("world-config",[["on-tick",1,true],["initial-effect",1,false],["on-key",1,false],["on-key!",2,false],["on-mouse",1,false],["on-tap",1,false],["on-tilt",1,false],["on-redraw",1,false],["to-draw",1,false],["on-draw",2,false],["stop-when",1,false]].map(makeFunctionBinding('"moby/world-handlers"')));var bootstrapTeachpackFunctions=[["START",
14,false],["test-frame",1,false],["sine",1,false],["cosine",1,false],["tangent",1,false]];var bootstrapTeachpack=new moduleBinding("bootstrap/bootstrap-teachpack",bootstrapTeachpackFunctions.map(makeFunctionBinding('"bootstrap/bootstrap-teachpack"'))),bootstrapTeachpack2011=new moduleBinding("bootstrap2011/bootstrap-teachpack",bootstrapTeachpackFunctions.map(makeFunctionBinding('"bootstrap2011/bootstrap-teachpack"'))),bootstrapTeachpack2012=new moduleBinding("bootstrap2012/bootstrap-teachpack",bootstrapTeachpackFunctions.map(makeFunctionBinding('"bootstrap2012/bootstrap-teachpack"'))),
bootstrapTiltTeachpack2012=new moduleBinding("bootstrap2012/bootstrap-tilt-teachpack",bootstrapTeachpackFunctions.map(makeFunctionBinding('"bootstrap2012/bootstrap-tilt-teachpack"'))),bootstrapTeachpack2014=new moduleBinding("bootstrap2014/bootstrap-teachpack",bootstrapTeachpackFunctions.map(makeFunctionBinding('"bootstrap2014/bootstrap-teachpack"'))),bootstrapTiltTeachpack2014=new moduleBinding("bootstrap2014/bootstrap-tilt-teachpack",bootstrapTeachpackFunctions.map(makeFunctionBinding('"bootstrap2014/bootstrap-tilt-teachpack"'))),
bootstrapTeachpack2015=new moduleBinding("bootstrap2015/bootstrap-teachpack",bootstrapTeachpackFunctions.map(makeFunctionBinding('"bootstrap2015/bootstrap-teachpack"'))),bootstrapTiltTeachpack2015=new moduleBinding("bootstrap2015/bootstrap-tilt-teachpack",bootstrapTeachpackFunctions.map(makeFunctionBinding('"bootstrap2015/bootstrap-tilt-teachpack"')));var cageTeachpack=new moduleBinding("bootstrap/cage-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap/cage-teachpack"'))),cageTeachpack2011=
new moduleBinding("bootstrap2011/cage-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap2011/cage-teachpack"'))),cageTeachpack2012=new moduleBinding("bootstrap2012/cage-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap2012/cage-teachpack"'))),cageTeachpack2014=new moduleBinding("bootstrap2014/cage-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap2014/cage-teachpack"')));cageTeachpack2015=new moduleBinding("bootstrap2015/cage-teachpack",[["start",1,
false]].map(makeFunctionBinding('"bootstrap2015/cage-teachpack"')));var booleanTeachpackFunctions=[["start",1,false],["continent?",1,false],["primary-color?",1,false],["less-than-one?",1,false]];var booleanTeachpack2020=new moduleBinding("bootstrap2020/boolean-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap2020/boolean-teachpack"')));var functionTeachpack=new moduleBinding("bootstrap/function-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap/function-teachpack"'))),
functionTeachpack2011=new moduleBinding("bootstrap2011/function-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap2011/function-teachpack"'))),functionTeachpack2012=new moduleBinding("bootstrap2012/function-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap2012/function-teachpack"'))),functionTeachpack2014=new moduleBinding("bootstrap2014/function-teachpack",[["start",1,false]].map(makeFunctionBinding('"bootstrap2014/function-teachpack"'))),functionTeachpack2015=new moduleBinding("bootstrap2015/function-teachpack",
[["start",1,false]].map(makeFunctionBinding('"bootstrap2015/function-teachpack"')));var locationModule=new moduleBinding("location",[["get-latitude",0,false,["android.permission.LOCATION"]],["get-longitude",0,false,["android.permission.LOCATION"]],["get-altitude",0,false,["android.permission.LOCATION"]],["get-bearing",0,false,["android.permission.LOCATION"]],["get-speed",0,false,["android.permission.LOCATION"]],["location-distance",0,false,["android.permission.LOCATION"]]].map(makeFunctionBinding('"moby/geolocation"')));
var tiltModule=new moduleBinding("tilt",[["get-x-acceleration",0,false,["android.permission.TILT"]],["get-y-acceleration",0,false,["android.permission.TILT"]],["get-z-acceleration",0,false,["android.permission.TILT"]],["get-azimuth",0,false,["android.permission.TILT"]],["get-pitch",0,false,["android.permission.TILT"]],["get-roll",0,false,["android.permission.TILT"]]].map(makeFunctionBinding('"moby/tilt"')));var telephonyModule=new moduleBinding("telephony",[["get-signal-strength",0,false,["android.permission.TELEPHONY"]]].map(makeFunctionBinding('"moby/net"')));
var netModule=new moduleBinding("net",[["get-url",1,false,["android.permission.INTERNET"]]].map(makeFunctionBinding('"moby/net"')));var parserModule=new moduleBinding("parser",[["xml->s-sexp",1,false]].map(makeFunctionBinding('"moby/parser"')));var jsWorldModule=new moduleBinding("jsworld",[["js-big-bang",1,false],["big-bang",1,false],["js-div",0,false],["js-p",0,false],["js-button",2,false],["js-button!",2,false],["js-node",1,false],["js-text",1,false],["js-select",2,false],["js-img",1,false,["android.permission.INTERNET"]]].map(makeFunctionBinding('"moby/jsworld"')));
var worldModule=new moduleBinding("world",worldHandlersModule.bindings.concat(worldEffectsModule.bindings,["key=?","play-sound","animate","big-bang","make-color","color?","color-red","color-green","color-blue","color-alpha","empty-scene","empty-image","scene+line","put-image", "translate", "place-image","place-image/align","circle","star","polygon","radial-star","star-polygon","nw:rectangle","rectangle","regular-polygon","rhombus","square","triangle","triangle/sas","triangle/sss","triangle/ass","triangle/ssa",
"triangle/aas","triangle/asa","triangle/saa","right-triangle","isosceles-triangle","ellipse","line","add-line","add-polygon","overlay","overlay/xy","overlay/align","underlay","underlay/xy","underlay/align","beside","beside/align","above","above/align","rotate","scale","scale/xy","crop","frame","flip-horizontal","flip-vertical","reflect-x","reflect-y","text","text/font","video/url","bitmap/url","image-url","image?","image=?","image-width","image-height","mouse-event?","mouse=?","image->color-list",
"color-list->image","color-list->bitmap","image-baseline","mode?","image-color?","name->color","x-place?","y-place?","angle?","side-count?","step-count?"].map(function(binding){var needsPermission=["video/url","bitmap/url","image-url"];var permissions=needsPermission.indexOf(binding)>-1?["android.permission.INTERNET"]:[];return new constantBinding(binding,'"moby/world"',permissions,false)})));var topLevelModule=new moduleBinding("moby/topLevel",[["<",2,true],["<=",2,true],["=",2,true],[">",2,true],
[">=",2,true],["<>",2,true],["=~",3],["number->string",1],["even?",1],["odd?",1],["positive?",1],["negative?",1],["number?",1],["rational?",1],["quotient",2],["remainder",2],["numerator",1],["denominator",1],["integer?",1],["real?",1],["abs",1],["acos",1],["add1",1],["angle",1],["asin",1],["atan",1,true],["ceiling",1],["complex?",1],["conjugate",1],["cos",1],["cosh",1],["denominator",1],["even?",1],["exact->inexact",1],["exact?",1],["exp",1],["expt",2],["floor",1],["gcd",1,true],["imag-part",1],["inexact->exact",
1],["inexact?",1],["integer->char",1],["integer-sqrt",1],["integer?",1],["lcm",1,true],["log",1],["magnitude",1],["make-polar",2],["make-rectangular",2],["max",1,true],["min",1,true],["modulo",2],["negative?",1],["number?",1],["numerator",1],["odd?",1],["positive?",1],["random",1],["rational?",1],["real-part",1],["real?",1],["round",1],["sgn",1],["sin",1],["sinh",1],["sqr",1],["sqrt",1],["nth-root",2],["sub1",1],["tan",1],["zero?",1],["+",0,true],["-",1,true],["*",0,true],["/",1,true],["not",1],["false?",
1],["boolean?",1],["boolean=?",2],["symbol->string",1],["symbol=?",2],["symbol?",1],["append",0,true],["assq",2],["assv",2],["assoc",2],["caaar",1],["caadr",1],["caar",1],["cadar",1],["cadddr",1],["caddr",1],["cadr",1],["car",1],["cddar",1],["cdddr",1],["cddr",1],["cdr",1],["cdaar",1],["cdadr",1],["cdar",1],["cons?",1],["list?",1],["cons",2],["empty?",1],["length",1],["list",0,true],["list*",1,true],["range",3],["list-ref",2],["remove",2],["remove-all",2],["member",2],["member?",2],["memq",2],["memv",
2],["null?",1],["pair?",1],["rest",1],["reverse",1],["first",1],["second",1],["third",1],["fourth",1],["fifth",1],["sixth",1],["seventh",1],["eighth",1],["make-list",2],["box",1],["unbox",1],["set-box!",2],["box?",1],["make-posn",2],["posn-x",1],["posn-y",1],["posn?",1],["char->integer",1],["char-alphabetic?",1],["char-ci<=?",2,true],["char-ci<?",2,true],["char-ci=?",2,true],["char-ci>=?",2,true],["char-ci>?",2,true],["char-downcase",1],["char-lower-case?",1],["char-numeric?",1],["char-upcase",1],
["char-upper-case?",1],["char-whitespace?",1],["char<=?",2,true],["char<?",2,true],["char=?",2,true],["char>=?",2,true],["char>?",2,true],["char?",1],["format",1,true],["list->string",1],["make-string",2],["replicate",2],["string",0,true],["string->list",1],["string->number",1],["string->symbol",1],["string-alphabetic?",1],["string-append",0,true],["string-contains?",2],["string-ci<=?",2,true],["string-ci<?",2,true],["string-ci=?",2,true],["string-ci<>?",2,true],["string-ci>=?",2,true],["string-ci>?",
2,true],["string-copy",1],["string-length",1],["string-lower-case?",1],["string-numeric?",1],["string-ref",2],["string-upper-case?",1],["string-whitespace?",1],["string<=?",2,true],["string<?",2,true],["string=?",2,true],["string<>?",2,true],["string>=?",2,true],["string>?",2,true],["string?",1],["substring",3],["string-ith",2],["int->string",1],["string->int",1],["explode",1],["implode",1],["eof-object?",1],["=~",3],["eq?",2],["equal?",2],["equal~?",3],["eqv?",2],["error",2],["identity",1],["struct?",
1],["current-seconds",0],["andmap",1,true],["apply",2,true],["argmax",2],["argmin",2],["build-list",2],["build-string",2],["compose",0,true],["filter",2],["foldl",2,true],["foldr",2,true],["map",1,true],["for-each",1,true],["memf",2],["ormap",1,true],["procedure?",1],["quicksort",2],["sort",2],["void",0,true],["xml->s-exp",1],["build-vector",2],["make-vector",1,true],["vector",0,true],["vector-length",1],["vector-ref",2],["vector-set!",3],["vector->list",1],["list->vector",1],["vector?",1],["printf",
1,true],["display",1],["write",1],["newline",0],["call/cc",1],["procedure-arity",1],["check-expect",2],["EXAMPLE",2],["check-within",3],["check-error",2],["make-hasheq",0],["make-hash",0],["hash-set!",3],["hash-ref",3],["hash-remove!",2],["hash-map",2],["hash-for-each",2],["hash?",1],["raise",1],["undefined?",1],["values",0,true],["make-struct-type",4,true],["make-struct-field-accessor",2,true],["make-struct-field-mutator",2,true],["current-continuation-marks",0,false],["continuation-mark-set->list",
2,false],["scheme->prim-js",1,false],["prim-js->scheme",1,false],["procedure->cps-js-fun",1,false],["procedure->void-js-fun",1,false],["js-===",2,false],["js-get-named-object",1,false],["js-get-field",2,true],["js-set-field!",3,false],["js-typeof",1,false],["js-instanceof",2,false],["js-call",2,true],["js-new",1,true],["js-make-hash",0,true],["make-world-config",2,true],["make-bb-info",2,false],["bb-info?",1,false],["bb-info-change-world",1,false],["bb-info-toplevel-node",1,false],["make-effect-type",
4,true],["effect?",1,false],["world-with-effects",2,false],["make-render-effect-type",4,true],["render-effect-type?",1],["render-effect?",1],["make-render-effect-type",4,true],["values",0,true],["sleep",0,true],["current-inexact-milliseconds",0,false],["make-exn",2,false],["exn-message",1,false],["exn-continuation-marks",1,false]].map(makeFunctionBinding('"moby/toplevel"')));plt.compiler.topLevelModules=[topLevelModule,kernelMiscModule,,jsWorldModule,worldModule];plt.compiler.knownCollections=["bootstrap",
"bootstrap2011","bootstrap2012","bootstrap2014","bootstrap2015","bootstrap2020"];plt.compiler.knownModules=[kernelMiscModule,jsWorldModule,foreignModule,worldModule,bootstrapTeachpack,bootstrapTeachpack2011,bootstrapTeachpack2012,bootstrapTeachpack2014,bootstrapTeachpack2015,bootstrapTiltTeachpack2012,bootstrapTiltTeachpack2014,bootstrapTiltTeachpack2015,cageTeachpack,cageTeachpack2011,cageTeachpack2012,cageTeachpack2014,cageTeachpack2015,booleanTeachpack2020,functionTeachpack,functionTeachpack2011,
functionTeachpack2012,functionTeachpack2014,functionTeachpack2015,locationModule,tiltModule,telephonyModule,netModule,parserModule,topLevelModule]})();goog.provide("plt.compiler.desugar");goog.provide("plt.compiler.analyze");goog.require("plt.compiler.literal");goog.require("plt.compiler.symbolExpr");goog.require("plt.compiler.Program");goog.require("plt.compiler.couple");goog.require("plt.compiler.ifExpr");goog.require("plt.compiler.beginExpr");goog.require("plt.compiler.letExpr");goog.require("plt.compiler.letStarExpr");goog.require("plt.compiler.letrecExpr");goog.require("plt.compiler.localExpr");goog.require("plt.compiler.andExpr");goog.require("plt.compiler.orExpr");
goog.require("plt.compiler.condExpr");goog.require("plt.compiler.caseExpr");goog.require("plt.compiler.lambdaExpr");goog.require("plt.compiler.quotedExpr");goog.require("plt.compiler.unquotedExpr");goog.require("plt.compiler.quasiquotedExpr");goog.require("plt.compiler.unquoteSplice");goog.require("plt.compiler.callExpr");goog.require("plt.compiler.whenUnlessExpr");goog.require("plt.compiler.defFunc");goog.require("plt.compiler.defVar");goog.require("plt.compiler.defVars");goog.require("plt.compiler.defStruct");
goog.require("plt.compiler.requireExpr");goog.require("plt.compiler.provideStatement");goog.require("plt.compiler.unsupportedExpr");goog.require("plt.compiler.structBinding");goog.require("plt.compiler.constantBinding");goog.require("plt.compiler.functionBinding");goog.require("plt.compiler.moduleBinding");goog.require("plt.compiler.knownModules");goog.require("plt.compiler.throwError");window.plt=window.plt||{};plt.compiler=plt.compiler||{};
(function(){var literal=plt.compiler.literal;var symbolExpr=plt.compiler.symbolExpr;var Program=plt.compiler.Program;var couple=plt.compiler.couple;var ifExpr=plt.compiler.ifExpr;var beginExpr=plt.compiler.beginExpr;var letExpr=plt.compiler.letExpr;var letStarExpr=plt.compiler.letStarExpr;var letrecExpr=plt.compiler.letrecExpr;var localExpr=plt.compiler.localExpr;var andExpr=plt.compiler.andExpr;var orExpr=plt.compiler.orExpr;var condExpr=plt.compiler.condExpr;var caseExpr=plt.compiler.caseExpr;var lambdaExpr=
plt.compiler.lambdaExpr;var quotedExpr=plt.compiler.quotedExpr;var unquotedExpr=plt.compiler.unquotedExpr;var quasiquotedExpr=plt.compiler.quasiquotedExpr;var unquoteSplice=plt.compiler.unquoteSplice;var callExpr=plt.compiler.callExpr;var whenUnlessExpr=plt.compiler.whenUnlessExpr;var defFunc=plt.compiler.defFunc;var defVar=plt.compiler.defVar;var defVars=plt.compiler.defVars;var defStruct=plt.compiler.defStruct;var requireExpr=plt.compiler.requireExpr;var provideStatement=plt.compiler.provideStatement;
var unsupportedExpr=plt.compiler.unsupportedExpr;var throwError=plt.compiler.throwError;var structBinding=plt.compiler.structBinding;var constantBinding=plt.compiler.constantBinding;var functionBinding=plt.compiler.functionBinding;var moduleBinding=plt.compiler.moduleBinding;var knownModules=plt.compiler.knownModules;function checkDuplicateIdentifiers(lst,stx,loc){var visitedIds={};lst.forEach(function(id){if(!(id instanceof symbolExpr))throwError("expected identifier "+id.val,id.location);else if(visitedIds[id.val])throwError(new types.Message([new types.ColoredPart(stx.toString(),
stx.location),": found ",new types.ColoredPart("a variable",id.location)," that is already used ",new types.ColoredPart("here",visitedIds[id.val].location)]),id.location);else visitedIds[id.val]=id})}function tagApplicationOperator_Module(application,moduleName){var module=plt.compiler.defaultModuleResolver(moduleName),env=(new plt.compiler.emptyEnv).extendEnv_moduleBinding(module);[application.func].concat(application.args).forEach(function(expr){expr.context=env});return application}function forceBooleanContext(stx,
loc,boolExpr){stx=new literal(new types.string(stx.toString()));var verifyCall=new symbolExpr("verify-boolean-branch-value"),stxQuote=new quotedExpr(stx),locQuote=new quotedExpr(new literal(loc.toVector())),boolLocQuote=new quotedExpr(new literal(boolExpr.location.toVector())),runtimeCall=new callExpr(verifyCall,[stxQuote,locQuote,boolExpr,boolLocQuote]);runtimeCall.location=verifyCall.location=boolExpr.location;stxQuote.location=locQuote.location=boolLocQuote.location=boolExpr.location;tagApplicationOperator_Module(runtimeCall,
"moby/runtime/kernel/misc");return runtimeCall}function desugarProgram(programs,pinfo,isTopLevelExpr){var acc=[[],pinfo||new plt.compiler.pinfo];var res=programs.reduce(function(acc,p){var desugaredAndPinfo=p.desugar(acc[1]);if(plt.compiler.isExpression(p)&&isTopLevelExpr){var printValues=new symbolExpr("print-values"),printCall=new callExpr(printValues,[desugaredAndPinfo[0]]);printValues.location=printCall.location=desugaredAndPinfo[0].location;desugaredAndPinfo[0]=printCall;tagApplicationOperator_Module(printCall,
"moby/runtime/kernel/misc")}if(desugaredAndPinfo[0].length)acc[0]=acc[0].concat(desugaredAndPinfo[0]);else acc[0].push(desugaredAndPinfo[0]);return[acc[0],desugaredAndPinfo[1]]},acc);res[0].location=programs.location;return res}Program.prototype.desugar=function(pinfo){return[this,pinfo]};defFunc.prototype.desugar=function(pinfo){checkDuplicateIdentifiers([this.name].concat(this.args),this.stx[0],this.location);this.args.forEach(function(arg){if(!(arg instanceof symbolExpr))throwError(new types.Message([new types.ColoredPart(this.stx.val,
this.stx.location),": expected a variable but found ",new types.ColoredPart("something else",arg.location)]),sexp.location)});var bodyAndPinfo=this.body.desugar(pinfo),newDefFunc=new defFunc(this.name,this.args,bodyAndPinfo[0],this.stx);newDefFunc.location=this.location;return[newDefFunc,bodyAndPinfo[1]]};defVar.prototype.desugar=function(pinfo){if(this.expr instanceof lambdaExpr){var newDefFunc=new defFunc(this.name,this.expr.args,this.expr.body,this.stx);newDefFunc.location=this.location;return newDefFunc.desugar(pinfo)}else{var exprAndPinfo=
this.expr.desugar(pinfo),newDefVar=new defVar(this.name,exprAndPinfo[0],this.stx);newDefVar.location=this.location;return[newDefVar,exprAndPinfo[1]]}};defVars.prototype.desugar=function(pinfo){var exprAndPinfo=this.expr.desugar(pinfo),newDefVars=new defVars(this.names,exprAndPinfo[0],this.stx);newDefVars.location=this.location;return[newDefVars,exprAndPinfo[1]]};defStruct.prototype.desugar=function(pinfo){var that=this,ids=["make-"+this.name.val,this.name.val+"?",this.name.val+"-ref",this.name.val+
"-set!"],idSymbols=ids.map(function(id){return new symbolExpr(id)}),makeStructTypeFunc=new symbolExpr("make-struct-type"),makeStructTypeArgs=[new quotedExpr(new symbolExpr(this.name.val)),new literal(false),new literal(this.fields.length),new literal(0)],makeStructTypeCall=new callExpr(makeStructTypeFunc,makeStructTypeArgs);[makeStructTypeCall,makeStructTypeFunc].concat(idSymbols,makeStructTypeArgs).forEach(function(p){p.location=that.location});var defineValuesStx=new defVars([this.name].concat(idSymbols),
makeStructTypeCall,this.stx),stxs=[defineValuesStx];defineValuesStx.location=this.location;function makeAccessorDefn(f,i){var makeFieldFunc=new symbolExpr("make-struct-field-accessor"),makeFieldArgs=[new symbolExpr(that.name.val+"-ref"),new literal(i),new quotedExpr(new symbolExpr(f.val))],makeFieldCall=new callExpr(makeFieldFunc,makeFieldArgs),accessorSymbol=new symbolExpr(that.name.val+"-"+f.val),defineVar=new defVar(accessorSymbol,makeFieldCall);[defineVar,makeFieldFunc,makeFieldCall,accessorSymbol].concat(makeFieldArgs).forEach(function(p){p.location=
f.location});stxs.push(defineVar)}this.fields.forEach(makeAccessorDefn);return[stxs,pinfo]};beginExpr.prototype.desugar=function(pinfo){var exprsAndPinfo=desugarProgram(this.exprs,pinfo),newBeginExpr=new beginExpr(exprsAndPinfo[0],this.stx);newBeginExpr.location=this.location;return[newBeginExpr,exprsAndPinfo[1]]};lambdaExpr.prototype.desugar=function(pinfo){if(this.stx)checkDuplicateIdentifiers(this.args,this.stx,this.location);var bodyAndPinfo=this.body.desugar(pinfo),newLambdaExpr=new lambdaExpr(this.args,
bodyAndPinfo[0],this.stx);newLambdaExpr.location=this.location;return[newLambdaExpr,bodyAndPinfo[1]]};localExpr.prototype.desugar=function(pinfo){var defnsAndPinfo=desugarProgram(this.defs,pinfo),exprAndPinfo=this.body.desugar(defnsAndPinfo[1]),newLocalExpr=new localExpr(defnsAndPinfo[0],exprAndPinfo[0],this.stx);newLocalExpr.location=this.location;return[newLocalExpr,exprAndPinfo[1]]};callExpr.prototype.desugar=function(pinfo){if(!this.func)throwError(new types.Message([new types.ColoredPart("( )",
this.location),": expected a function, but nothing's there"]),this.location);var exprsAndPinfo=desugarProgram([this.func].concat(this.args),pinfo),newCallExpr=new callExpr(exprsAndPinfo[0][0],exprsAndPinfo[0].slice(1),this.stx);newCallExpr.location=this.location;return[newCallExpr,exprsAndPinfo[1]]};ifExpr.prototype.desugar=function(pinfo){var exprsAndPinfo=desugarProgram([this.predicate,this.consequence,this.alternative],pinfo),predicate=forceBooleanContext(this.stx,this.stx.location,exprsAndPinfo[0][0]),
consequence=exprsAndPinfo[0][1],alternative=exprsAndPinfo[0][2],newIfExpr=new ifExpr(predicate,consequence,alternative,this.stx);newIfExpr.location=this.location;return[newIfExpr,exprsAndPinfo[1]]};whenUnlessExpr.prototype.desugar=function(pinfo){var begin_exp=new beginExpr(this.exprs,this.stx),void_exp=new symbolExpr("void"),call_exp=new callExpr(void_exp,[],this.stx),consequence=this.stx.val==="when"?begin_exp:call_exp,alternative=this.stx.val==="when"?call_exp:begin_exp;begin_exp.location=this.exprs.location;
void_exp.location=call_exp.location=this.location;var exprsAndPinfo=desugarProgram([this.predicate,consequence,alternative],pinfo),if_exp=new ifExpr(exprsAndPinfo[0][0],exprsAndPinfo[0][1],exprsAndPinfo[0][2],this.stx);if_exp.location=this.location;return[if_exp,exprsAndPinfo[1]]};letrecExpr.prototype.desugar=function(pinfo){function bindingToDefn(b){var def=new defVar(b.first,b.second,b.stx);def.location=b.location;return def}var localAndPinfo=(new localExpr(this.bindings.map(bindingToDefn),this.body,
this.stx)).desugar(pinfo);localAndPinfo[0].location=this.location;return localAndPinfo};letExpr.prototype.desugar=function(pinfo){function coupleFirst(x){return x.first}function coupleSecond(x){return x.second}var ids=this.bindings.map(coupleFirst),exprs=this.bindings.map(coupleSecond),lambda=new lambdaExpr(ids,this.body,this.stx),call=new callExpr(lambda,exprs);lambda.location=call.location=this.location;return call.desugar(pinfo)};letStarExpr.prototype.desugar=function(pinfo){function bindingToLet(body,
binding){var let_exp=new letExpr([binding],body,binding.stx);let_exp.location=binding.location;return let_exp}if(this.bindings.length===0)return this.body.desugar(pinfo);else return this.bindings.reduceRight(bindingToLet,this.body).desugar(pinfo)};condExpr.prototype.desugar=function(pinfo){var condExhausted=new symbolExpr("throw-cond-exhausted-error"),exhaustedLoc=new quotedExpr(new literal(this.location.toVector())),expr=tagApplicationOperator_Module(new callExpr(condExhausted,[exhaustedLoc]),"moby/runtime/kernel/misc");
var ifStx=new symbolExpr("if");ifStx.location=this.stx.location;expr.location=condExhausted.location=exhaustedLoc.location=this.location;for(var i=this.clauses.length-1;i>-1;i--){if(this.clauses[i].first instanceof symbolExpr&&this.clauses[i].first.val==="else")this.clauses[i].first.val="true";expr=new ifExpr(this.clauses[i].first,this.clauses[i].second,expr,this.stx);expr.location=this.location}return expr.desugar(pinfo)};caseExpr.prototype.desugar=function(pinfo){var that=this,caseStx=new symbolExpr("if");
caseStx.location=that.location;var pinfoAndValSym=pinfo.gensym("val"),updatedPinfo1=pinfoAndValSym[0],valStx=pinfoAndValSym[1];var pinfoAndXSym=updatedPinfo1.gensym("x"),updatedPinfo2=pinfoAndXSym[0],xStx=pinfoAndXSym[1],voidStx=new symbolExpr("void");var stxs=[valStx,xStx,voidStx];var expr,clauses=this.clauses,lastClause=clauses[this.clauses.length-1];if(lastClause.first instanceof symbolExpr&&lastClause.first.val==="else"){expr=lastClause.second;clauses.pop()}else{expr=new callExpr(voidStx,[],that.stx);
expr.location=that.location}var equalStx=new symbolExpr("equal?"),equalTestStx=new callExpr(equalStx,[xStx,valStx],caseStx),predicateStx=new lambdaExpr([xStx],equalTestStx,caseStx);stxs=stxs.concat([equalStx,equalTestStx,predicateStx]);function processClause(base,clause){var ormapStx=new symbolExpr("ormap"),callStx=new callExpr(ormapStx,[predicateStx,clause.first],that.stx),ifStx=new ifExpr(callStx,clause.second,base,caseStx);stxs=stxs.concat([ormapStx,callStx,clause.first,ifStx]);return ifStx}var binding=
new couple(valStx,this.expr),body=clauses.reduceRight(processClause,expr),letExp=new letExpr([binding],body,caseStx);stxs=stxs.concat([binding,letExp]);stxs.forEach(function(stx){stx.location=that.location});return letExp.desugar(updatedPinfo2)};andExpr.prototype.desugar=function(pinfo){var that=this,ifStx=new symbolExpr("if"),exprsAndPinfo=desugarProgram(this.exprs,pinfo),exprs=exprsAndPinfo[0],pinfo=exprsAndPinfo[1];function desugarAndExprs(exprs){var predicate=forceBooleanContext(that.stx,that.stx.location,
exprs[0]),consequence=exprs.length>2?desugarAndExprs(exprs.slice(1)):forceBooleanContext(that.stx,that.stx.location,exprs[1]),alternative=new literal(false),ifLink=new ifExpr(predicate,consequence,alternative,ifStx),stxs=[alternative,ifStx,ifLink];stxs.forEach(function(stx){return stx.location=that.location});return ifLink}var ifChain=desugarAndExprs(exprs);ifChain.location=that.location;return[ifChain,pinfo]};orExpr.prototype.desugar=function(pinfo){var that=this,orStx=new symbolExpr("or"),exprsAndPinfo=
desugarProgram(this.exprs,pinfo),exprs=exprsAndPinfo[0],pinfo=exprsAndPinfo[1];function desugarOrExprs(exprs,pinfo){var firstExpr=exprs[0],exprLoc=firstExpr.location,pinfoAndTempSym=pinfo.gensym("tmp"),firstExprSym=pinfoAndTempSym[1],ifStx=new symbolExpr("if");firstExprSym.notOriginalSource=true;if(firstExpr.stx&&firstExpr.stx.val!=="if"){ifStx.location=firstExpr.location;firstExpr.stx=ifStx}var pinfo=pinfoAndTempSym[0],tmpBinding=new couple(firstExprSym,forceBooleanContext(that.stx,that.stx.location,
firstExpr)),secondExpr;if(exprs.length==2)secondExpr=forceBooleanContext(orStx,that.stx.location,exprs[1]);else{var secondExprAndPinfo=desugarOrExprs(exprs.slice(1),pinfo);secondExpr=secondExprAndPinfo[0];pinfo=secondExprAndPinfo[1]}var if_exp=new ifExpr(firstExprSym,firstExprSym,secondExpr,new symbolExpr("if")),let_exp=new letExpr([tmpBinding],if_exp,orStx),stxs=[orStx,firstExprSym,tmpBinding,if_exp,if_exp.stx,let_exp];stxs.forEach(function(stx){return stx.location=that.location});return let_exp.desugar(pinfo)}
return desugarOrExprs(exprs,pinfo)};quotedExpr.prototype.desugar=function(pinfo){if(typeof this.location==="undefined")throwError(new types.Message(["ASSERTION ERROR: Every quotedExpr should have a location"]),loc);function desugarQuotedItem(pinfo,loc){return function(x){if(x instanceof callExpr||x instanceof quotedExpr||x instanceof unsupportedExpr)return x.desugar(pinfo);else if(x instanceof symbolExpr||x instanceof literal||x instanceof Array){var res=new quotedExpr(x);res.location=loc;return[res,
pinfo]}else throwError(new types.Message(["ASSERTION ERROR: Found an unexpected item in a quotedExpr"]),loc)}}return desugarQuotedItem(pinfo,this.location)(this.val)};unquotedExpr.prototype.desugar=function(pinfo,depth){if(typeof depth==="undefined")throwError(new types.Message(["misuse of a ', not under a quasiquoting backquote"]),this.location);else if(depth===1)return this.val.desugar(pinfo);else if(depth>1){var rhs=this.val instanceof Array?desugarQuasiQuotedList(this.val,pinfo,depth-1)[0]:this.val.desugar(pinfo,
depth-1)[0];var uSym=new quotedExpr(new symbolExpr("unquote")),listSym=new symbolExpr("list"),listArgs=[uSym,rhs],listCall=new callExpr(listSym,listArgs);uSym.location=this.location;uSym.parent=listArgs;listSym.location=this.location;listSym.parent=listCall;listCall.location=this.location;return[listCall,pinfo]}else throwError(new types.Message(["ASSERTION FAILURE: depth should have been undefined, or a natural number"]),this.location)};unquoteSplice.prototype.desugar=function(pinfo,depth){if(typeof depth===
"undefined")throwError(new types.Message(["misuse of a ,@, not under a quasiquoting backquote"]),this.location);else if(depth===1)return this.val.desugar(pinfo);else if(depth>1){var rhs=this.val instanceof Array?desugarQuasiQuotedList(this.val,pinfo,depth-1)[0]:this.val.desugar(pinfo,depth-1)[0];var usSym=new quotedExpr(new symbolExpr("unquote-splicing")),listSym=new symbolExpr("list"),listArgs=[usSym,rhs],listCall=new callExpr(listSym,listArgs);usSym.location=this.location;usSym.parent=listArgs;
listSym.location=this.location;listSym.parent=listCall;listCall.location=this.location;return[listCall,pinfo]}else throwError(new types.Message(["ASSERTION FAILURE: depth should have been undefined, or a natural number"]),this.location)};function desugarQuasiQuotedList(qqlist,pinfo,depth){function desugarQuasiQuotedListElement(element,pinfo,depth,loc){if(depth===0&&element instanceof unquoteSplice)return element.desugar(pinfo,depth);else{var argument=element instanceof Array?desugarQuasiQuotedList(element,
depth,depth)[0]:element.desugar(pinfo,depth)[0],listSym=new symbolExpr("list"),listCall=new callExpr(listSym,[argument]);listSym.parent=listCall;listCall.location=listSym.location=loc;return[listCall,pinfo]}}var loc=typeof qqlist.location!="undefined"?qqlist.location:qqlist instanceof Array&&typeof qqlist[0].location!="undefined"?qqlist[0].location:throwError(types.Message(["ASSERTION FAILURE: couldn't find a usable location"]),new Location(0,0,0,0)),appendArgs=qqlist.map(function(x){return desugarQuasiQuotedListElement(x,
pinfo,depth,loc)[0]}),appendSym=new symbolExpr("append");appendSym.location=loc;var appendCall=new callExpr(appendSym,appendArgs);appendCall.location=loc;return[appendCall,pinfo]}quasiquotedExpr.prototype.desugar=function(pinfo,depth){depth=typeof depth==="undefined"?0:depth;if(depth>=0){var result;if(this.val instanceof Array)result=desugarQuasiQuotedList(this.val,pinfo,depth+1)[0];else result=this.val.desugar(pinfo,depth+1)[0]}else throwError(new types.Message(["ASSERTION FAILURE: depth should have been undefined, or a natural number"]),
this.location);if(depth==0)return[result,pinfo];else{var qqSym=new quotedExpr(new symbolExpr("quasiquote")),listArgs=[qqSym,result],listSym=new symbolExpr("list"),listCall=new callExpr(listSym,listArgs);qqSym.parent=listArgs;qqSym.location=this.location;result.parent=listArgs;listSym.parent=listCall;listSym.location=this.location;listCall.location=this.location;return[listCall,pinfo]}};symbolExpr.prototype.desugar=function(pinfo){if(!this.isClause&&this.val==="else"){var loc=this.parent&&this.parent[0]===
this?this.parent.location:this.location;throwError(new types.Message([new types.ColoredPart(this.val,loc),": not allowed ",new types.ColoredPart("here",loc),", because this is not a question in a clause"]),loc)}if(this.parent&&this.parent[0]!==this&&this.val==="define"){var msg=new types.Message([new types.ColoredPart(this.val,this.location),": not allowed inside an expression"]);throwError(msg,this.location)}if(!this.parent&&plt.compiler.keywords.indexOf(this.val)>-1&&this.val!=="else")throwError(new types.Message([new types.ColoredPart(this.val,
this.location),": expected an open parenthesis before ",this.val,", but found none"]),this.location);if(this.val==="."){var msg=new types.Message([this.location.source,":",this.location.startRow.toString(),":",this.location.startCol.toString(),": read: '.' is not supported as a symbol in WeScheme"]);throwError(msg,this.location,"Error-GenericReadError")}return[this,pinfo]};unsupportedExpr.prototype.desugar=function(pinfo){this.location.span=this.errorSpan;throwError(this.errorMsg,this.location,"Error-GenericReadError")};
Program.prototype.collectDefinitions=function(pinfo){return pinfo};function bf(name,modulePath,arity,vararity,loc){return new functionBinding(name,modulePath,arity,vararity,[],false,loc)}defFunc.prototype.collectDefinitions=function(pinfo){this.args.forEach(function(arg){if(plt.compiler.keywords.indexOf(arg.val)>-1)throwError(new types.Message([new types.ColoredPart(arg.val,arg.location),": this is a reserved keyword and cannot be used"+" as a variable or function name"]),arg.location)});var binding=
bf(this.name.val,false,this.args.length,false,this.name.location);return pinfo.accumulateDefinedBinding(binding,this.location)};defVar.prototype.collectDefinitions=function(pinfo){var binding=this.expr instanceof lambdaExpr?bf(this.name.val,false,this.expr.args.length,false,this.name.location):new constantBinding(this.name.val,false,[],this.name.location);return pinfo.accumulateDefinedBinding(binding,this.location)};defVars.prototype.collectDefinitions=function(pinfo){var that=this,fieldToAccessor=
function(f){return that.stx[1].val+"-"+f.val},fieldToMutator=function(f){return"set-"+that.stx[1].val+"-"+f.val+"!"};if(that.stx[0].val==="define-struct"){var id=that.stx[1].val,fields=that.stx[2],constructorId="make-"+id,predicateId=id+"?",selectorIds=fields.map(fieldToAccessor),mutatorIds=fields.map(fieldToMutator),structNameLoc=that.stx[1].location,structureBinding=new structBinding(id,false,fields,constructorId,predicateId,selectorIds,mutatorIds,null,that.stx[1].location),constructorBinding=bf(constructorId,
false,fields.length,false,structNameLoc),predicateBinding=bf(predicateId,false,1,false,structNameLoc),mutatorBinding=bf(id+"-set!",false,1,false,structNameLoc),refBinding=bf(id+"-ref",false,1,false,structNameLoc),bindings=[structureBinding,refBinding,constructorBinding,predicateBinding,mutatorBinding];return pinfo.accumulateDefinedBindings(bindings,that.location)}else return this.names.reduce(function(pinfo,id){var binding=new constantBinding(id.val,false,[],id.location);return pinfo.accumulateDefinedBinding(binding,
that.location)},pinfo)};requireExpr.prototype.collectDefinitions=function(pinfo){var moduleName=this.spec instanceof literal?this.spec.val.toString():this.spec.toString(),resolvedModuleName=pinfo.modulePathResolver(moduleName,pinfo.currentModulePath),that=this,newPinfo;function getWeSchemeModule(name){var m=name.match(/^wescheme\/(\w+)$/);return m?m[1]:false}function throwModuleError(moduleName){var bestGuess=plt.compiler.moduleGuess(that.spec.toString());var msg=new types.Message(["Found require of the module ",
new types.ColoredPart(that.spec.toString(),that.spec.location),", but this module is unknown.",bestGuess.name===that.spec.toString()?"":" Did you mean '"+bestGuess.name+"'?"]);throwError(msg,that.spec.location,"Error-UnknownModule")}if(!(resolvedModuleName||getWeSchemeModule(moduleName)))throwModuleError(moduleName);function processModule(moduleName){var provides=window.COLLECTIONS[moduleName].provides;var strToBinding=function(p){var b=new constantBinding(p,new symbolExpr(moduleName),false);b.imported=
true;return b},provideBindings=provides.map(strToBinding),modulebinding=new moduleBinding(moduleName,provideBindings);newPinfo=pinfo.accumulateModule(modulebinding).accumulateModuleBindings(provideBindings)}var url=window.location.protocol+"//"+window.location.host+(getWeSchemeModule(moduleName)?"/loadProject?publicId="+getWeSchemeModule(moduleName):"/js/mzscheme-vm/collects/"+moduleName+".js");console.log(url);if(window.COLLECTIONS&&window.COLLECTIONS[moduleName])processModule(moduleName);else jQuery.ajax({url:url,
success:function(result){try{if(getWeSchemeModule(moduleName)){var program=(0,eval)("("+result+")");if(window.COLLECTIONS===undefined)window.COLLECTIONS=[];var lexemes=plt.compiler.lex(program.source.src,moduleName),AST=plt.compiler.parse(lexemes),desugared=plt.compiler.desugar(AST)[0],pinfo=plt.compiler.analyze(desugared),objectCode=plt.compiler.compile(desugared,pinfo);window.COLLECTIONS[moduleName]={"name":moduleName,"bytecode":(0,eval)("("+objectCode.bytecode+")"),"provides":objectCode.provides}}else eval(result);
if(result)processModule(moduleName);else throwModuleError(moduleName)}catch(e){if(e.type==="moby-failure")throw e;var msg=new types.Message(["A network error occured when trying to load ",new types.ColoredPart(that.spec.toString(),that.spec.location),". Please check your connection and try again."]);throwError(msg,that.spec.location,"Error-NetworkError")}},error:function(error){throwModuleError(moduleName)},async:false});return newPinfo};function provideBindingId(symbl){this.symbl=symbl}function provideBindingStructId(symbl){this.symbl=
symbl}Program.prototype.collectProvides=function(pinfo){return pinfo};provideStatement.prototype.collectProvides=function(pinfo){var that=this;function addProvidedName(id){pinfo.providedNames.put(id,new provideBindingId(id))}function collectProvidesFromClause(pinfo,clause){if(clause instanceof symbolExpr)if(pinfo.definedNames.containsKey(clause.val)){addProvidedName(clause.val);return pinfo}else{var msg=new types.Message(["The name '",new types.ColoredPart(clause.toString(),clause.location),"', is not defined in the program, and cannot be provided."]);
throwError(msg,clause.location)}else if(clause instanceof Array)if(pinfo.definedNames.containsKey(clause[1].val)&&pinfo.definedNames.get(clause[1].val)instanceof structBinding){var b=pinfo.definedNames.get(clause[1].val),fns=[b.name,b.constructor,b.predicate].concat(b.accessors,b.mutators);fns.forEach(addProvidedName);return pinfo}else throwError(new types.Message(["The struct '",new types.ColoredPart(clause[1].toString(),clause[1].location),"', is not defined in the program, and cannot be provided"]),
clause.location);else throw"Impossible: all invalid provide clauses should have been filtered out!";}return this.clauses.reduce(collectProvidesFromClause,pinfo)};Program.prototype.analyzeUses=function(pinfo,env){return pinfo};defVar.prototype.analyzeUses=function(pinfo){pinfo.env.extend(this.expr instanceof lambdaExpr?bf(this.name.val,false,this.expr.args.length,false,this.location):new constantBinding(this.name.val,false,[],this.name.location));return this.expr.analyzeUses(pinfo,pinfo.env)};defVars.prototype.analyzeUses=
function(pinfo){this.names.forEach(function(id){pinfo.env.extend(new constantBinding(id.val,false,[],id.location))});return this.expr.analyzeUses(pinfo,pinfo.env)};function analyzeClosureUses(funcExpr,pinfo){var oldEnv=pinfo.env,oldKeys=oldEnv.bindings.keys(),newBindings=types.makeLowLevelEqHash();oldKeys.forEach(function(k){newBindings.put(k,oldEnv.bindings.get(k))});var newEnv=new plt.compiler.env(newBindings),newEnv=funcExpr.args.reduce(function(env,arg){return env.extend(new constantBinding(arg.val,
false,[],arg.location))},newEnv);pinfo.env=newEnv;pinfo=funcExpr.body.analyzeUses(pinfo,newEnv);pinfo.env=oldEnv;return pinfo}defFunc.prototype.analyzeUses=function(pinfo){pinfo.env=pinfo.env.extend(bf(this.name.val,false,this.args.length,false,this.name.location));return analyzeClosureUses(this,pinfo)};lambdaExpr.prototype.analyzeUses=function(pinfo,env){return analyzeClosureUses(this,pinfo)};beginExpr.prototype.analyzeUses=function(pinfo,env){return this.exprs.reduce(function(p,expr){return expr.analyzeUses(p,
env)},pinfo)};localExpr.prototype.analyzeUses=function(pinfo,env){var pinfoAfterDefs=this.defs.reduce(function(pinfo,d){return d.analyzeUses(pinfo,env)},pinfo);return this.body.analyzeUses(pinfoAfterDefs,pinfoAfterDefs.env)};callExpr.prototype.analyzeUses=function(pinfo,env){return[this.func].concat(this.args).reduce(function(p,arg){return arg instanceof Array?arg.reduce(function(pinfo,p){return p.analyzeUses(pinfo,pinfo.env)},pinfo):arg.analyzeUses(p,env)},pinfo)};ifExpr.prototype.analyzeUses=function(pinfo,
env){var exps=[this.predicate,this.consequence,this.alternative];return exps.reduce(function(p,exp){return exp.analyzeUses(p,env)},pinfo)};symbolExpr.prototype.analyzeUses=function(pinfo,env){if(plt.compiler.keywords.indexOf(this.val)>-1&&(!this.parent||this.parent[0]!==this)||this.parent instanceof couple)throwError(new types.Message([new types.ColoredPart(this.val,this.location),": expected an open parenthesis before ",this.val,", but found none"]),this.location);var binding=env.lookup_context(this.val);
if(binding){this.bindingLoc=binding.loc;return pinfo.accumulateBindingUse(binding,pinfo)}else return pinfo.accumulateFreeVariableUse(this.val,pinfo)};function analyze(programs){return programAnalyzeWithPinfo(programs,plt.compiler.getBasePinfo("base"))}function programAnalyzeWithPinfo(programs,pinfo){function collectDefinitions(programs,pinfo){return programs.reduce(function(pinfo,p){return p.collectDefinitions(pinfo)},pinfo)}function collectProvides(programs,pinfo){return programs.reduce(function(pinfo,
p){return p.collectProvides(pinfo)},pinfo)}function analyzeUses(programs,pinfo){return programs.reduce(function(pinfo,p){return p.analyzeUses(pinfo,pinfo.env)},pinfo)}var pinfo1=collectDefinitions(programs,pinfo);var pinfo2=collectProvides(programs,pinfo1);return analyzeUses(programs,pinfo2)}plt.compiler.desugar=function(p,pinfo,debug){var start=(new Date).getTime();try{var ASTandPinfo=desugarProgram(p,pinfo,true),program=ASTandPinfo[0],pinfo=ASTandPinfo[1]}catch(e){console.log("DESUGARING ERROR");
throw e;}var end=(new Date).getTime();if(debug){console.log("Desugared in "+Math.floor(end-start)+"ms");console.log(program);console.log(program.toString())}return ASTandPinfo};plt.compiler.analyze=function(program,debug){var start=(new Date).getTime();try{var pinfo=analyze(program)}catch(e){console.log("ANALYSIS ERROR");throw e;}var end=(new Date).getTime();if(debug)console.log("Analyzed in "+Math.floor(end-start)+"ms");return pinfo};plt.compiler.provideBindingId=provideBindingId;plt.compiler.provideBindingStructId=
provideBindingStructId})();goog.provide("plt.compiler.compile");goog.provide("plt.compiler.localStackReference");goog.provide("plt.compiler.globalStackReference");goog.provide("plt.compiler.unboundStackReference");goog.require("plt.compiler.literal");goog.require("plt.compiler.symbolExpr");goog.require("plt.compiler.Program");goog.require("plt.compiler.ifExpr");goog.require("plt.compiler.beginExpr");goog.require("plt.compiler.localExpr");goog.require("plt.compiler.andExpr");goog.require("plt.compiler.orExpr");goog.require("plt.compiler.lambdaExpr");
goog.require("plt.compiler.quotedExpr");goog.require("plt.compiler.callExpr");goog.require("plt.compiler.defFunc");goog.require("plt.compiler.defVar");goog.require("plt.compiler.defVars");goog.require("plt.compiler.defStruct");goog.require("plt.compiler.requireExpr");goog.require("plt.compiler.provideStatement");window.plt=window.plt||{};plt.compiler=plt.compiler||{};
(function(){var literal=plt.compiler.literal;var symbolExpr=plt.compiler.symbolExpr;var Program=plt.compiler.Program;var ifExpr=plt.compiler.ifExpr;var beginExpr=plt.compiler.beginExpr;var localExpr=plt.compiler.localExpr;var andExpr=plt.compiler.andExpr;var orExpr=plt.compiler.orExpr;var lambdaExpr=plt.compiler.lambdaExpr;var quotedExpr=plt.compiler.quotedExpr;var callExpr=plt.compiler.callExpr;var defFunc=plt.compiler.defFunc;var defVar=plt.compiler.defVar;var defVars=plt.compiler.defVars;var defStruct=
plt.compiler.defStruct;var requireExpr=plt.compiler.requireExpr;var provideStatement=plt.compiler.provideStatement;var heir=function(p){var f=function(){};f.prototype=p;return new f};literal.prototype.toBytecode=function(){var str=this.val.toBytecode?this.val.toBytecode():this.val===true?"true":this.val===false?"false":this.toString();return'{"$":"constant","value":'+str+"}"};symbolExpr.prototype.toBytecode=function(){return'types.symbol("'+escapeSym(this.val)+'")'};Vector.prototype.toBytecode=function(){return"types.vector(["+
this.elts.join(",")+"])"};Array.prototype.toBytecode=function(quoted){return"types."+(this.length===0?"EMPTY":"list(["+this.map(convertToBytecode).join(",")+"])")};jsnums.Rational.prototype.toBytecode=function(){return"types.rational("+convertToBytecode(this.n)+", "+convertToBytecode(this.d)+")"};jsnums.BigInteger.prototype.toBytecode=function(){return'types.bignum("'+this.toString()+'")'};jsnums.FloatPoint.prototype.toBytecode=function(){var num=this.toString();if(num==="+nan.0")num="NaN";if(num===
"+inf.0")num="Infinity";if(num==="-inf.0")num="-Infinity";return'types["float"]('+num+")"};jsnums.Complex.prototype.toBytecode=function(){return"types.complex("+convertToBytecode(this.r)+", "+convertToBytecode(this.i)+")"};Char.prototype.toBytecode=function(){return"types['char'](String.fromCharCode("+this.val.charCodeAt(0)+"))"};function stackReference(){}function localStackReference(name,isBoxed,depth){stackReference.call(this);this.name=name;this.isBoxed=isBoxed;this.depth=depth}localStackReference.prototype=
heir(stackReference.prototype);function globalStackReference(name,depth,pos){stackReference.call(this);this.name=name;this.pos=pos;this.depth=depth}globalStackReference.prototype=heir(stackReference.prototype);function unboundStackReference(name){stackReference.call(this);this.name=name}unboundStackReference.prototype=heir(stackReference.prototype);var Bytecode=function(){this.toBytecode=function(){console.log(this);throw"IMPOSSIBLE - generic bytecode toBytecode method was called";}};function convertToBytecode(bc){if(types.isString(bc)&&
bc.chars!==undefined)return'"'+bc.toString()+'"';return bc.toBytecode?bc.toBytecode():bc}function escapeSym(symName){var str=symName.toString().replace(/\|/g,""),bcStr="";var escapes=["{","}","[","]",",","'","`"," ","\\",'"'];for(var j=0;j<str.length;j++)bcStr+=(escapes.indexOf(str.charAt(j))>-1?"\\":"")+str.charAt(j);bcStr=bcStr.replace(/\n/g,"\\n");return bcStr}function globalBucket(name){Bytecode.call(this);this.name=name;this.toBytecode=function(){return'{"$":"global-bucket","value":"'+escapeSym(this.name)+
'"}'}}globalBucket.prototype=heir(Bytecode.prototype);function moduleVariable(modidx,sym,pos,phase){Bytecode.call(this);this.$="module-variable";this.modidx=modidx;this.sym=sym;this.pos=pos;this.phase=phase;this.toBytecode=function(){return'{"$":"module-variable","sym":'+this.sym.toBytecode()+',"modidx":'+this.modidx.toBytecode()+',"pos":'+this.pos+',"phase":'+this.phase+"}"}}moduleVariable.prototype=heir(Bytecode.prototype);function wrap(){Bytecode.call(this)}wrap.prototype=heir(Bytecode.prototype);
function wrapped(datum,wraps,certs){Bytecode.call(this);this.datum=datum;this.wraps=wraps;this.certs=certs}wrapped.prototype=heir(Bytecode.prototype);function stx(encoded){this.encoded=encoded;Bytecode.call(this)}stx.prototype=heir(Bytecode.prototype);function prefix(numLifts,topLevels,stxs){Bytecode.call(this);this.numLifts=numLifts;this.topLevels=topLevels;this.stxs=stxs;this.toBytecode=function(){return'{"$":"prefix","num-lifts":'+this.numLifts+',"toplevels":['+this.topLevels.map(function(v){return convertToBytecode(v)}).join(",")+
'],"stxs":['+this.stxs.map(convertToBytecode)+"]}"}}prefix.prototype=heir(Bytecode.prototype);function form(){Bytecode.call(this)}form.prototype=heir(Bytecode.prototype);function expr(form){Bytecode.call(this)}expr.prototype=heir(Bytecode.prototype);function indirect(v){Bytecode.call(this);this.v=v;this.toBytecode=function(){return'{"$":"indirect","v":'+this.v.toBytecode()+"}"}}indirect.prototype=heir(Bytecode.prototype);function compilationTop(maxLetDepth,prefix,code){Bytecode.call(this);this.maxLetDepth=
maxLetDepth;this.prefix=prefix;this.code=code;this.toBytecode=function(){return'{"$":"compilation-top","max-let-depth":'+this.maxLetDepth+',"prefix":'+this.prefix.toBytecode()+',"compiled-indirects":[],"code":'+this.code.toBytecode()+"}"}}compilationTop.prototype=heir(Bytecode.prototype);function provided(name,src,srcName,nomSrc,srcPhase,isProtected,insp){Bytecode.call(this);this.name=name;this.src=src;this.srcName=srcName;this.nomSrc=nomSrc;this.srcPhase=srcPhase;this.insp=insp;this.isProtected=
isProtected}provided.prototype=heir(Bytecode.prototype);function topLevel(depth,pos,constant,ready,loc){Bytecode.call(this);this.depth=depth;this.pos=pos;this.constant=constant;this.ready=ready;this.loc=loc;this.toBytecode=function(){return'{"$":"toplevel","depth":'+this.depth.toString()+',"pos":'+this.pos.toString()+',"const?":'+this.constant+',"ready?":'+this.ready+',"loc":'+(this.loc&&this.loc.toVector().toBytecode())+"}"}}topLevel.prototype=heir(Bytecode.prototype);function seq(forms){Bytecode.call(this);
this.forms=forms;this.toBytecode=function(){return'{"$":"seq","forms":['+this.forms.map(convertToBytecode).join(",")+"]}"}}seq.prototype=heir(Bytecode.prototype);function defValues(ids,rhs){Bytecode.call(this);this.ids=ids;this.rhs=rhs;this.toBytecode=function(){return'{"$":"def-values","ids":['+this.ids.map(convertToBytecode).join(",")+'],"body":'+this.rhs.toBytecode()+"}"}}defValues.prototype=heir(Bytecode.prototype);function defSyntaxes(ids,rhs,prefix,maxLetDepth){Bytecode.call(this);this.$="def-values";
this.ids=ids;this.rhs=rhs;this.prefix=prefix;this.maxLetDepth=maxLetDepth;this.toBytecode=function(){return'{"$":"def-values","ids":['+this.ids.toBytecode().join(",")+'],"rhs":'+this.rhs.toBytecode()+',"prefix":'+this.prefix.toBytecode()+',"max-let-depth":'+this.maxLetDepth.toBytecode()+"}"}}defSyntaxes.prototype=heir(Bytecode.prototype);function defForSyntax(ids,rhs,prefix,maxLetDepth){Bytecode.call(this);this.ids=ids;this.rhs=rhs;this.prefix=prefix;this.maxLetDepth=maxLetDepth}defForSyntax.prototype=
heir(Bytecode.prototype);function mod(name,selfModidx,prefix,provides,requires,body,syntaxBody,unexported,maxLetDepth,dummy,langInfo,internalContext){Bytecode.call(this);this.name=name;this.selfModidx=selfModidx;this.prefix=prefix;this.provides=provides;this.requires=requires;this.body=body;this.syntaxBody=syntaxBody;this.unexported=unexported;this.maxLetDepth=maxLetDepth;this.dummy=dummy;this.langInfo=langInfo;this.internalContext=internalContext;this.toBytecode=function(){return'{"$":"mod","name":'+
this.name.toBytecode()+',"self-modidx":'+this.selfModidx.toBytecode()+',"prefix":'+this.prefix.toBytecode()+',"provides":'+this.provides.toBytecode()+',"requires":'+(this.requires&&this.requires.toVector().toBytecode())+',"body":'+this.body.toBytecode()+',"stx-body":'+this.syntaxBody.toBytecode()+',"max-let-depth":'+this.maxLetDepth.toBytecode()+"}"}}mod.prototype=heir(Bytecode.prototype);function lam(name,operatorAndRandLocs,flags,numParams,paramTypes,rest,closureMap,closureTypes,maxLetDepth,body){Bytecode.call(this);
this.name=name;this.flags=flags;this.numParams=numParams;this.paramTypes=paramTypes;this.rest=rest;this.body=body;this.closureMap=closureMap;this.maxLetDepth=maxLetDepth;this.closureTypes=closureTypes;this.operatorAndRandLocs=operatorAndRandLocs;this.toBytecode=function(){return'{"$":"lam","name":'+this.name.toBytecode()+',"locs":['+this.operatorAndRandLocs.map(convertToBytecode).join(",")+'],"flags":['+this.flags.map(convertToBytecode).join(",")+'],"num-params":'+this.numParams+',"param-types":['+
this.paramTypes.map(convertToBytecode).join(",")+'],"rest?":'+this.rest+',"closure-map":['+this.closureMap.map(convertToBytecode).join(",")+'],"closure-types":['+this.closureTypes.map(convertToBytecode).join(",")+'],"max-let-depth":'+this.maxLetDepth+',"body":'+this.body.toBytecode()+"}"}}lam.prototype=heir(Bytecode.prototype);function closure(code,genId){Bytecode.call(this);this.code=code;this.genId=genId;this.toBytecode=function(){return'{"$":"closure","code":'+this.code.toBytecode()+',"gen-id":'+
this.genId.toBytecode()+"}"}}closure.prototype=heir(Bytecode.prototype);function caseLam(name,clauses){Bytecode.call(this);this.name=name;this.clauses=clauses;this.toBytecode=function(){return'{"$":"case-lam","name":'+this.name.toBytecode()+',"clauses":'+this.clauses.toBytecode()+"}"}}caseLam.prototype=heir(Bytecode.prototype);function letOne(rhs,body,flonum){Bytecode.call(this);this.rhs=rhs;this.body=body;this.flonum=flonum;this.toBytecode=function(){return'{"$": "let-one","rhs":'+this.rhs.toBytecode()+
',"body":'+this.body.toBytecode()+',"flonum":'+this.flonum.toBytecode()+"}"}}letOne.prototype=heir(Bytecode.prototype);function letVoid(count,boxes,body){Bytecode.call(this);this.count=count;this.boxes=boxes;this.body=body;this.toBytecode=function(){return'{"$":"let-void","count":'+convertToBytecode(this.count)+',"boxes?":'+convertToBytecode(this.boxes)+',"body":'+this.body.toBytecode()+"}"}}letVoid.prototype=heir(Bytecode.prototype);function letRec(procs,body){Bytecode.call(this);this.procs=procs;
this.body=body;this.toBytecode=function(){return'{"$":"let-rec","procs":'+this.procs.toBytecode()+',"body":'+this.body.toBytecode()+"}"}}letRec.prototype=heir(Bytecode.prototype);function installValue(count,pos,boxes,rhs,body){Bytecode.call(this);this.count=count;this.pos=pos;this.boxes=boxes;this.rhs=rhs;this.body=body;this.toBytecode=function(){return'{"$":"install-value","count":'+convertToBytecode(this.count)+',"pos":'+convertToBytecode(this.pos)+',"boxes?":'+convertToBytecode(this.boxes)+',"rhs":'+
this.rhs.toBytecode()+',"body":'+this.body.toBytecode()+"}"}}installValue.prototype=heir(Bytecode.prototype);function boxEnv(pos,body){Bytecode.call(this);this.pos=pos;this.body=body;this.toBytecode=function(){return'{"$":"boxenv","pos":'+this.pos.toBytecode()+',"body":'+this.body.toBytecode()+"}"}}boxEnv.prototype=heir(Bytecode.prototype);function localRef(unbox,pos,clear,otherClears,flonum){Bytecode.call(this);this.unbox=unbox||false;this.pos=pos;this.clear=clear;this.flonum=flonum;this.otherClears=
otherClears;this.toBytecode=function(){return'{"$":"localref","unbox?":'+this.unbox+',"pos":'+this.pos+',"clear":'+this.clear+',"other-clears?":'+this.otherClears+',"flonum?":'+this.flonum+"}"}}localRef.prototype=heir(Bytecode.prototype);function topSyntax(depth,pos,midpt){Bytecode.call(this);this.depth=depth;this.pos=pos;this.midpt=midpt}topSyntax.prototype=heir(Bytecode.prototype);function application(rator,rands){Bytecode.call(this);this.rator=rator;this.rands=rands;this.toBytecode=function(){return'{"$":"application","rator":'+
this.rator.toBytecode()+',"rands":['+this.rands.map(convertToBytecode).join(",")+"]}"}}application.prototype=heir(Bytecode.prototype);function branch(testExpr,thenExpr,elseExpr){Bytecode.call(this);this.testExpr=testExpr;this.thenExpr=thenExpr;this.elseExpr=elseExpr;this.toBytecode=function(){return'{"$":"branch","test":'+this.testExpr.toBytecode()+',"then":'+this.thenExpr.toBytecode()+',"else":'+this.elseExpr.toBytecode()+"}"}}branch.prototype=heir(Bytecode.prototype);function withContMark(key,val,
body){Bytecode.call(this);this.$="with-cont-mark";this.key=key;this.val=val;this.body=body;this.toBytecode=function(){return'{"$":"with-cont-mark","key":'+(new literal(new symbolExpr(this.key))).toBytecode()+',"val":'+(new literal(this.val)).toBytecode()+',"body":'+this.body.toBytecode()+"}"}}withContMark.prototype=heir(Bytecode.prototype);function beg0(seq){Bytecode.call(this);this.seq=seq;this.toBytecode=function(){return'{"$":"beg0","seq":'+this.seq.toBytecode()+"}"}}beg0.prototype=heir(Bytecode.prototype);
function splice(forms){Bytecode.call(this);this.forms=forms;this.toBytecode=function(){return'{"$":"splice","forms":'+this.forms.toBytecode()+"}"}}splice.prototype=heir(Bytecode.prototype);function varRef(topLevel){Bytecode.call(this);this.topLevel=topLevel;this.toBytecode=function(){return'{"$":"varref","top-level":'+this.topLevel.toBytecode()+"}"}}varRef.prototype=heir(Bytecode.prototype);function assign(id,rhs,undefOk){Bytecode.call(this);this.id=id;this.rhs=rhs;this.undefOk=undefOk;this.toBytecode=
function(){return'{"$":"assign","id":'+this.id.toBytecode()+',"rhs":'+this.rhs.toBytecode()+',"undef-ok":'+this.undefOk.toBytecode()+"}"}}assign.prototype=heir(Bytecode.prototype);function applyValues(proc,args){Bytecode.call(this);this.proc=proc;this.args=args;this.toBytecode=function(){return'{"$":"apply-values","proc":'+this.proc.toBytecode()+',"args":'+this.args.toBytecode()+"}"}}applyValues.prototype=heir(Bytecode.prototype);function primVal(id){Bytecode.call(this);this.id=id;this.toBytecode=
function(){return'{"$":"primval","id":'+this.id.toBytecode()+"}"}}primVal.prototype=heir(Bytecode.prototype);function req(reqs,dummy){Bytecode.call(this);this.$="req";this.reqs=reqs;this.dummy=dummy;this.toBytecode=function(){var reqBytecode=this.reqs instanceof literal?'"'+this.reqs.val+'"':this.reqs.toBytecode();return'{"$":"req","reqs":'+reqBytecode+',"dummy":'+this.dummy.toBytecode()+"}"}}req.prototype=heir(Bytecode.prototype);function lexicalRename(bool1,bool2,alist){this.bool1=bool1;this.bool2=
bool2;this.alist=alist;Bytecode.call(this)}lexicalRename.prototype=heir(Bytecode.prototype);function phaseShift(amt,src,dest){this.amt=amt;this.src=src;this.dest=dest;Bytecode.call(this)}phaseShift.prototype=heir(Bytecode.prototype);function wrapMark(val){this.val=val;Bytecode.call(this)}wrapMark.prototype=heir(Bytecode.prototype);function prune(sym){this.sym=sym;Bytecode.call(this)}prune.prototype=heir(Bytecode.prototype);function allFromModule(path,phase,srcPhase,exceptions,prefix){this.path=path;
this.phase=phase;this.srcPhase=srcPhase;this.prefix=prefix;this.exceptions=exceptions;Bytecode.call(this)}allFromModule.prototype=heir(Bytecode.prototype);function nominalPath(){Bytecode.call(this)}nominalPath.prototype=heir(Bytecode.prototype);function simpleNominalPath(value){this.value=value;Bytecode.call(this)}simpleNominalPath.prototype=heir(Bytecode.prototype);function phasedModuleBinding(path,phase,exportName,nominalPath,nominalExportName){this.path=path;this.phase=phase;this.exportName=nominalPath;
this.nominalExportName=nominalExportName;Bytecode.call(this)}phasedModuleBinding.prototype=heir(Bytecode.prototype);function exportedNominalModuleBinding(path,exportName,nominalPath,nominalExportName){this.path=path;this.exportName=exportName;this.nominalPath=nominalPath;this.nominalExportName=nominalExportName;Bytecode.call(this)}exportedNominalModuleBinding.prototype=heir(Bytecode.prototype);function nominalModuleBinding(path,nominalPath){this.path=path;this.nominalPath=nominalPath;Bytecode.call(this)}
nominalModuleBinding.prototype=heir(Bytecode.prototype);function exportedModuleBinding(path,exportName){this.path=path;this.exportName=exportName;Bytecode.call(this)}exportedModuleBinding.prototype=heir(Bytecode.prototype);function simpleModuleBinding(path){this.path=path;Bytecode.call(this)}simpleModuleBinding.prototype=heir(Bytecode.prototype);function ModuleRename(phase,kind,setId,unmarshals,renames,markRenames,plusKern){this.phase=phase;this.kind=kind;this.unmarshals=unmarshals;this.renames=renames;
this.markRenames=markRenames;this.plusKern=plusKern;Bytecode.call(this)}ModuleRename.prototype=heir(Bytecode.prototype);function modulePath(path,base){this.path=path;this.base=base;Bytecode.call(this);this.toBytecode=function(){return'{"$":"module-path","path":'+convertToBytecode(this.path)+',"base":'+convertToBytecode(this.base)+"}"}}modulePath.prototype=heir(Bytecode.prototype);Program.prototype.freeVariables=function(acc,env){return acc};ifExpr.prototype.freeVariables=function(acc,env){return this.alternative.freeVariables(this.consequence.freeVariables(this.predicate.freeVariables(acc,
env),env),env)};beginExpr.prototype.freeVariables=function(acc,env){return this.exprs.reduceRight(function(acc,expr){return expr.freeVariables(acc,env)},acc)};symbolExpr.prototype.freeVariables=function(acc,env){return env.lookup(this.val,0)instanceof unboundStackReference&&acc.indexOf(this)==-1?acc.concat([this]):acc};localExpr.prototype.freeVariables=function(acc,env){var pushLocalBoxedFromSym=function(env,sym){return new plt.compiler.localEnv(sym.val,true,env)},pushLocalFromSym=function(env,sym){return new plt.compiler.localEnv(sym.val,
false,env)};var definedNames=this.defs.reduce(function(names,d){return(d instanceof defVars?d.names:[d.name]).concat(names)},[]),updatedEnv=definedNames.reduce(pushLocalBoxedFromSym,env),freeVarsInBody=this.body.freeVariables(acc,updatedEnv),addFreeVarsInDef=function(acc,d){if(d instanceof defFunc){var envWithArgs=d.args.reduce(function(env,arg){return pushLocalFromSym(env,arg)},updatedEnv);return d.body.freeVariables(acc,envWithArgs)}if(d instanceof defStruct)return acc;else return d.expr.freeVariables(acc,
updatedEnv)};return this.defs.reduce(addFreeVarsInDef,freeVarsInBody)};andExpr.prototype.freeVariables=function(acc,env){return this.exprs.reduceRight(function(acc,expr){return expr.freeVariables(acc,env)},acc)};orExpr.prototype.freeVariables=function(acc,env){return this.exprs.reduceRight(function(acc,expr){return expr.freeVariables(acc,env)},acc)};lambdaExpr.prototype.freeVariables=function(acc,env){var pushLocalFromSym=function(env,sym){return new plt.compiler.localEnv(sym.val,false,env)},envWithArgs=
this.args.slice(0).reverse().reduce(pushLocalFromSym,env);return this.body.freeVariables(acc,envWithArgs)};quotedExpr.prototype.freeVariables=function(acc,env){return acc};callExpr.prototype.freeVariables=function(acc,env){return this.func.freeVariables(acc,env).concat(this.args).reduceRight(function(acc,expr){return expr.freeVariables(acc,env)},acc)};function sortAndUnique(elts,lessThan,equalTo){function unique(elts){return elts.length<=1?elts:equalTo(elts[0],elts[1])?unique(elts.slice(1)):[elts[0]].concat(unique(elts.slice(1)))}
var convertedSortFn=function(x,y){return lessThan(x,y)?-1:lessThan(y,x)};return unique(elts.sort(convertedSortFn))}function compilePrograms(acc,p){var bytecodes=acc[0],pinfo=acc[1],env=acc[2],compiledProgramAndPinfo=p.compile(env,pinfo),compiledProgram=compiledProgramAndPinfo[0],pinfo=compiledProgramAndPinfo[1];return[[compiledProgram].concat(bytecodes),pinfo,env]}Program.prototype.compile=function(env,pinfo){return[this,pinfo]};defFunc.prototype.compile=function(env,pinfo){var compiledFunNameAndPinfo=
this.name.compile(env,pinfo),compiledFunName=compiledFunNameAndPinfo[0],pinfo=compiledFunNameAndPinfo[1];var lambda=new lambdaExpr(this.args,this.body),compiledLambdaAndPinfo=lambda.compile(env,pinfo,false,this.name),compiledLambda=compiledLambdaAndPinfo[0],pinfo=compiledLambdaAndPinfo[1];var bytecode=new defValues([compiledFunName],compiledLambda);return[bytecode,pinfo]};defVar.prototype.compile=function(env,pinfo){var compiledIdAndPinfo=this.name.compile(env,pinfo),compiledId=compiledIdAndPinfo[0],
pinfo=compiledIdAndPinfo[1];var compiledExprAndPinfo=this.expr.compile(env,pinfo),compiledExpr=compiledExprAndPinfo[0],pinfo=compiledExprAndPinfo[1];var bytecode=new defValues([compiledId],compiledExpr);return[bytecode,pinfo]};defVars.prototype.compile=function(env,pinfo){var compiledIdsAndPinfo=this.names.reduceRight(compilePrograms,[[],pinfo,env]),compiledIds=compiledIdsAndPinfo[0],pinfo=compiledIdsAndPinfo[1];var compiledBodyAndPinfo=this.expr.compile(env,pinfo),compiledBody=compiledBodyAndPinfo[0],
pinfo=compiledBodyAndPinfo[1];var bytecode=new defValues(compiledIds,compiledBody);return[bytecode,pinfo]};beginExpr.prototype.compile=function(env,pinfo){var compiledExpressionsAndPinfo=this.exprs.reduceRight(compilePrograms,[[],pinfo,env]),compiledExpressions=compiledExpressionsAndPinfo[0],pinfo1=compiledExpressionsAndPinfo[1];var bytecode=new seq(compiledExpressions);return[bytecode,pinfo1]};lambdaExpr.prototype.compile=function(env,pinfo,isUnnamedLambda,name){if(isUnnamedLambda===undefined)isUnnamedLambda=
true;function maskUnusedGlobals(listOfNames,namesToKeep){return listOfNames.map(function(n){return namesToKeep.indexOf(n)>-1?n:false})}function pushLocal(env,n){return new plt.compiler.localEnv(n,false,env)}function pushLocalBoxed(env,n){return new plt.compiler.localEnv(n,true,env)}function pushGlobals(names,env){return new plt.compiler.globalEnv(names,false,env)}function getClosureVectorAndEnv(args,freeVariables,originalEnv){var freeVariableRefs=freeVariables.map(function(v){return originalEnv.lookup(v.val,
0)}),ormap=function(f,l){return l.length===0?false:f(l[0])?l[0]:ormap(f,l.slice(1))},isLocalStackRef=function(r){return r instanceof localStackReference},isGlobalStackRef=function(r){return r instanceof globalStackReference},isUnboundStackRef=function(r){return r instanceof unboundStackReference},getDepthFromRef=function(r){return r.depth},anyUnboundStackRefs=ormap(isUnboundStackRef,freeVariableRefs);if(anyUnboundStackRefs)throw"Can't produce closure; I don't know where "+anyUnboundStackRefs.name+
" is bound.";else{var lexicalFreeRefs=sortAndUnique(freeVariableRefs.filter(isLocalStackRef),function(x,y){return x.depth<y.depth},function(x,y){return x.depth===y.depth}),lexicalFreeDepths=lexicalFreeRefs.map(getDepthFromRef),globalRefs=freeVariableRefs.filter(isGlobalStackRef),globalDepths=sortAndUnique(globalRefs.map(getDepthFromRef),function(x,y){return x<y},function(x,y){return x===y});var env1=args.reverse().map(function(s){return s.val}).reduce(pushLocal,originalEnv);var env2=lexicalFreeRefs.reverse().reduce(function(env,
ref){return ref.isBoxed?pushLocalBoxed(env,ref.name):pushLocal(env,ref.name)},env1);var env3=globalDepths.reverse().reduce(function(env,depth){var refsAtDepth=globalRefs.filter(function(ref){return ref.depth===depth}),usedGlobals=refsAtDepth.map(function(ref){return ref.name}),newGlobals=maskUnusedGlobals(originalEnv.peek(depth).names,usedGlobals);return pushGlobals(newGlobals,env)},env2);return[globalDepths.concat(lexicalFreeDepths),env3]}}var envWithArgs=this.args.map(function(s){return s.val}).reduce(pushLocal,
new plt.compiler.emptyEnv);freeVarsInBody=this.body.freeVariables([],envWithArgs);var closureVectorAndEnv=getClosureVectorAndEnv(this.args.slice(0),freeVarsInBody,env),closureVector=closureVectorAndEnv[0],extendedEnv=closureVectorAndEnv[1];var compiledBodyAndPinfo=this.body.compile(extendedEnv,pinfo),compiledBody=compiledBodyAndPinfo[0],pinfo1=compiledBodyAndPinfo[1];var getLocs=function(id){return id.location.toVector()},bytecode=new lam(isUnnamedLambda?[]:new symbolExpr(name),[isUnnamedLambda?this.stx:
name].concat(this.args).map(getLocs),[],this.args.length,this.args.map(function(){return new symbolExpr("val")}),false,closureVector,closureVector.map(function(){return new symbolExpr("val/ref")}),0,compiledBody);return[bytecode,pinfo1]};localExpr.prototype.compile=function(env,pinfo){if(this.defs.length===0)return this.body.compile(env,pinfo);var that=this,definedNames=this.defs.reduce(getDefinedNames,[]),pushLocalBoxedFromSym=function(env,sym){return new plt.compiler.localEnv(sym.val,true,env)},
envWithBoxedNames=definedNames.reverse().reduce(pushLocalBoxedFromSym,env);var letVoidBodyAndPinfo=processDefns(this.defs,pinfo,envWithBoxedNames,0),letVoidBody=letVoidBodyAndPinfo[0],pinfo=letVoidBodyAndPinfo[1];return[new letVoid(definedNames.length,true,letVoidBody),pinfo];function getDefinedNames(names,def){return names.concat(def instanceof defVars?def.names:def.name)}function processDefns(defs,pinfo,env,numInstalled){if(defs.length===0)return that.body.compile(envWithBoxedNames,pinfo);var compiledDefAndPInfo=
defs[0].compile(env,pinfo),compiledRhs=compiledDefAndPInfo[0].rhs,pinfo=compiledDefAndPInfo[1];var numToInstall=defs[0]instanceof defVars?defs[0].names.length:1,newBodyAndPinfo=processDefns(defs.slice(1),pinfo,env,numInstalled+numToInstall);newBody=newBodyAndPinfo[0],pinfo=newBodyAndPinfo[1];var bytecode=new installValue(numToInstall,numInstalled,true,compiledRhs,newBody);return[bytecode,pinfo]}};callExpr.prototype.compile=function(env,pinfo){var makeSpace=function(env,operand){return new plt.compiler.unnamedEnv(env)},
extendedEnv=this.args.reduce(makeSpace,env);var compiledOperatorAndPinfo=this.func.compile(extendedEnv,pinfo),compiledOperator=compiledOperatorAndPinfo[0],pinfo1=compiledOperatorAndPinfo[1];var compiledOperandsAndPinfo=this.args.reduceRight(compilePrograms,[[],pinfo,extendedEnv]),compiledOperands=compiledOperandsAndPinfo[0],pinfo2=compiledOperatorAndPinfo[1],app=new application(compiledOperator,compiledOperands);var extractLoc=function(e){return e.location},locs=[this.func.location].concat(this.args.map(extractLoc)),
locVectors=locs.concat(this.location).map(function(loc){return loc.toVector()}),appWithcontMark=new withContMark(new symbolExpr("moby-application-position-key"),locVectors,new withContMark(new symbolExpr("moby-stack-record-continuation-mark-key"),this.location.toVector(),app));return[appWithcontMark,pinfo2]};ifExpr.prototype.compile=function(env,pinfo){var compiledPredicateAndPinfo=this.predicate.compile(env,pinfo),compiledPredicate=compiledPredicateAndPinfo[0],pinfo1=compiledPredicateAndPinfo[1];
var compiledConsequenceAndPinfo=this.consequence.compile(env,pinfo),compiledConsequence=compiledConsequenceAndPinfo[0],pinfo2=compiledConsequenceAndPinfo[1];var compiledAlternateAndPinfo=this.alternative.compile(env,pinfo),compiledAlternate=compiledAlternateAndPinfo[0],pinfo3=compiledAlternateAndPinfo[1];var bytecode=new branch(compiledPredicate,compiledConsequence,compiledAlternate);return[bytecode,pinfo3]};symbolExpr.prototype.compile=function(env,pinfo){var stackReference=env.lookup(this.val,0),
bytecode;if(stackReference instanceof localStackReference)bytecode=new localRef(stackReference.isBoxed,stackReference.depth,false,false,false);else if(stackReference instanceof globalStackReference)bytecode=new topLevel(stackReference.depth,stackReference.pos,false,false,this.location);else if(stackReference instanceof unboundStackReference)throw"Couldn't find '"+this.val+"' in the environment";else throw"IMPOSSIBLE: env.lookup failed for '"+this.val+"'! A reference should be added to the environment!";
return[bytecode,pinfo]};quotedExpr.prototype.compile=function(env,pinfo){function unwrapLiterals(v){return v instanceof literal?unwrapLiterals(v.val):v instanceof Array?v.map(unwrapLiterals):v}result=new literal(unwrapLiterals(this.val));return[result,pinfo]};provideStatement.prototype.compile=function(env,pinfo){};requireExpr.prototype.compile=function(env,pinfo){return[new req(this.spec,new topLevel(0,0,false,false,false)),pinfo]};function compileCompilationTop(program,pinfo){function makeModulePrefixAndEnv(pinfo){var requiredModuleBindings=
pinfo.modules.reduce(function(acc,m){return acc.concat(m.bindings)},[]),isNotRequiredModuleBinding=function(b){return b.moduleSource&&requiredModuleBindings.indexOf(b)===-1},moduleOrTopLevelDefinedBindings=pinfo.usedBindingsHash.values().filter(isNotRequiredModuleBinding),allModuleBindings=requiredModuleBindings.concat(moduleOrTopLevelDefinedBindings),makeGlobalBucket=function(name){return new globalBucket(name)},modulePathIndexJoin=function(path,base){return new modulePath(path,base)},makeModuleVariablefromBinding=
function(b){return new moduleVariable(modulePathIndexJoin(b.moduleSource,b.imported?false:modulePathIndexJoin(false,false)),new symbolExpr(b.name),-1,0)};var globalNames=pinfo.freeVariables.concat(pinfo.definedNames.keys()),uniqueGlobalNames=sortAndUnique(globalNames,function(a,b){return a<b},function(a,b){return a==b}),topLevels=[false].concat(uniqueGlobalNames.map(makeGlobalBucket),allModuleBindings.map(makeModuleVariablefromBinding)),globals=[false].concat(uniqueGlobalNames,allModuleBindings.map(function(b){return b.name}));
return[new prefix(0,topLevels,[]),new plt.compiler.globalEnv(globals,false,new plt.compiler.emptyEnv)]}var toplevelPrefixAndEnv=makeModulePrefixAndEnv(pinfo),toplevelPrefix=toplevelPrefixAndEnv[0],env=toplevelPrefixAndEnv[1];var defns=program.filter(plt.compiler.isDefinition),requires=program.filter(function(p){return p instanceof requireExpr}),exprs=program.filter(plt.compiler.isExpression);var compiledRequiresAndPinfo=requires.reduceRight(compilePrograms,[[],pinfo,env]),compiledRequires=compiledRequiresAndPinfo[0],
pinfo=compiledRequiresAndPinfo[1];var compiledDefinitionsAndPinfo=defns.reduceRight(compilePrograms,[[],pinfo,env]),compiledDefinitions=compiledDefinitionsAndPinfo[0],pinfo=compiledDefinitionsAndPinfo[1];var compiledExpressionsAndPinfo=exprs.reduceRight(compilePrograms,[[],pinfo,env]),compiledExpressions=compiledExpressionsAndPinfo[0],pinfo=compiledExpressionsAndPinfo[1];var forms=new seq([].concat(compiledRequires,compiledDefinitions,compiledExpressions)),zo_bytecode=new compilationTop(0,toplevelPrefix,
forms),response={"bytecode":"/* runtime-version: local-compiler-summer2014 */\n"+zo_bytecode.toBytecode(),"permissions":pinfo.permissions(),"provides":pinfo.providedNames.keys()};return response}plt.compiler.localStackReference=localStackReference;plt.compiler.globalStackReference=globalStackReference;plt.compiler.unboundStackReference=unboundStackReference;plt.compiler.compile=function(program,pinfo,debug){var start=(new Date).getTime();try{var response=compileCompilationTop(program,pinfo)}catch(e){console.log("COMPILATION ERROR");
throw e;}var end=(new Date).getTime();if(debug){console.log("Compiled in "+Math.floor(end-start)+"ms");console.log(JSON.stringify(response))}return response}})();goog.provide("plt.wescheme.RoundRobin");goog.require("plt.compiler.lex");goog.require("plt.compiler.parse");goog.require("plt.compiler.desugar");goog.require("plt.compiler.analyze");goog.require("plt.compiler.compile");
(function(){if(!console){console={};console.log=function(){}}var initialize=function(compilation_servers,afterInitialize,onFailure){afterInitialize()};var onCompilationFail=function(onDoneError){onDoneError(JSON.stringify(onDoneError("The local compiler has failed to run properly. "+"You may want to confirm that you are running "+"a modern web browser (IE9+, Safari 6+, FF 20+, "+"Chrome 20+).")))};function getError(e){try{var err=JSON.parse(e),structuredErr=JSON.parse(err["structured-error"]);return e}catch(JSONerror){return"!! FATAL ERROR !!\n"+
e.stack}}function logResults(code,local,server){try{console.log("Logging anonymized error message to GDocs");document.getElementById("expr").value=code;document.getElementById("local").value=plt.wescheme.BrowserDetect.versionString+" "+local.replace(/\s+/g,"").toLowerCase();document.getElementById("server").value=server.replace(/\s+/g,"").toLowerCase();document.getElementById("errorLogForm").submit()}catch(e){console.log("LOGGING FAILED.")}}function compile(programName,code,onDone,onDoneError){code=
code.replace(/[\uFEFF\u2060\u200B]/,"");function getHigherThanAsciiChars(str){var nonASCII=str.split("").filter(function(c){return c.charCodeAt(0)>127});return nonASCII.map(function(c){return c.charCodeAt(0)})}try{var start=(new Date).getTime();var lexemes=plt.compiler.lex(code,programName);var AST=plt.compiler.parse(lexemes);var desugared=plt.compiler.desugar(AST)[0];var pinfo=plt.compiler.analyze(desugared);var local_bytecode=plt.compiler.compile(desugared,pinfo);onDone(JSON.stringify(local_bytecode))}catch(e){var local_error=
getError(e).toString();if(/FATAL ERROR/.test(local_error.toString())){logResults(code,JSON.stringify(local_error),"FATAL ERROR");onCompilationFail(onDoneError)}else onDoneError(local_error)}var end=(new Date).getTime(),localTime=Math.floor(end-start);console.log("Compiled in: "+Math.floor(end-start)+"ms")}var lastCompiledName=null;var lastCompiledCode=null;var lastCompiledResult=null;function cachedCompilation(programName,code,onDone,onDoneError){var onDoneWithCache=function(){var result=[].slice.call(arguments,
0);lastCompiledName=programName;lastCompiledCode=code;lastCompiledResult=result;return onDone.apply(null,arguments)};if(programName===lastCompiledName&&code===lastCompiledCode)return onDone.apply(null,lastCompiledResult);compile(programName,code,onDoneWithCache,onDoneError)}plt.wescheme.RoundRobin.initialize=initialize;plt.wescheme.RoundRobin.roundRobinCompiler=cachedCompilation})();goog.provide("plt.wescheme.runner");goog.require("plt.wescheme.AjaxActions");goog.require("plt.wescheme.WeSchemeProperties");goog.require("plt.wescheme.makeDynamicModuleLoader");goog.require("plt.wescheme.RoundRobin");goog.require("plt.compiler.lex");goog.require("plt.compiler.parse");goog.require("plt.compiler.desugar");goog.require("plt.compiler.analyze");goog.require("plt.compiler.compile");var myEditor=myEditor||{getScreenreader:function(){return false}};
(function(){var Runner=function(compilationServerUrl,interactionsDiv){var that=this;this.interactionsDiv=jQuery(interactionsDiv);this.evaluator=new Evaluator({write:function(thing){that.addToInteractions(thing)},compilationServletUrl:compilationServerUrl});this.evaluator.setImageProxy("/imageProxy");this.evaluator.setRootLibraryPath("/js/mzscheme-vm/collects");this.evaluator.setDynamicModuleLoader(plt.wescheme.makeDynamicModuleLoader("/js/mzscheme-vm/collects"))};Runner.prototype.runCompiledCode=
function(compiledCode,permStringArray){var that=this;var onSuccessRun=function(){};var onFailRun=function(exn){that.renderErrorAsDomNode(exn)};this.evaluator.executeCompiledProgram((0,eval)("("+compiledCode+")"),onSuccessRun,onFailRun)};Runner.prototype.runSourceCode=function(title,sourceCode,permStringArray){var that=this;var onSuccessRun=function(){};var onFailRun=function(exn){that.renderErrorAsDomNode(exn)};this.evaluator.executeProgram(title,sourceCode,onSuccessRun,onFailRun)};function isDomNode(x){return x.nodeType!=
undefined}function isPrintableNode(x){return x.nodeName==="CANVAS"||x.childNodes.length>0}Runner.prototype.addToInteractions=function(interactionVal){if(!isPrintableNode(interactionVal))return;while(this.interactionsDiv[0].firstChild)this.interactionsDiv[0].removeChild(this.interactionsDiv[0].firstChild);if(isDomNode(interactionVal)){interactionVal.style.display="inline-block";interactionVal.classList.add("replOutput");this.interactionsDiv.append(interactionVal)}else{var newArea=jQuery("<div style='width: 100%'></div>");
newArea.text(interactionVal);newArea.style.display="inline-block";this.interactionsDiv.append(newArea)}this.interactionsDiv.attr("scrollTop",this.interactionsDiv.attr("scrollHeight"))};Runner.prototype.renderErrorAsDomNode=function(err){var msg=this.evaluator.getMessageFromExn(err);var dom=document.createElement("div");dom["class"]="moby-error";var msgDom=document.createElement("div");msgDom["class"]="moby-error:message";msgDom.appendChild(document.createTextNode(msg));dom.appendChild(msgDom);var stacktrace=
this.evaluator.getTraceFromExn(err);for(var i=0;i<stacktrace.length;i++)dom.appendChild(document.createTextNode("at: line "+stacktrace[i].line+", column "+stacktrace[i].column));return dom};var initializeRoundRobinCompilation=function(evaluator,after){var that=this;var compilation_servers=[];plt.wescheme.RoundRobin.initialize(compilation_servers,function(){evaluator.setCompileProgram(plt.wescheme.RoundRobin.roundRobinCompiler);after()},()=>{evaluator.setCompileProgram(plt.wescheme.RoundRobin.roundRobinCompiler);
alert("WeScheme appears to be busy or unavailable at this time."+"  Please try again later.");after()})};function init(compilationServerUrl,publicId){var runner=new Runner(compilationServerUrl,document.getElementById("interactions"));var afterLoad=function(aProgram){var title=aProgram.getTitle(),sourceCode=aProgram.getSourceCode(),programCode=null,permissions=aProgram.getPermissions(),notes=aProgram.getNotes();var j=jQuery("#interactions"),b=document.getElementsByTagName("body")[0],desc=document.createElement("div"),
titlespan=document.createElement("span"),notesspan=document.createElement("span");desc.id="description";titlespan.id="title";notesspan.id="notes";titlespan.appendChild(document.createTextNode(title));notesspan.appendChild(document.createTextNode(notes));var supportsFullScreen=function(){var elem=document.createElement("div");return(elem.webkitRequestFullscreen||elem.mozRequestFullScreen||elem.msRequestFullscreen||elem.requestFullscreen)!==undefined};var toggleFullscreen=function(){var elem;if(j.find("canvas").length==
1)elem=j.find("canvas").get(0);else elem=j.get(0);elem.requestFullscreen=elem.requestFullscreen||elem.mozRequestFullScreen||elem.webkitRequestFullscreen||elem.msRequestFullscreen;document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen;var fullscreenElement=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;if(!fullscreenElement)elem.requestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
else document.exitFullscreen()};if(supportsFullScreen())jQuery("<input type='button' value='Run Fullscreen'>").css("margin-top","20px").css("display","block").css("margin-left","auto").css("margin-right","auto").click(toggleFullscreen).appendTo(b);var appendFinishedMsg=function(){var inter=document.getElementById("interactions");var finished=document.createElement("span");finished.id="finished";finished.innerHTML="The program has finished running, but only included definitions (which do not produce any output).";
if(inter.children.length==0)inter.appendChild(finished)};b.insertBefore(titlespan,b.firstChild);desc.appendChild(notesspan);b.appendChild(desc);document.title=title;if(programCode){runner.runCompiledCode(programCode,permissions);appendFinishedMsg()}else{initializeRoundRobinCompilation(runner.evaluator,function(){runner.runSourceCode(title,sourceCode,permissions)});appendFinishedMsg()}};(new plt.wescheme.AjaxActions).loadProject(null,publicId,afterLoad,function(){alert("unable to load program")})}
plt.wescheme.runner.Runner=Runner;plt.wescheme.runner.init=init})();
