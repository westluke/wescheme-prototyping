/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
var COMPILED=false;var goog=goog||{};goog.global=this||self;goog.global.CLOSURE_UNCOMPILED_DEFINES;goog.global.CLOSURE_DEFINES;
goog.exportPath_=function(name,object,overwriteImplicit,objectToExportTo){var parts=name.split(".");var cur=objectToExportTo||goog.global;if(!(parts[0]in cur)&&typeof cur.execScript!="undefined")cur.execScript("var "+parts[0]);for(var part;parts.length&&(part=parts.shift());)if(!parts.length&&object!==undefined)if(!overwriteImplicit&&goog.isObject(object)&&goog.isObject(cur[part]))for(var prop in object){if(object.hasOwnProperty(prop))cur[part][prop]=object[prop]}else cur[part]=object;else if(cur[part]&&
cur[part]!==Object.prototype[part])cur=cur[part];else cur=cur[part]={}};
goog.define=function(name,defaultValue){var value=defaultValue;if(!COMPILED){var uncompiledDefines=goog.global.CLOSURE_UNCOMPILED_DEFINES;var defines=goog.global.CLOSURE_DEFINES;if(uncompiledDefines&&uncompiledDefines.nodeType===undefined&&Object.prototype.hasOwnProperty.call(uncompiledDefines,name))value=uncompiledDefines[name];else if(defines&&defines.nodeType===undefined&&Object.prototype.hasOwnProperty.call(defines,name))value=defines[name]}return value};
goog.FEATURESET_YEAR=goog.define("goog.FEATURESET_YEAR",2012);goog.DEBUG=goog.define("goog.DEBUG",true);goog.LOCALE=goog.define("goog.LOCALE","en");goog.TRUSTED_SITE=goog.define("goog.TRUSTED_SITE",true);goog.DISALLOW_TEST_ONLY_CODE=goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG);goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=goog.define("goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING",false);
goog.provide=function(name){if(goog.isInModuleLoader_())throw new Error("goog.provide cannot be used within a module.");if(!COMPILED)if(goog.isProvided_(name))throw new Error('Namespace "'+name+'" already declared.');goog.constructNamespace_(name)};
goog.constructNamespace_=function(name,object,overwriteImplicit){if(!COMPILED){delete goog.implicitNamespaces_[name];var namespace=name;while(namespace=namespace.substring(0,namespace.lastIndexOf("."))){if(goog.getObjectByName(namespace))break;goog.implicitNamespaces_[namespace]=true}}goog.exportPath_(name,object,overwriteImplicit)};goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/;
goog.getScriptNonce_=function(opt_window){var doc=(opt_window||goog.global).document;var script=doc.querySelector&&doc.querySelector("script[nonce]");if(script){var nonce=script["nonce"]||script.getAttribute("nonce");if(nonce&&goog.NONCE_PATTERN_.test(nonce))return nonce}return""};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;
goog.module=function(name){if(typeof name!=="string"||!name||name.search(goog.VALID_MODULE_RE_)==-1)throw new Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw new Error("Module "+name+" has been loaded incorrectly. Note, "+"modules cannot be loaded as normal scripts. They require some kind of "+"pre-processing step. You're likely trying to load a module via a "+"script tag or as a part of a concatenated bundle without rewriting the "+"module. For more info see: "+"https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");
if(goog.moduleLoaderState_.moduleName)throw new Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=name;if(!COMPILED){if(goog.isProvided_(name))throw new Error('Namespace "'+name+'" already declared.');delete goog.implicitNamespaces_[name]}};goog.module.get=function(name){return goog.module.getInternal_(name)};
goog.module.getInternal_=function(name){if(!COMPILED)if(name in goog.loadedModules_)return goog.loadedModules_[name].exports;else if(!goog.implicitNamespaces_[name]){var ns=goog.getObjectByName(name);return ns!=null?ns:null}return null};goog.ModuleType={ES6:"es6",GOOG:"goog"};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()};
goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG};goog.isInEs6ModuleLoader_=function(){var inLoader=!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6;if(inLoader)return true;var jscomp=goog.global["$jscomp"];if(jscomp){if(typeof jscomp.getCurrentModulePath!="function")return false;return!!jscomp.getCurrentModulePath()}return false};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInGoogModuleLoader_())throw new Error("goog.module.declareLegacyNamespace must be called from "+"within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw new Error("goog.module must be called prior to "+"goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=true};
goog.declareModuleId=function(namespace){if(!COMPILED){if(!goog.isInEs6ModuleLoader_())throw new Error("goog.declareModuleId may only be called from "+"within an ES6 module");if(goog.moduleLoaderState_&&goog.moduleLoaderState_.moduleName)throw new Error("goog.declareModuleId may only be called once per module.");if(namespace in goog.loadedModules_)throw new Error('Module with namespace "'+namespace+'" already exists.');}if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=namespace;else{var jscomp=
goog.global["$jscomp"];if(!jscomp||typeof jscomp.getCurrentModulePath!="function")throw new Error('Module with namespace "'+namespace+'" has been loaded incorrectly.');var exports=jscomp.require(jscomp.getCurrentModulePath());goog.loadedModules_[namespace]={exports:exports,type:goog.ModuleType.ES6,moduleId:namespace}}};
goog.setTestOnly=function(opt_message){if(goog.DISALLOW_TEST_ONLY_CODE){opt_message=opt_message||"";throw new Error("Importing test-only code into non-debug environment"+(opt_message?": "+opt_message:"."));}};goog.forwardDeclare=function(name){};goog.forwardDeclare("Document");goog.forwardDeclare("HTMLScriptElement");goog.forwardDeclare("XMLHttpRequest");
if(!COMPILED){goog.isProvided_=function(name){return name in goog.loadedModules_||!goog.implicitNamespaces_[name]&&goog.getObjectByName(name)!=null};goog.implicitNamespaces_={"goog.module":true}}goog.getObjectByName=function(name,opt_obj){var parts=name.split(".");var cur=opt_obj||goog.global;for(var i=0;i<parts.length;i++){cur=cur[parts[i]];if(cur==null)return null}return cur};
goog.addDependency=function(relPath,provides,requires,opt_loadFlags){if(!COMPILED&&goog.DEPENDENCIES_ENABLED)goog.debugLoader_.addDependency(relPath,provides,requires,opt_loadFlags)};goog.ENABLE_DEBUG_LOADER=goog.define("goog.ENABLE_DEBUG_LOADER",false);goog.logToConsole_=function(msg){if(goog.global.console)goog.global.console["error"](msg)};
goog.require=function(namespace){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER)goog.debugLoader_.requested(namespace);if(goog.isProvided_(namespace)){if(goog.isInModuleLoader_())return goog.module.getInternal_(namespace)}else if(goog.ENABLE_DEBUG_LOADER){var moduleLoaderState=goog.moduleLoaderState_;goog.moduleLoaderState_=null;try{goog.debugLoader_.load_(namespace)}finally{goog.moduleLoaderState_=moduleLoaderState}}return null}};goog.requireType=function(namespace){return{}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;
goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.abstractMethod=function(){throw new Error("unimplemented abstract method");};goog.addSingletonGetter=function(ctor){ctor.instance_=undefined;ctor.getInstance=function(){if(ctor.instance_)return ctor.instance_;if(goog.DEBUG)goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=ctor;return ctor.instance_=new ctor}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=goog.define("goog.LOAD_MODULE_USING_EVAL",true);
goog.SEAL_MODULE_EXPORTS=goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG);goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;goog.TRANSPILE=goog.define("goog.TRANSPILE","detect");goog.ASSUME_ES_MODULES_TRANSPILED=goog.define("goog.ASSUME_ES_MODULES_TRANSPILED",false);goog.TRUSTED_TYPES_POLICY_NAME=goog.define("goog.TRUSTED_TYPES_POLICY_NAME","goog");goog.hasBadLetScoping=null;
goog.loadModule=function(moduleDef){var previousState=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:false,type:goog.ModuleType.GOOG};var origExports={};var exports=origExports;if(typeof moduleDef==="function")exports=moduleDef.call(undefined,exports);else if(typeof moduleDef==="string")exports=goog.loadModuleFromSource_.call(undefined,exports,moduleDef);else throw new Error("Invalid module definition");var moduleName=goog.moduleLoaderState_.moduleName;if(typeof moduleName===
"string"&&moduleName){if(goog.moduleLoaderState_.declareLegacyNamespace){var isDefaultExport=origExports!==exports;goog.constructNamespace_(moduleName,exports,isDefaultExport)}else if(goog.SEAL_MODULE_EXPORTS&&Object.seal&&typeof exports=="object"&&exports!=null)Object.seal(exports);var data={exports:exports,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName};goog.loadedModules_[moduleName]=data}else throw new Error('Invalid module name "'+moduleName+'"');}finally{goog.moduleLoaderState_=
previousState}};goog.loadModuleFromSource_=function(exports){eval(goog.CLOSURE_EVAL_PREFILTER_.createScript(arguments[1]));return exports};goog.normalizePath_=function(path){var components=path.split("/");var i=0;while(i<components.length)if(components[i]==".")components.splice(i,1);else if(i&&components[i]==".."&&components[i-1]&&components[i-1]!="..")components.splice(--i,2);else i++;return components.join("/")};goog.global.CLOSURE_LOAD_FILE_SYNC;
goog.loadFileSync_=function(src){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(src);else try{var xhr=new goog.global["XMLHttpRequest"];xhr.open("get",src,false);xhr.send();return xhr.status==0||xhr.status==200?xhr.responseText:null}catch(err){return null}};goog.typeOf=function(value){var s=typeof value;if(s!="object")return s;if(!value)return"null";if(Array.isArray(value))return"array";return s};
goog.isArrayLike=function(val){var type=goog.typeOf(val);return type=="array"||type=="object"&&typeof val.length=="number"};goog.isDateLike=function(val){return goog.isObject(val)&&typeof val.getFullYear=="function"};goog.isObject=function(val){var type=typeof val;return type=="object"&&val!=null||type=="function"};goog.getUid=function(obj){return Object.prototype.hasOwnProperty.call(obj,goog.UID_PROPERTY_)&&obj[goog.UID_PROPERTY_]||(obj[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(obj){return!!obj[goog.UID_PROPERTY_]};
goog.removeUid=function(obj){if(obj!==null&&"removeAttribute"in obj)obj.removeAttribute(goog.UID_PROPERTY_);try{delete obj[goog.UID_PROPERTY_]}catch(ex){}};goog.UID_PROPERTY_="closure_uid_"+(Math.random()*1E9>>>0);goog.uidCounter_=0;
goog.cloneObject=function(obj){var type=goog.typeOf(obj);if(type=="object"||type=="array"){if(typeof obj.clone==="function")return obj.clone();if(typeof Map!=="undefined"&&obj instanceof Map)return new Map(obj);else if(typeof Set!=="undefined"&&obj instanceof Set)return new Set(obj);var clone=type=="array"?[]:{};for(var key in obj)clone[key]=goog.cloneObject(obj[key]);return clone}return obj};goog.bindNative_=function(fn,selfObj,var_args){return fn.call.apply(fn.bind,arguments)};
goog.bindJs_=function(fn,selfObj,var_args){if(!fn)throw new Error;if(arguments.length>2){var boundArgs=Array.prototype.slice.call(arguments,2);return function(){var newArgs=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(newArgs,boundArgs);return fn.apply(selfObj,newArgs)}}else return function(){return fn.apply(selfObj,arguments)}};
goog.bind=function(fn,selfObj,var_args){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1)goog.bind=goog.bindNative_;else goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(fn,var_args){var args=Array.prototype.slice.call(arguments,1);return function(){var newArgs=args.slice();newArgs.push.apply(newArgs,arguments);return fn.apply(this,newArgs)}};goog.now=function(){return Date.now()};goog.globalEval=function(script){(0,eval)(script)};
goog.cssNameMapping_;goog.cssNameMappingStyle_;goog.global.CLOSURE_CSS_NAME_MAP_FN;
goog.getCssName=function(className,opt_modifier){if(String(className).charAt(0)==".")throw new Error('className passed in goog.getCssName must not start with ".".'+" You passed: "+className);var getMapping=function(cssName){return goog.cssNameMapping_[cssName]||cssName};var renameByParts=function(cssName){var parts=cssName.split("-");var mapped=[];for(var i=0;i<parts.length;i++)mapped.push(getMapping(parts[i]));return mapped.join("-")};var rename;if(goog.cssNameMapping_)rename=goog.cssNameMappingStyle_==
"BY_WHOLE"?getMapping:renameByParts;else rename=function(a){return a};var result=opt_modifier?className+"-"+rename(opt_modifier):rename(className);if(goog.global.CLOSURE_CSS_NAME_MAP_FN)return goog.global.CLOSURE_CSS_NAME_MAP_FN(result);return result};goog.setCssNameMapping=function(mapping,opt_style){goog.cssNameMapping_=mapping;goog.cssNameMappingStyle_=opt_style};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING)goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING;
goog.GetMsgOptions=function(){};goog.GetMsgOptions.prototype.html;goog.GetMsgOptions.prototype.unescapeHtmlEntities;goog.GetMsgOptions.prototype.original_code;goog.GetMsgOptions.prototype.example;
goog.getMsg=function(str,opt_values,opt_options){if(opt_options&&opt_options.html)str=str.replace(/</g,"&lt;");if(opt_options&&opt_options.unescapeHtmlEntities)str=str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&");if(opt_values)str=str.replace(/\{\$([^}]+)}/g,function(match,key){return opt_values!=null&&key in opt_values?opt_values[key]:match});return str};goog.getMsgWithFallback=function(a,b){return a};
goog.exportSymbol=function(publicPath,object,objectToExportTo){goog.exportPath_(publicPath,object,true,objectToExportTo)};goog.exportProperty=function(object,publicName,symbol){object[publicName]=symbol};
goog.inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor;childCtor.prototype.constructor=childCtor;childCtor.base=function(me,methodName,var_args){var args=new Array(arguments.length-2);for(var i=2;i<arguments.length;i++)args[i-2]=arguments[i];return parentCtor.prototype[methodName].apply(me,args)}};
goog.scope=function(fn){if(goog.isInModuleLoader_())throw new Error("goog.scope is not supported within a module.");fn.call(goog.global)};if(!COMPILED)goog.global["COMPILED"]=COMPILED;
goog.defineClass=function(superClass,def){var constructor=def.constructor;var statics=def.statics;if(!constructor||constructor==Object.prototype.constructor)constructor=function(){throw new Error("cannot instantiate an interface (no constructor defined).");};var cls=goog.defineClass.createSealingConstructor_(constructor,superClass);if(superClass)goog.inherits(cls,superClass);delete def.constructor;delete def.statics;goog.defineClass.applyProperties_(cls.prototype,def);if(statics!=null)if(statics instanceof
Function)statics(cls);else goog.defineClass.applyProperties_(cls,statics);return cls};goog.defineClass.ClassDescriptor;goog.defineClass.SEAL_CLASS_INSTANCES=goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG);goog.defineClass.createSealingConstructor_=function(ctr,superClass){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return ctr;var wrappedCtr=function(){var instance=ctr.apply(this,arguments)||this;instance[goog.UID_PROPERTY_]=instance[goog.UID_PROPERTY_];return instance};return wrappedCtr};
goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.defineClass.applyProperties_=function(target,source){var key;for(key in source)if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key];for(var i=0;i<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;i++){key=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[i];if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key]}};
goog.identity_=function(s){return s};goog.createTrustedTypesPolicy=function(name){var policy=null;var policyFactory=goog.global.trustedTypes;if(!policyFactory||!policyFactory.createPolicy)return policy;try{policy=policyFactory.createPolicy(name,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_})}catch(e){goog.logToConsole_(e.message)}return policy};
if(!COMPILED&&goog.DEPENDENCIES_ENABLED){goog.isEdge_=function(){var userAgent=goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"";var edgeRe=/Edge\/(\d+)(\.\d)*/i;return!!userAgent.match(edgeRe)};goog.inHtmlDocument_=function(){var doc=goog.global.document;return doc!=null&&"write"in doc};goog.isDocumentLoading_=function(){var doc=goog.global.document;return doc.attachEvent?doc.readyState!="complete":doc.readyState=="loading"};goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH!=
undefined&&typeof goog.global.CLOSURE_BASE_PATH==="string"){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else if(!goog.inHtmlDocument_())return;var doc=goog.global.document;var currentScript=doc.currentScript;if(currentScript)var scripts=[currentScript];else var scripts=doc.getElementsByTagName("SCRIPT");for(var i=scripts.length-1;i>=0;--i){var script=scripts[i];var src=script.src;var qmark=src.lastIndexOf("?");var l=qmark==-1?src.length:qmark;if(src.slice(l-7,l)=="base.js"){goog.basePath=src.slice(0,
l-7);return}}};goog.findBasePath_();goog.protectScriptTag_=function(str){return str.replace(/<\/(SCRIPT)/ig,"\\x3c/$1")};goog.DebugLoader_=function(){this.dependencies_={};this.idToPath_={};this.written_={};this.loadingDeps_=[];this.depsToLoad_=[];this.paused_=false;this.factory_=new goog.DependencyFactory;this.deferredCallbacks_={};this.deferredQueue_=[]};goog.DebugLoader_.prototype.bootstrap=function(namespaces,callback){var cb=callback;function resolve(){if(cb){goog.global.setTimeout(cb,0);cb=
null}}if(!namespaces.length){resolve();return}var deps=[];for(var i=0;i<namespaces.length;i++){var path=this.getPathFromDeps_(namespaces[i]);if(!path)throw new Error("Unregonized namespace: "+namespaces[i]);deps.push(this.dependencies_[path])}var require=goog.require;var loaded=0;for(var i=0;i<namespaces.length;i++){require(namespaces[i]);deps[i].onLoad(function(){if(++loaded==namespaces.length)resolve()})}};goog.DebugLoader_.prototype.loadClosureDeps=function(){var relPath="deps.js";this.depsToLoad_.push(this.factory_.createDependency(goog.normalizePath_(goog.basePath+
relPath),relPath,[],[],{}));this.loadDeps_()};goog.DebugLoader_.prototype.requested=function(absPathOrId,opt_force){var path=this.getPathFromDeps_(absPathOrId);if(path&&(opt_force||this.areDepsLoaded_(this.dependencies_[path].requires))){var callback=this.deferredCallbacks_[path];if(callback){delete this.deferredCallbacks_[path];callback()}}};goog.DebugLoader_.prototype.setDependencyFactory=function(factory){this.factory_=factory};goog.DebugLoader_.prototype.load_=function(namespace){if(!this.getPathFromDeps_(namespace)){var errorMessage=
"goog.require could not find: "+namespace;goog.logToConsole_(errorMessage)}else{var loader=this;var deps=[];var visit=function(namespace){var path=loader.getPathFromDeps_(namespace);if(!path)throw new Error("Bad dependency path or symbol: "+namespace);if(loader.written_[path])return;loader.written_[path]=true;var dep=loader.dependencies_[path];for(var i=0;i<dep.requires.length;i++)if(!goog.isProvided_(dep.requires[i]))visit(dep.requires[i]);deps.push(dep)};visit(namespace);var wasLoading=!!this.depsToLoad_.length;
this.depsToLoad_=this.depsToLoad_.concat(deps);if(!this.paused_&&!wasLoading)this.loadDeps_()}};goog.DebugLoader_.prototype.loadDeps_=function(){var loader=this;var paused=this.paused_;while(this.depsToLoad_.length&&!paused)(function(){var loadCallDone=false;var dep=loader.depsToLoad_.shift();var loaded=false;loader.loading_(dep);var controller={pause:function(){if(loadCallDone)throw new Error("Cannot call pause after the call to load.");else paused=true},resume:function(){if(loadCallDone)loader.resume_();
else paused=false},loaded:function(){if(loaded)throw new Error("Double call to loaded.");loaded=true;loader.loaded_(dep)},pending:function(){var pending=[];for(var i=0;i<loader.loadingDeps_.length;i++)pending.push(loader.loadingDeps_[i]);return pending},setModuleState:function(type){goog.moduleLoaderState_={type:type,moduleName:"",declareLegacyNamespace:false}},registerEs6ModuleExports:function(path,exports,opt_closureNamespace){if(opt_closureNamespace)goog.loadedModules_[opt_closureNamespace]={exports:exports,
type:goog.ModuleType.ES6,moduleId:opt_closureNamespace||""}},registerGoogModuleExports:function(moduleId,exports){goog.loadedModules_[moduleId]={exports:exports,type:goog.ModuleType.GOOG,moduleId:moduleId}},clearModuleState:function(){goog.moduleLoaderState_=null},defer:function(callback){if(loadCallDone)throw new Error("Cannot register with defer after the call to load.");loader.defer_(dep,callback)},areDepsLoaded:function(){return loader.areDepsLoaded_(dep.requires)}};try{dep.load(controller)}finally{loadCallDone=
true}})();if(paused)this.pause_()};goog.DebugLoader_.prototype.pause_=function(){this.paused_=true};goog.DebugLoader_.prototype.resume_=function(){if(this.paused_){this.paused_=false;this.loadDeps_()}};goog.DebugLoader_.prototype.loading_=function(dep){this.loadingDeps_.push(dep)};goog.DebugLoader_.prototype.loaded_=function(dep){for(var i=0;i<this.loadingDeps_.length;i++)if(this.loadingDeps_[i]==dep){this.loadingDeps_.splice(i,1);break}for(var i=0;i<this.deferredQueue_.length;i++)if(this.deferredQueue_[i]==
dep.path){this.deferredQueue_.splice(i,1);break}if(this.loadingDeps_.length==this.deferredQueue_.length&&!this.depsToLoad_.length)while(this.deferredQueue_.length)this.requested(this.deferredQueue_.shift(),true);dep.loaded()};goog.DebugLoader_.prototype.areDepsLoaded_=function(pathsOrIds){for(var i=0;i<pathsOrIds.length;i++){var path=this.getPathFromDeps_(pathsOrIds[i]);if(!path||!(path in this.deferredCallbacks_)&&!goog.isProvided_(pathsOrIds[i]))return false}return true};goog.DebugLoader_.prototype.getPathFromDeps_=
function(absPathOrId){if(absPathOrId in this.idToPath_)return this.idToPath_[absPathOrId];else if(absPathOrId in this.dependencies_)return absPathOrId;else return null};goog.DebugLoader_.prototype.defer_=function(dependency,callback){this.deferredCallbacks_[dependency.path]=callback;this.deferredQueue_.push(dependency.path)};goog.LoadController=function(){};goog.LoadController.prototype.pause=function(){};goog.LoadController.prototype.resume=function(){};goog.LoadController.prototype.loaded=function(){};
goog.LoadController.prototype.pending=function(){};goog.LoadController.prototype.registerEs6ModuleExports=function(path,exports,opt_closureNamespace){};goog.LoadController.prototype.setModuleState=function(type){};goog.LoadController.prototype.clearModuleState=function(){};goog.LoadController.prototype.defer=function(callback){};goog.LoadController.prototype.areDepsLoaded=function(){};goog.Dependency=function(path,relativePath,provides,requires,loadFlags){this.path=path;this.relativePath=relativePath;
this.provides=provides;this.requires=requires;this.loadFlags=loadFlags;this.loaded_=false;this.loadCallbacks_=[]};goog.Dependency.prototype.getPathName=function(){var pathName=this.path;var protocolIndex=pathName.indexOf("://");if(protocolIndex>=0){pathName=pathName.substring(protocolIndex+3);var slashIndex=pathName.indexOf("/");if(slashIndex>=0)pathName=pathName.substring(slashIndex+1)}return pathName};goog.Dependency.prototype.onLoad=function(callback){if(this.loaded_)callback();else this.loadCallbacks_.push(callback)};
goog.Dependency.prototype.loaded=function(){this.loaded_=true;var callbacks=this.loadCallbacks_;this.loadCallbacks_=[];for(var i=0;i<callbacks.length;i++)callbacks[i]()};goog.Dependency.defer_=false;goog.Dependency.callbackMap_={};goog.Dependency.registerCallback_=function(callback){var key=Math.random().toString(32);goog.Dependency.callbackMap_[key]=callback;return key};goog.Dependency.unregisterCallback_=function(key){delete goog.Dependency.callbackMap_[key]};goog.Dependency.callback_=function(key,
var_args){if(key in goog.Dependency.callbackMap_){var callback=goog.Dependency.callbackMap_[key];var args=[];for(var i=1;i<arguments.length;i++)args.push(arguments[i]);callback.apply(undefined,args)}else{var errorMessage="Callback key "+key+" does not exist (was base.js loaded more than once?).";throw Error(errorMessage);}};goog.Dependency.prototype.load=function(controller){if(goog.global.CLOSURE_IMPORT_SCRIPT){if(goog.global.CLOSURE_IMPORT_SCRIPT(this.path))controller.loaded();else controller.pause();
return}if(!goog.inHtmlDocument_()){goog.logToConsole_("Cannot use default debug loader outside of HTML documents.");if(this.relativePath=="deps.js"){goog.logToConsole_("Consider setting CLOSURE_IMPORT_SCRIPT before loading base.js, "+"or setting CLOSURE_NO_DEPS to true.");controller.loaded()}else controller.pause();return}var doc=goog.global.document;if(doc.readyState=="complete"&&!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING){var isDeps=/\bdeps.js$/.test(this.path);if(isDeps){controller.loaded();return}else throw Error('Cannot write "'+
this.path+'" after document load');}var nonce=goog.getScriptNonce_();if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&goog.isDocumentLoading_()){var key;var callback=function(script){if(script.readyState&&script.readyState!="complete"){script.onload=callback;return}goog.Dependency.unregisterCallback_(key);controller.loaded()};key=goog.Dependency.registerCallback_(callback);var defer=goog.Dependency.defer_?" defer":"";var nonceAttr=nonce?' nonce="'+nonce+'"':"";var script='<script src="'+this.path+
'"'+nonceAttr+defer+' id="script-'+key+'">\x3c/script>';script+="<script"+nonceAttr+">";if(goog.Dependency.defer_)script+="document.getElementById('script-"+key+"').onload = function() {\n"+"  goog.Dependency.callback_('"+key+"', this);\n"+"};\n";else script+="goog.Dependency.callback_('"+key+"', document.getElementById('script-"+key+"'));";script+="\x3c/script>";doc.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(script):script)}else{var scriptEl=doc.createElement("script");
scriptEl.defer=goog.Dependency.defer_;scriptEl.async=false;if(nonce)scriptEl.nonce=nonce;scriptEl.onload=function(){scriptEl.onload=null;controller.loaded()};scriptEl.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(this.path):this.path;doc.head.appendChild(scriptEl)}};goog.Es6ModuleDependency=function(path,relativePath,provides,requires,loadFlags){goog.Es6ModuleDependency.base(this,"constructor",path,relativePath,provides,requires,loadFlags)};goog.inherits(goog.Es6ModuleDependency,
goog.Dependency);goog.Es6ModuleDependency.prototype.load=function(controller){if(goog.global.CLOSURE_IMPORT_SCRIPT){if(goog.global.CLOSURE_IMPORT_SCRIPT(this.path))controller.loaded();else controller.pause();return}if(!goog.inHtmlDocument_()){goog.logToConsole_("Cannot use default debug loader outside of HTML documents.");controller.pause();return}var doc=goog.global.document;var dep=this;function write(src,contents){var nonceAttr="";var nonce=goog.getScriptNonce_();if(nonce)nonceAttr=' nonce="'+
nonce+'"';if(contents){var script='<script type="module" crossorigin'+nonceAttr+">"+contents+"</"+"script>";doc.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(script):script)}else{var script='<script type="module" crossorigin src="'+src+'"'+nonceAttr+"></"+"script>";doc.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(script):script)}}function append(src,contents){var scriptEl=doc.createElement("script");scriptEl.defer=true;scriptEl.async=false;scriptEl.type=
"module";scriptEl.setAttribute("crossorigin",true);var nonce=goog.getScriptNonce_();if(nonce)scriptEl.nonce=nonce;if(contents)scriptEl.text=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScript(contents):contents;else scriptEl.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(src):src;doc.head.appendChild(scriptEl)}var create;if(goog.isDocumentLoading_()){create=write;goog.Dependency.defer_=true}else create=append;var beforeKey=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(beforeKey);
controller.setModuleState(goog.ModuleType.ES6)});create(undefined,'goog.Dependency.callback_("'+beforeKey+'")');create(this.path,undefined);var registerKey=goog.Dependency.registerCallback_(function(exports){goog.Dependency.unregisterCallback_(registerKey);controller.registerEs6ModuleExports(dep.path,exports,goog.moduleLoaderState_.moduleName)});create(undefined,'import * as m from "'+this.path+'"; goog.Dependency.callback_("'+registerKey+'", m)');var afterKey=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(afterKey);
controller.clearModuleState();controller.loaded()});create(undefined,'goog.Dependency.callback_("'+afterKey+'")')};goog.TransformedDependency=function(path,relativePath,provides,requires,loadFlags){goog.TransformedDependency.base(this,"constructor",path,relativePath,provides,requires,loadFlags);this.contents_=null;this.lazyFetch_=!goog.inHtmlDocument_()||!("noModule"in goog.global.document.createElement("script"))};goog.inherits(goog.TransformedDependency,goog.Dependency);goog.TransformedDependency.prototype.load=
function(controller){var dep=this;function fetch(){dep.contents_=goog.loadFileSync_(dep.path);if(dep.contents_){dep.contents_=dep.transform(dep.contents_);if(dep.contents_)dep.contents_+="\n//# sourceURL="+dep.path}}if(goog.global.CLOSURE_IMPORT_SCRIPT){fetch();if(this.contents_&&goog.global.CLOSURE_IMPORT_SCRIPT("",this.contents_)){this.contents_=null;controller.loaded()}else controller.pause();return}var isEs6=this.loadFlags["module"]==goog.ModuleType.ES6;if(!this.lazyFetch_)fetch();function load(){if(dep.lazyFetch_)fetch();
if(!dep.contents_)return;if(isEs6)controller.setModuleState(goog.ModuleType.ES6);var namespace;try{var contents=dep.contents_;dep.contents_=null;goog.globalEval(goog.CLOSURE_EVAL_PREFILTER_.createScript(contents));if(isEs6)namespace=goog.moduleLoaderState_.moduleName}finally{if(isEs6)controller.clearModuleState()}if(isEs6)goog.global["$jscomp"]["require"]["ensure"]([dep.getPathName()],function(){controller.registerEs6ModuleExports(dep.path,goog.global["$jscomp"]["require"](dep.getPathName()),namespace)});
controller.loaded()}function fetchInOwnScriptThenLoad(){var doc=goog.global.document;var key=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(key);load()});var nonce=goog.getScriptNonce_();var nonceAttr=nonce?' nonce="'+nonce+'"':"";var script="<script"+nonceAttr+">"+goog.protectScriptTag_('goog.Dependency.callback_("'+key+'");')+"</"+"script>";doc.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(script):script)}var anythingElsePending=controller.pending().length>
1;var needsAsyncLoading=goog.Dependency.defer_&&(anythingElsePending||goog.isDocumentLoading_());if(needsAsyncLoading){controller.defer(function(){load()});return}var doc=goog.global.document;var isInternetExplorerOrEdge=goog.inHtmlDocument_()&&("ActiveXObject"in goog.global||goog.isEdge_());if(isEs6&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()&&!isInternetExplorerOrEdge){goog.Dependency.defer_=true;controller.pause();var oldCallback=doc.onreadystatechange;doc.onreadystatechange=function(){if(doc.readyState==
"interactive"){doc.onreadystatechange=oldCallback;load();controller.resume()}if(typeof oldCallback==="function")oldCallback.apply(undefined,arguments)}}else if(!goog.inHtmlDocument_()||!goog.isDocumentLoading_())load();else fetchInOwnScriptThenLoad()};goog.TransformedDependency.prototype.transform=function(contents){};goog.PreTranspiledEs6ModuleDependency=function(path,relativePath,provides,requires,loadFlags){goog.PreTranspiledEs6ModuleDependency.base(this,"constructor",path,relativePath,provides,
requires,loadFlags)};goog.inherits(goog.PreTranspiledEs6ModuleDependency,goog.TransformedDependency);goog.PreTranspiledEs6ModuleDependency.prototype.transform=function(contents){return contents};goog.GoogModuleDependency=function(path,relativePath,provides,requires,loadFlags){goog.GoogModuleDependency.base(this,"constructor",path,relativePath,provides,requires,loadFlags)};goog.inherits(goog.GoogModuleDependency,goog.TransformedDependency);goog.GoogModuleDependency.prototype.transform=function(contents){if(!goog.LOAD_MODULE_USING_EVAL||
goog.global.JSON===undefined)return""+"goog.loadModule(function(exports) {"+'"use strict";'+contents+"\n"+";return exports"+"});"+"\n//# sourceURL="+this.path+"\n";else return""+"goog.loadModule("+goog.global.JSON.stringify(contents+"\n//# sourceURL="+this.path+"\n")+");"};goog.DebugLoader_.prototype.addDependency=function(relPath,provides,requires,opt_loadFlags){provides=provides||[];relPath=relPath.replace(/\\/g,"/");var path=goog.normalizePath_(goog.basePath+relPath);if(!opt_loadFlags||typeof opt_loadFlags===
"boolean")opt_loadFlags=opt_loadFlags?{"module":goog.ModuleType.GOOG}:{};var dep=this.factory_.createDependency(path,relPath,provides,requires,opt_loadFlags);this.dependencies_[path]=dep;for(var i=0;i<provides.length;i++)this.idToPath_[provides[i]]=path;this.idToPath_[relPath]=path};goog.DependencyFactory=function(){};goog.DependencyFactory.prototype.createDependency=function(path,relativePath,provides,requires,loadFlags){if(loadFlags["module"]==goog.ModuleType.GOOG)return new goog.GoogModuleDependency(path,
relativePath,provides,requires,loadFlags);else if(loadFlags["module"]==goog.ModuleType.ES6)if(goog.ASSUME_ES_MODULES_TRANSPILED)return new goog.PreTranspiledEs6ModuleDependency(path,relativePath,provides,requires,loadFlags);else return new goog.Es6ModuleDependency(path,relativePath,provides,requires,loadFlags);else return new goog.Dependency(path,relativePath,provides,requires,loadFlags)};goog.debugLoader_=new goog.DebugLoader_;goog.loadClosureDeps=function(){goog.debugLoader_.loadClosureDeps()};
goog.setDependencyFactory=function(factory){goog.debugLoader_.setDependencyFactory(factory)};goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null;if(!goog.global.CLOSURE_NO_DEPS)goog.debugLoader_.loadClosureDeps();goog.bootstrap=function(namespaces,callback){goog.debugLoader_.bootstrap(namespaces,callback)}}
if(!COMPILED){var isChrome87=false;try{isChrome87=eval(goog.global.trustedTypes.emptyScript)!==goog.global.trustedTypes.emptyScript}catch(err){}goog.CLOSURE_EVAL_PREFILTER_=goog.global.trustedTypes&&isChrome87&&goog.createTrustedTypesPolicy("goog#base#devonly#eval")||{createScript:goog.identity_}};goog.provide("plt.compiler.throwError");goog.provide("plt.compiler.Program");goog.provide("plt.compiler.comment");goog.provide("plt.compiler.couple");goog.provide("plt.compiler.defFunc");goog.provide("plt.compiler.defVar");goog.provide("plt.compiler.defVars");goog.provide("plt.compiler.defStruct");goog.provide("plt.compiler.beginExpr");goog.provide("plt.compiler.lambdaExpr");goog.provide("plt.compiler.localExpr");goog.provide("plt.compiler.letrecExpr");goog.provide("plt.compiler.letExpr");goog.provide("plt.compiler.letStarExpr");
goog.provide("plt.compiler.condExpr");goog.provide("plt.compiler.caseExpr");goog.provide("plt.compiler.andExpr");goog.provide("plt.compiler.orExpr");goog.provide("plt.compiler.callExpr");goog.provide("plt.compiler.ifExpr");goog.provide("plt.compiler.whenUnlessExpr");goog.provide("plt.compiler.symbolExpr");goog.provide("plt.compiler.literal");goog.provide("plt.compiler.quotedExpr");goog.provide("plt.compiler.unquotedExpr");goog.provide("plt.compiler.quasiquotedExpr");goog.provide("plt.compiler.unquoteSplice");
goog.provide("plt.compiler.requireExpr");goog.provide("plt.compiler.provideStatement");goog.provide("plt.compiler.unsupportedExpr");goog.provide("plt.compiler.pinfo");goog.provide("plt.compiler.getBasePinfo");goog.provide("plt.compiler.isExpression");goog.provide("plt.compiler.isDefinition");goog.provide("plt.compiler.env");goog.provide("plt.compiler.emptyEnv");goog.provide("plt.compiler.localEnv");goog.provide("plt.compiler.globalEnv");goog.provide("plt.compiler.moduleBinding");goog.provide("plt.compiler.functionBinding");
goog.provide("plt.compiler.constantBinding");goog.provide("plt.compiler.structBinding");goog.provide("plt.compiler.unnamedEnv");window.plt=window.plt||{};plt.compiler=plt.compiler||{};
(function(){var unimplementedException=function(str){this.str=str};function throwError(msg,loc,errorClass){loc.source=loc.source||"<unknown>";function rewritePart(part){if(typeof part==="string")return part;else if(part instanceof symbolExpr){return'["span", [["class", "SchemeValue-Symbol"]], '+part.val+"]";return part.val}else if(part.location!==undefined)return{text:part.text,type:"ColoredPart",loc:part.location.toString(),toString:function(){return part.text}};else if(part.locations!==undefined)return{text:part.text,
type:"MultiPart",solid:part.solid,locs:part.locations.map(function(l){return l.toString()}),toString:function(){return part.text}}}msg.args=msg.args.map(rewritePart);var json={type:"moby-failure","dom-message":["span",[["class","Error"]],["span",[["class",errorClass||"Message"]]].concat(errorClass?[["span",[["class","Error.reason"]],msg.toString()],["span",[["class",(errorClass||"message")+(errorClass==="Error-GenericReadError"?".locations":".otherLocations")]]]]:msg.args.map(function(x){return x.toString()})),
["br",[],""],["span",[["class","Error.location"]],["span",[["class","location-reference"],["style","display:none"]],["span",[["class","location-offset"]],(loc.startChar+1).toString()],["span",[["class","location-line"]],loc.startRow.toString()],["span",[["class","location-column"]],loc.startCol.toString()],["span",[["class","location-span"]],loc.span.toString()],["span",[["class","location-id"]],loc.source.toString()]]]],"structured-error":JSON.stringify({message:errorClass?false:msg.args,location:loc.toString()})};
throw JSON.stringify(json);}function couple(first,second){this.first=first;this.second=second;this.toString=function(){return"("+this.first.toString()+" "+this.second.toString()+")"}}var heir=function(p){var f=function(){};f.prototype=p;return new f};var Program=function(){this.toString=function(){return this.val.toString()};this.location=null};function comment(txt){Program.call(this);this.txt=txt;this.toString=function(){return";"+this.txt}}comment.prototype=heir(Program.prototype);function defFunc(name,
args,body,stx){Program.call(this);this.name=name;this.args=args;this.body=body;this.stx=stx;this.toString=function(){return"(define ("+this.name.toString()+" "+this.args.join(" ")+")\n    "+this.body.toString()+")"}}defFunc.prototype=heir(Program.prototype);function defVar(name,expr,stx){Program.call(this);this.name=name;this.expr=expr;this.stx=stx;this.toString=function(){return"(define "+this.name.toString()+" "+this.expr.toString()+")"}}defVar.prototype=heir(Program.prototype);function defVars(names,
expr,stx){Program.call(this);this.names=names;this.expr=expr;this.stx=stx;this.toString=function(){return"(define-values ("+this.names.join(" ")+") "+this.expr.toString()+")"}}defVars.prototype=heir(Program.prototype);function defStruct(name,fields,stx){Program.call(this);this.name=name;this.fields=fields;this.stx=stx;this.toString=function(){return"(define-struct "+this.name.toString()+" ("+this.fields.toString()+"))"}}defStruct.prototype=heir(Program.prototype);function beginExpr(exprs,stx){Program.call(this);
this.exprs=exprs;this.stx=stx;this.toString=function(){return"(begin "+this.exprs.join(" ")+")"}}beginExpr.prototype=heir(Program.prototype);function lambdaExpr(args,body,stx){Program.call(this);this.args=args;this.body=body;this.stx=stx;this.toString=function(){return"(lambda ("+this.args.join(" ")+") "+this.body.toString()+")"}}lambdaExpr.prototype=heir(Program.prototype);function localExpr(defs,body,stx){Program.call(this);this.defs=defs;this.body=body;this.stx=stx;this.toString=function(){return"(local ("+
this.defs.toString()+") "+this.body.toString()+")"}}localExpr.prototype=heir(Program.prototype);function letrecExpr(bindings,body,stx){this.bindings=bindings;this.body=body;this.stx=stx;this.toString=function(){return"(letrec ("+this.bindings.toString()+") ("+this.body.toString()+"))"}}function letExpr(bindings,body,stx){this.bindings=bindings;this.body=body;this.stx=stx;this.toString=function(){return"(let ("+this.bindings.toString()+") ("+this.body.toString()+"))"}}function letStarExpr(bindings,
body,stx){this.bindings=bindings;this.body=body;this.stx=stx;this.toString=function(){return"(let* ("+this.bindings.toString()+") ("+this.body.toString()+"))"}}function condExpr(clauses,stx){this.clauses=clauses;this.stx=stx;this.toString=function(){return"(cond\n    "+this.clauses.join("\n    ")+")"}}function caseExpr(expr,clauses,stx){Program.call(this);this.expr=expr;this.clauses=clauses;this.stx=stx;this.toString=function(){return"(case "+this.expr.toString()+"\n    "+this.clauses.join("\n    ")+
")"}}caseExpr.prototype=heir(Program.prototype);function andExpr(exprs,stx){this.exprs=exprs;this.stx=stx;this.toString=function(){return"(and "+this.exprs.join(" ")+")"}}function orExpr(exprs,stx){this.exprs=exprs;this.stx=stx;this.toString=function(){return"(or "+this.exprs.toString()+")"}}function callExpr(func,args,stx){Program.call(this);this.func=func;this.args=args;this.stx=stx;this.toString=function(){return"("+[this.func].concat(this.args).join(" ")+")"}}callExpr.prototype=heir(Program.prototype);
function ifExpr(predicate,consequence,alternative,stx){Program.call(this);this.predicate=predicate;this.consequence=consequence;this.alternative=alternative;this.stx=stx;this.toString=function(){return"(if "+this.predicate.toString()+" "+this.consequence.toString()+" "+this.alternative.toString()+")"}}ifExpr.prototype=heir(Program.prototype);function whenUnlessExpr(predicate,exprs,stx){Program.call(this);this.predicate=predicate;this.exprs=exprs;this.stx=stx;this.toString=function(){return"("+this.stx[0]+
" "+this.predicate.toString()+" "+this.exprs.toString()+")"}}whenUnlessExpr.prototype=heir(Program.prototype);function symbolExpr(val,stx){Program.call(this);this.val=val;this.stx=stx}symbolExpr.prototype=heir(Program.prototype);function literal(val){Program.call(this);this.val=val;this.toString=function(){if(this.val===true)return"#t";if(this.val===false)return"#f";if(this.val instanceof Char){var c=this.val.val;return c==="\b"?"#\\backspace":c==="\t"?"#\\tab":c==="\n"?"#\\newline":c===" "?"#\\space":
c==="\v"?"#\\vtab":this.val.toWrittenString()}return types.toWrittenString(this.val)}}literal.prototype=heir(Program.prototype);Vector.prototype.toString=Vector.prototype.toWrittenString=function(){var filtered=this.elts.filter(function(e){return e!==undefined}),last=filtered[filtered.length-1];return"#("+this.elts.map(function(elt){return elt===undefined?last:elt})+")"};function quotedExpr(val){Program.call(this);this.val=val;this.toString=function(){function quoteLikePairP(v){return v instanceof
Array&&v.length===2&&v[0]instanceof symbolExpr&&(v[0].val==="quasiquote"||v[0].val==="quote"||v[0].val==="unquote"||v[0].val==="unquote-splicing")}function shortName(lexeme){var s=lexeme.val;return s==="quasiquote"?"`":s==="quote"?"'":s==="unquote"?",":s==="unquote-splicing"?",@":function(){throw"impossible quote-like string";}()}function elementToString(v){if(quoteLikePairP(v))return shortName(v[0]).concat(elementToString(v[1]));else if(v instanceof Array)return v.reduce(function(acc,x){return acc.concat(elementToString(x))},
"(").concat(")");else return v.toString()}return"'"+elementToString(this.val)}}quotedExpr.prototype=heir(Program.prototype);function unquotedExpr(val){Program.call(this);this.val=val;this.toString=function(){return","+this.val.toString()}}unquotedExpr.prototype=heir(Program.prototype);function quasiquotedExpr(val){Program.call(this);this.val=val;this.toString=function(){if(this.val instanceof Array)return"`("+this.val.toString()+")";else return"`"+this.val.toString()}}quasiquotedExpr.prototype=heir(Program.prototype);
function unquoteSplice(val){Program.call(this);this.val=val;this.toString=function(){return",@"+this.val.toString()}}unquoteSplice.prototype=heir(Program.prototype);function requireExpr(spec,stx){Program.call(this);this.spec=spec;this.stx=stx;this.toString=function(){return"(require "+this.spec.toString()+")"}}requireExpr.prototype=heir(Program.prototype);function provideStatement(clauses,stx){Program.call(this);this.clauses=clauses;this.stx=stx;this.toString=function(){return"(provide "+this.clauses.toString()+
")"}}provideStatement.prototype=heir(Program.prototype);function unsupportedExpr(val,errorMsg,errorSpan){Program.call(this);this.val=val;this.errorMsg=errorMsg;this.errorSpan=errorSpan;this.toString=function(){return this.val.toString()}}unsupportedExpr.prototype=heir(Program.prototype);function isExpression(node){return!(node instanceof defVar||node instanceof defVars||node instanceof defStruct||node instanceof defFunc||node instanceof provideStatement||node instanceof unsupportedExpr||node instanceof
requireExpr)}function isDefinition(node){return node instanceof defVar||node instanceof defVars||node instanceof defStruct||node instanceof defFunc}function moduleBinding(name,bindings){this.name=name;this.bindings=bindings}function constantBinding(name,moduleSource,permissions,loc){this.name=name;this.moduleSource=moduleSource;this.permissions=permissions;this.loc=loc;this.toString=function(){return this.name};return this}function functionBinding(name,moduleSource,minArity,isVarArity,permissions,
isCps,loc){this.name=name;this.moduleSource=moduleSource;this.minArity=minArity;this.isVarArity=isVarArity;this.permissions=permissions;this.isCps=isCps;this.loc=loc;this.toString=function(){return this.name};return this}function structBinding(name,moduleSource,fields,constructor,predicate,accessors,mutators,permissions,loc){this.name=name;this.moduleSource=moduleSource;this.fields=fields;this.constructor=constructor;this.predicate=predicate;this.accessors=accessors;this.mutators=mutators;this.permissions=
permissions;this.loc=loc;this.toString=function(){return this.name};return this}var makeHash=types.makeLowLevelEqHash;plt.compiler.keywords=["cond","else","let","case","let*","letrec","quote","quasiquote","unquote","unquote-splicing","local","begin","if","or","and","when","unless","lambda","\u03bb","define","define-struct","define-values"];function env(bindings){var that=this;this.bindings=bindings||makeHash();this.lookup=function(id){return this.bindings.containsKey(id)?this.bindings.get(id):false};
this.peek=function(depth){return depth==0?this:this instanceof emptyEnv?"IMPOSSIBLE - peeked at an emptyEnv!":this.parent.peek(depth-1)};this.contains=function(name){return this.lookup(name)!==false};this.keys=this.bindings.keys;this.extend=function(binding){this.bindings.put(binding.name,binding);return new plt.compiler.env(this.bindings)};this.extendFunction=function(id,moduleSource,minArity,isVarArity,loc){return this.extend(new functionBinding(id,moduleSource,minArity,isVarArity,[],false,loc))};
this.extendConstant=function(id,moduleSource,loc){return this.extend(new constantBinding(id,moduleSource,[],loc))};this.lookup_context=function(id){if(id.context instanceof env)return id.context.contains(id)?id.context.lookup(id):false;else return that.contains(id)?that.lookup(id):false};this.extendEnv_moduleBinding=function(module){return module.bindings.reduceRight(function(env,binding){return env.extend(binding)},this)};this.toString=function(){return this.bindings.values().reduce(function(s,b){return s+
"\n  |---"+b.name},"")}}function emptyEnv(){env.call(this);this.lookup=function(name,depth){return new plt.compiler.unboundStackReference(name)}}emptyEnv.prototype=heir(env.prototype);function unnamedEnv(parent){env.call(this);this.parent=parent;this.lookup=function(name,depth){return this.parent.lookup(name,depth+1)}}unnamedEnv.prototype=heir(env.prototype);function localEnv(name,boxed,parent){env.call(this);this.name=name;this.boxed=boxed;this.parent=parent;this.lookup=function(name,depth){return name===
this.name?new plt.compiler.localStackReference(name,this.boxed,depth):this.parent.lookup(name,depth+1)}}localEnv.prototype=heir(env.prototype);function globalEnv(names,boxed,parent){env.call(this);this.names=names;this.boxed=boxed;this.parent=parent;var that=this;this.lookup=function(name,depth){var pos=this.names.indexOf(name);return pos>-1?new plt.compiler.globalStackReference(name,depth,pos):this.parent.lookup(name,depth+1)}}globalEnv.prototype=heir(env.prototype);var defaultCurrentModulePath=
"";plt.compiler.defaultModuleResolver=function(name){for(var i=0;i<plt.compiler.knownModules.length;i++)if(plt.compiler.knownModules[i].name===name)return plt.compiler.knownModules[i];return false};function levenshteinDistance(a,b){if(a.length===0)return b.length;if(b.length===0)return a.length;var matrix=[];for(var i=0;i<=b.length;i++)matrix[i]=[i];for(var j=0;j<=a.length;j++)matrix[0][j]=j;for(i=1;i<=b.length;i++)for(j=1;j<=a.length;j++)if(b.charAt(i-1)==a.charAt(j-1))matrix[i][j]=matrix[i-1][j-
1];else matrix[i][j]=Math.min(matrix[i-1][j-1]+1,Math.min(matrix[i][j-1]+1,matrix[i-1][j]+1));return matrix[b.length][a.length]}plt.compiler.moduleGuess=function(wrongName){return plt.compiler.knownModules.reduce(function(best,module){var dist=levenshteinDistance(module.name,wrongName);return dist<best.distance?{name:module.name,distance:dist}:best},{name:wrongName,distance:5})};plt.compiler.defaultModulePathResolver=function(path,parentPath){var parts=path.toString().split("/"),collectionName=parts[0],
moduleName=parts.slice(1).join();return plt.compiler.knownCollections.indexOf(collectionName)>-1&&plt.compiler.defaultModuleResolver(path.toString())||/^wescheme\/\w+$/.exec(path)};function pinfo(env,modules,usedBindingsHash,freeVariables,gensymCounter,providedNames,definedNames,sharedExpressions,withLocationEmits,allowRedefinition,moduleResolver,modulePathResolver,currentModulePath,declaredPermissions){this.env=env||new emptyEnv;this.modules=modules||[];this.usedBindingsHash=usedBindingsHash||makeHash();
this.freeVariables=freeVariables||[];this.gensymCounter=gensymCounter||0;this.providedNames=providedNames||makeHash();this.definedNames=definedNames||makeHash();this.sharedExpressions=sharedExpressions||makeHash();this.withLocationEmits=withLocationEmits||true;this.allowRedefinition=allowRedefinition||false;this.moduleResolver=moduleResolver||plt.compiler.defaultModuleResolver;this.modulePathResolver=modulePathResolver||plt.compiler.defaultModulePathResolver;this.currentModulePath=currentModulePath||
defaultCurrentModulePath;this.declaredPermissions=declaredPermissions||[];this.isRedefinition=function(name){return this.env.lookup(name)};this.usedBindings=this.usedBindingsHash.values;this.accumulateDeclaredPermission=function(name,permission){this.declaredPermissions=[[name,permission]].concat(this.declaredPermissions);return this};this.accumulateSharedExpression=function(expression,translation){var labeledTranslation=makeLabeledTranslation(this.gensymCounter,translation);this.sharedExpressions.put(labeledTranslation,
expression);return this};this.accumulateDefinedBinding=function(binding,loc){if(plt.compiler.keywords.indexOf(binding.name)>-1)throwError(new types.Message([new types.ColoredPart(binding.name,binding.loc),": this is a reserved keyword and cannot be used"+" as a variable or function name"]),binding.loc);else if(!this.allowRedefinition&&this.isRedefinition(binding.name)){var prevBinding=this.env.lookup(binding.name);if(prevBinding.loc)throwError(new types.Message([new types.ColoredPart(binding.name,
binding.loc),": this name has a ",new types.ColoredPart("previous definition",prevBinding.loc)," and cannot be re-defined"]),binding.loc);else throwError(new types.Message([new types.ColoredPart(binding.name,binding.loc),": this name has a ","previous definition"," and cannot be re-defined"]),binding.loc)}else{this.env.extend(binding);this.definedNames.put(binding.name,binding);return this}};this.accumulateDefinedBindings=function(bindings,loc){var that=this;bindings.forEach(function(b){that.accumulateDefinedBinding(b,
loc)});return this};this.accumulateModuleBindings=function(bindings){var that=this;bindings.forEach(function(b){that.env.extend(b)});return this};this.accumulateModule=function(module){this.modules=[module].concat(this.modules);return this};this.accumulateBindingUse=function(binding){var alreadyExists=this.usedBindingsHash.get(binding.name);if(!(alreadyExists&&alreadyExists.moduleSource))this.usedBindingsHash.put(binding.name,binding);return this};this.accumulateFreeVariableUse=function(sym){this.freeVariables=
this.freeVariables.indexOf(sym)>-1?this.freeVariables:[sym].concat(this.freeVariables);return this};this.gensym=function(label){return[this,new symbolExpr(label+this.gensymCounter++)]};this.permissions=function(){function onlyUnique(value,index,self){return self.indexOf(value)===index}function reducePermissions(permissions,b){return(b instanceof functionBinding||b instanceof constantBinding)&&b.permissions.length>0?permissions.concat(b.permissions):permissions}return this.usedBindings().reduce(reducePermissions,
[]).filter(onlyUnique)};this.getExposedBindings=function(){var that=this;function lookupProvideBindingInDefinitionBindings(provideBinding){if(!that.definedNames.containsKey(provideBinding.symbl))throwError(new types.Message(["provided-name-not-defined: ",provideBinding.symbl]));var binding=checkBindingCompatibility(binding,that.definedNames.get(provideBinding.symbl));function ref(id){return that.definedNames.get(id)}if(provideBinding instanceof plt.compiler.provideBindingStructId)return[ref(binding.constructor),
ref(binding.predicate)].concat(binding.accessors.map(ref),binding.mutators.map(ref));else return[binding]}function decorateWithPermissions(binding){var bindingEntry=function(entry){return entry[0]===binding.name},filteredPermissions=that.declaredPermissions.filter(bindingEntry);binding.permissions=filteredPermissions.map(function(p){return p[1]});return binding}function checkBindingCompatibility(binding,exportedBinding){if(binding instanceof plt.compiler.provideBindingStructId&&!(exportedBinding instanceof
structBinding))throwError(new types.Message(["provided-structure-not-structure: ",exportedBinding.symbl]));else return exportedBinding}bindings=bindings.reduce(function(acc,b){return acc.concat(lookupProvideBindingInDefinitionBindings(b))},[]);return bindings.map(decorateWithPermissions)};this.toString=function(){var s="pinfo-------------";s+="\n**env****: "+this.env.toString();s+="\n**modules**: "+this.modules.join(",");s+="\n**used bindings**: "+this.usedBindings();s+="\n**free variables**: "+this.freeVariables.join(",");
s+="\n**gensym counter**: "+this.gensymCounter;s+="\n**provided names**: "+this.providedNames.values();s+="\n**defined names**: "+this.definedNames.values();s+="\n**permissions**: "+this.permissions();return s}}function getBasePinfo(language){var baseConstantsEnv=["null","empty","true","false","eof","pi","e","js-undefined","js-null"].reduce(function(env,id){return env.extendConstant(id.toString(),'"moby/toplevel"',false)},new emptyEnv);var pinfo=new plt.compiler.pinfo,topLevelEnv=plt.compiler.topLevelModules.reduceRight(function(env,
mod){return env.extendEnv_moduleBinding(mod)},baseConstantsEnv);if(language==="moby")pinfo.env=topLevelEnv.extendEnv_moduleBinding(mobyModuleBinding);else if(language==="base")pinfo.env=topLevelEnv;return pinfo}plt.compiler.throwError=throwError;plt.compiler.Program=Program;plt.compiler.comment=comment;plt.compiler.couple=couple;plt.compiler.defFunc=defFunc;plt.compiler.defVar=defVar;plt.compiler.defVars=defVars;plt.compiler.defStruct=defStruct;plt.compiler.beginExpr=beginExpr;plt.compiler.lambdaExpr=
lambdaExpr;plt.compiler.localExpr=localExpr;plt.compiler.letrecExpr=letrecExpr;plt.compiler.letExpr=letExpr;plt.compiler.letStarExpr=letStarExpr;plt.compiler.condExpr=condExpr;plt.compiler.caseExpr=caseExpr;plt.compiler.andExpr=andExpr;plt.compiler.orExpr=orExpr;plt.compiler.callExpr=callExpr;plt.compiler.ifExpr=ifExpr;plt.compiler.whenUnlessExpr=whenUnlessExpr;plt.compiler.symbolExpr=symbolExpr;plt.compiler.literal=literal;plt.compiler.quotedExpr=quotedExpr;plt.compiler.unquotedExpr=unquotedExpr;
plt.compiler.quasiquotedExpr=quasiquotedExpr;plt.compiler.unquoteSplice=unquoteSplice;plt.compiler.requireExpr=requireExpr;plt.compiler.provideStatement=provideStatement;plt.compiler.unsupportedExpr=unsupportedExpr;plt.compiler.pinfo=pinfo;plt.compiler.getBasePinfo=getBasePinfo;plt.compiler.isExpression=isExpression;plt.compiler.isDefinition=isDefinition;plt.compiler.env=env;plt.compiler.emptyEnv=emptyEnv;plt.compiler.localEnv=localEnv;plt.compiler.globalEnv=globalEnv;plt.compiler.moduleBinding=moduleBinding;
plt.compiler.functionBinding=functionBinding;plt.compiler.constantBinding=constantBinding;plt.compiler.structBinding=structBinding;plt.compiler.unnamedEnv=unnamedEnv})();goog.provide("plt.compiler.compile");goog.provide("plt.compiler.localStackReference");goog.provide("plt.compiler.globalStackReference");goog.provide("plt.compiler.unboundStackReference");goog.require("plt.compiler.literal");goog.require("plt.compiler.symbolExpr");goog.require("plt.compiler.Program");goog.require("plt.compiler.ifExpr");goog.require("plt.compiler.beginExpr");goog.require("plt.compiler.localExpr");goog.require("plt.compiler.andExpr");goog.require("plt.compiler.orExpr");goog.require("plt.compiler.lambdaExpr");
goog.require("plt.compiler.quotedExpr");goog.require("plt.compiler.callExpr");goog.require("plt.compiler.defFunc");goog.require("plt.compiler.defVar");goog.require("plt.compiler.defVars");goog.require("plt.compiler.defStruct");goog.require("plt.compiler.requireExpr");goog.require("plt.compiler.provideStatement");window.plt=window.plt||{};plt.compiler=plt.compiler||{};
(function(){var literal=plt.compiler.literal;var symbolExpr=plt.compiler.symbolExpr;var Program=plt.compiler.Program;var ifExpr=plt.compiler.ifExpr;var beginExpr=plt.compiler.beginExpr;var localExpr=plt.compiler.localExpr;var andExpr=plt.compiler.andExpr;var orExpr=plt.compiler.orExpr;var lambdaExpr=plt.compiler.lambdaExpr;var quotedExpr=plt.compiler.quotedExpr;var callExpr=plt.compiler.callExpr;var defFunc=plt.compiler.defFunc;var defVar=plt.compiler.defVar;var defVars=plt.compiler.defVars;var defStruct=
plt.compiler.defStruct;var requireExpr=plt.compiler.requireExpr;var provideStatement=plt.compiler.provideStatement;var heir=function(p){var f=function(){};f.prototype=p;return new f};literal.prototype.toBytecode=function(){var str=this.val.toBytecode?this.val.toBytecode():this.val===true?"true":this.val===false?"false":this.toString();return'{"$":"constant","value":'+str+"}"};symbolExpr.prototype.toBytecode=function(){return'types.symbol("'+escapeSym(this.val)+'")'};Vector.prototype.toBytecode=function(){return"types.vector(["+
this.elts.join(",")+"])"};Array.prototype.toBytecode=function(quoted){return"types."+(this.length===0?"EMPTY":"list(["+this.map(convertToBytecode).join(",")+"])")};jsnums.Rational.prototype.toBytecode=function(){return"types.rational("+convertToBytecode(this.n)+", "+convertToBytecode(this.d)+")"};jsnums.BigInteger.prototype.toBytecode=function(){return'types.bignum("'+this.toString()+'")'};jsnums.FloatPoint.prototype.toBytecode=function(){var num=this.toString();if(num==="+nan.0")num="NaN";if(num===
"+inf.0")num="Infinity";if(num==="-inf.0")num="-Infinity";return'types["float"]('+num+")"};jsnums.Complex.prototype.toBytecode=function(){return"types.complex("+convertToBytecode(this.r)+", "+convertToBytecode(this.i)+")"};Char.prototype.toBytecode=function(){return"types['char'](String.fromCharCode("+this.val.charCodeAt(0)+"))"};function stackReference(){}function localStackReference(name,isBoxed,depth){stackReference.call(this);this.name=name;this.isBoxed=isBoxed;this.depth=depth}localStackReference.prototype=
heir(stackReference.prototype);function globalStackReference(name,depth,pos){stackReference.call(this);this.name=name;this.pos=pos;this.depth=depth}globalStackReference.prototype=heir(stackReference.prototype);function unboundStackReference(name){stackReference.call(this);this.name=name}unboundStackReference.prototype=heir(stackReference.prototype);var Bytecode=function(){this.toBytecode=function(){console.log(this);throw"IMPOSSIBLE - generic bytecode toBytecode method was called";}};function convertToBytecode(bc){if(types.isString(bc)&&
bc.chars!==undefined)return'"'+bc.toString()+'"';return bc.toBytecode?bc.toBytecode():bc}function escapeSym(symName){var str=symName.toString().replace(/\|/g,""),bcStr="";var escapes=["{","}","[","]",",","'","`"," ","\\",'"'];for(var j=0;j<str.length;j++)bcStr+=(escapes.indexOf(str.charAt(j))>-1?"\\":"")+str.charAt(j);bcStr=bcStr.replace(/\n/g,"\\n");return bcStr}function globalBucket(name){Bytecode.call(this);this.name=name;this.toBytecode=function(){return'{"$":"global-bucket","value":"'+escapeSym(this.name)+
'"}'}}globalBucket.prototype=heir(Bytecode.prototype);function moduleVariable(modidx,sym,pos,phase){Bytecode.call(this);this.$="module-variable";this.modidx=modidx;this.sym=sym;this.pos=pos;this.phase=phase;this.toBytecode=function(){return'{"$":"module-variable","sym":'+this.sym.toBytecode()+',"modidx":'+this.modidx.toBytecode()+',"pos":'+this.pos+',"phase":'+this.phase+"}"}}moduleVariable.prototype=heir(Bytecode.prototype);function wrap(){Bytecode.call(this)}wrap.prototype=heir(Bytecode.prototype);
function wrapped(datum,wraps,certs){Bytecode.call(this);this.datum=datum;this.wraps=wraps;this.certs=certs}wrapped.prototype=heir(Bytecode.prototype);function stx(encoded){this.encoded=encoded;Bytecode.call(this)}stx.prototype=heir(Bytecode.prototype);function prefix(numLifts,topLevels,stxs){Bytecode.call(this);this.numLifts=numLifts;this.topLevels=topLevels;this.stxs=stxs;this.toBytecode=function(){return'{"$":"prefix","num-lifts":'+this.numLifts+',"toplevels":['+this.topLevels.map(function(v){return convertToBytecode(v)}).join(",")+
'],"stxs":['+this.stxs.map(convertToBytecode)+"]}"}}prefix.prototype=heir(Bytecode.prototype);function form(){Bytecode.call(this)}form.prototype=heir(Bytecode.prototype);function expr(form){Bytecode.call(this)}expr.prototype=heir(Bytecode.prototype);function indirect(v){Bytecode.call(this);this.v=v;this.toBytecode=function(){return'{"$":"indirect","v":'+this.v.toBytecode()+"}"}}indirect.prototype=heir(Bytecode.prototype);function compilationTop(maxLetDepth,prefix,code){Bytecode.call(this);this.maxLetDepth=
maxLetDepth;this.prefix=prefix;this.code=code;this.toBytecode=function(){return'{"$":"compilation-top","max-let-depth":'+this.maxLetDepth+',"prefix":'+this.prefix.toBytecode()+',"compiled-indirects":[],"code":'+this.code.toBytecode()+"}"}}compilationTop.prototype=heir(Bytecode.prototype);function provided(name,src,srcName,nomSrc,srcPhase,isProtected,insp){Bytecode.call(this);this.name=name;this.src=src;this.srcName=srcName;this.nomSrc=nomSrc;this.srcPhase=srcPhase;this.insp=insp;this.isProtected=
isProtected}provided.prototype=heir(Bytecode.prototype);function topLevel(depth,pos,constant,ready,loc){Bytecode.call(this);this.depth=depth;this.pos=pos;this.constant=constant;this.ready=ready;this.loc=loc;this.toBytecode=function(){return'{"$":"toplevel","depth":'+this.depth.toString()+',"pos":'+this.pos.toString()+',"const?":'+this.constant+',"ready?":'+this.ready+',"loc":'+(this.loc&&this.loc.toVector().toBytecode())+"}"}}topLevel.prototype=heir(Bytecode.prototype);function seq(forms){Bytecode.call(this);
this.forms=forms;this.toBytecode=function(){return'{"$":"seq","forms":['+this.forms.map(convertToBytecode).join(",")+"]}"}}seq.prototype=heir(Bytecode.prototype);function defValues(ids,rhs){Bytecode.call(this);this.ids=ids;this.rhs=rhs;this.toBytecode=function(){return'{"$":"def-values","ids":['+this.ids.map(convertToBytecode).join(",")+'],"body":'+this.rhs.toBytecode()+"}"}}defValues.prototype=heir(Bytecode.prototype);function defSyntaxes(ids,rhs,prefix,maxLetDepth){Bytecode.call(this);this.$="def-values";
this.ids=ids;this.rhs=rhs;this.prefix=prefix;this.maxLetDepth=maxLetDepth;this.toBytecode=function(){return'{"$":"def-values","ids":['+this.ids.toBytecode().join(",")+'],"rhs":'+this.rhs.toBytecode()+',"prefix":'+this.prefix.toBytecode()+',"max-let-depth":'+this.maxLetDepth.toBytecode()+"}"}}defSyntaxes.prototype=heir(Bytecode.prototype);function defForSyntax(ids,rhs,prefix,maxLetDepth){Bytecode.call(this);this.ids=ids;this.rhs=rhs;this.prefix=prefix;this.maxLetDepth=maxLetDepth}defForSyntax.prototype=
heir(Bytecode.prototype);function mod(name,selfModidx,prefix,provides,requires,body,syntaxBody,unexported,maxLetDepth,dummy,langInfo,internalContext){Bytecode.call(this);this.name=name;this.selfModidx=selfModidx;this.prefix=prefix;this.provides=provides;this.requires=requires;this.body=body;this.syntaxBody=syntaxBody;this.unexported=unexported;this.maxLetDepth=maxLetDepth;this.dummy=dummy;this.langInfo=langInfo;this.internalContext=internalContext;this.toBytecode=function(){return'{"$":"mod","name":'+
this.name.toBytecode()+',"self-modidx":'+this.selfModidx.toBytecode()+',"prefix":'+this.prefix.toBytecode()+',"provides":'+this.provides.toBytecode()+',"requires":'+(this.requires&&this.requires.toVector().toBytecode())+',"body":'+this.body.toBytecode()+',"stx-body":'+this.syntaxBody.toBytecode()+',"max-let-depth":'+this.maxLetDepth.toBytecode()+"}"}}mod.prototype=heir(Bytecode.prototype);function lam(name,operatorAndRandLocs,flags,numParams,paramTypes,rest,closureMap,closureTypes,maxLetDepth,body){Bytecode.call(this);
this.name=name;this.flags=flags;this.numParams=numParams;this.paramTypes=paramTypes;this.rest=rest;this.body=body;this.closureMap=closureMap;this.maxLetDepth=maxLetDepth;this.closureTypes=closureTypes;this.operatorAndRandLocs=operatorAndRandLocs;this.toBytecode=function(){return'{"$":"lam","name":'+this.name.toBytecode()+',"locs":['+this.operatorAndRandLocs.map(convertToBytecode).join(",")+'],"flags":['+this.flags.map(convertToBytecode).join(",")+'],"num-params":'+this.numParams+',"param-types":['+
this.paramTypes.map(convertToBytecode).join(",")+'],"rest?":'+this.rest+',"closure-map":['+this.closureMap.map(convertToBytecode).join(",")+'],"closure-types":['+this.closureTypes.map(convertToBytecode).join(",")+'],"max-let-depth":'+this.maxLetDepth+',"body":'+this.body.toBytecode()+"}"}}lam.prototype=heir(Bytecode.prototype);function closure(code,genId){Bytecode.call(this);this.code=code;this.genId=genId;this.toBytecode=function(){return'{"$":"closure","code":'+this.code.toBytecode()+',"gen-id":'+
this.genId.toBytecode()+"}"}}closure.prototype=heir(Bytecode.prototype);function caseLam(name,clauses){Bytecode.call(this);this.name=name;this.clauses=clauses;this.toBytecode=function(){return'{"$":"case-lam","name":'+this.name.toBytecode()+',"clauses":'+this.clauses.toBytecode()+"}"}}caseLam.prototype=heir(Bytecode.prototype);function letOne(rhs,body,flonum){Bytecode.call(this);this.rhs=rhs;this.body=body;this.flonum=flonum;this.toBytecode=function(){return'{"$": "let-one","rhs":'+this.rhs.toBytecode()+
',"body":'+this.body.toBytecode()+',"flonum":'+this.flonum.toBytecode()+"}"}}letOne.prototype=heir(Bytecode.prototype);function letVoid(count,boxes,body){Bytecode.call(this);this.count=count;this.boxes=boxes;this.body=body;this.toBytecode=function(){return'{"$":"let-void","count":'+convertToBytecode(this.count)+',"boxes?":'+convertToBytecode(this.boxes)+',"body":'+this.body.toBytecode()+"}"}}letVoid.prototype=heir(Bytecode.prototype);function letRec(procs,body){Bytecode.call(this);this.procs=procs;
this.body=body;this.toBytecode=function(){return'{"$":"let-rec","procs":'+this.procs.toBytecode()+',"body":'+this.body.toBytecode()+"}"}}letRec.prototype=heir(Bytecode.prototype);function installValue(count,pos,boxes,rhs,body){Bytecode.call(this);this.count=count;this.pos=pos;this.boxes=boxes;this.rhs=rhs;this.body=body;this.toBytecode=function(){return'{"$":"install-value","count":'+convertToBytecode(this.count)+',"pos":'+convertToBytecode(this.pos)+',"boxes?":'+convertToBytecode(this.boxes)+',"rhs":'+
this.rhs.toBytecode()+',"body":'+this.body.toBytecode()+"}"}}installValue.prototype=heir(Bytecode.prototype);function boxEnv(pos,body){Bytecode.call(this);this.pos=pos;this.body=body;this.toBytecode=function(){return'{"$":"boxenv","pos":'+this.pos.toBytecode()+',"body":'+this.body.toBytecode()+"}"}}boxEnv.prototype=heir(Bytecode.prototype);function localRef(unbox,pos,clear,otherClears,flonum){Bytecode.call(this);this.unbox=unbox||false;this.pos=pos;this.clear=clear;this.flonum=flonum;this.otherClears=
otherClears;this.toBytecode=function(){return'{"$":"localref","unbox?":'+this.unbox+',"pos":'+this.pos+',"clear":'+this.clear+',"other-clears?":'+this.otherClears+',"flonum?":'+this.flonum+"}"}}localRef.prototype=heir(Bytecode.prototype);function topSyntax(depth,pos,midpt){Bytecode.call(this);this.depth=depth;this.pos=pos;this.midpt=midpt}topSyntax.prototype=heir(Bytecode.prototype);function application(rator,rands){Bytecode.call(this);this.rator=rator;this.rands=rands;this.toBytecode=function(){return'{"$":"application","rator":'+
this.rator.toBytecode()+',"rands":['+this.rands.map(convertToBytecode).join(",")+"]}"}}application.prototype=heir(Bytecode.prototype);function branch(testExpr,thenExpr,elseExpr){Bytecode.call(this);this.testExpr=testExpr;this.thenExpr=thenExpr;this.elseExpr=elseExpr;this.toBytecode=function(){return'{"$":"branch","test":'+this.testExpr.toBytecode()+',"then":'+this.thenExpr.toBytecode()+',"else":'+this.elseExpr.toBytecode()+"}"}}branch.prototype=heir(Bytecode.prototype);function withContMark(key,val,
body){Bytecode.call(this);this.$="with-cont-mark";this.key=key;this.val=val;this.body=body;this.toBytecode=function(){return'{"$":"with-cont-mark","key":'+(new literal(new symbolExpr(this.key))).toBytecode()+',"val":'+(new literal(this.val)).toBytecode()+',"body":'+this.body.toBytecode()+"}"}}withContMark.prototype=heir(Bytecode.prototype);function beg0(seq){Bytecode.call(this);this.seq=seq;this.toBytecode=function(){return'{"$":"beg0","seq":'+this.seq.toBytecode()+"}"}}beg0.prototype=heir(Bytecode.prototype);
function splice(forms){Bytecode.call(this);this.forms=forms;this.toBytecode=function(){return'{"$":"splice","forms":'+this.forms.toBytecode()+"}"}}splice.prototype=heir(Bytecode.prototype);function varRef(topLevel){Bytecode.call(this);this.topLevel=topLevel;this.toBytecode=function(){return'{"$":"varref","top-level":'+this.topLevel.toBytecode()+"}"}}varRef.prototype=heir(Bytecode.prototype);function assign(id,rhs,undefOk){Bytecode.call(this);this.id=id;this.rhs=rhs;this.undefOk=undefOk;this.toBytecode=
function(){return'{"$":"assign","id":'+this.id.toBytecode()+',"rhs":'+this.rhs.toBytecode()+',"undef-ok":'+this.undefOk.toBytecode()+"}"}}assign.prototype=heir(Bytecode.prototype);function applyValues(proc,args){Bytecode.call(this);this.proc=proc;this.args=args;this.toBytecode=function(){return'{"$":"apply-values","proc":'+this.proc.toBytecode()+',"args":'+this.args.toBytecode()+"}"}}applyValues.prototype=heir(Bytecode.prototype);function primVal(id){Bytecode.call(this);this.id=id;this.toBytecode=
function(){return'{"$":"primval","id":'+this.id.toBytecode()+"}"}}primVal.prototype=heir(Bytecode.prototype);function req(reqs,dummy){Bytecode.call(this);this.$="req";this.reqs=reqs;this.dummy=dummy;this.toBytecode=function(){var reqBytecode=this.reqs instanceof literal?'"'+this.reqs.val+'"':this.reqs.toBytecode();return'{"$":"req","reqs":'+reqBytecode+',"dummy":'+this.dummy.toBytecode()+"}"}}req.prototype=heir(Bytecode.prototype);function lexicalRename(bool1,bool2,alist){this.bool1=bool1;this.bool2=
bool2;this.alist=alist;Bytecode.call(this)}lexicalRename.prototype=heir(Bytecode.prototype);function phaseShift(amt,src,dest){this.amt=amt;this.src=src;this.dest=dest;Bytecode.call(this)}phaseShift.prototype=heir(Bytecode.prototype);function wrapMark(val){this.val=val;Bytecode.call(this)}wrapMark.prototype=heir(Bytecode.prototype);function prune(sym){this.sym=sym;Bytecode.call(this)}prune.prototype=heir(Bytecode.prototype);function allFromModule(path,phase,srcPhase,exceptions,prefix){this.path=path;
this.phase=phase;this.srcPhase=srcPhase;this.prefix=prefix;this.exceptions=exceptions;Bytecode.call(this)}allFromModule.prototype=heir(Bytecode.prototype);function nominalPath(){Bytecode.call(this)}nominalPath.prototype=heir(Bytecode.prototype);function simpleNominalPath(value){this.value=value;Bytecode.call(this)}simpleNominalPath.prototype=heir(Bytecode.prototype);function phasedModuleBinding(path,phase,exportName,nominalPath,nominalExportName){this.path=path;this.phase=phase;this.exportName=nominalPath;
this.nominalExportName=nominalExportName;Bytecode.call(this)}phasedModuleBinding.prototype=heir(Bytecode.prototype);function exportedNominalModuleBinding(path,exportName,nominalPath,nominalExportName){this.path=path;this.exportName=exportName;this.nominalPath=nominalPath;this.nominalExportName=nominalExportName;Bytecode.call(this)}exportedNominalModuleBinding.prototype=heir(Bytecode.prototype);function nominalModuleBinding(path,nominalPath){this.path=path;this.nominalPath=nominalPath;Bytecode.call(this)}
nominalModuleBinding.prototype=heir(Bytecode.prototype);function exportedModuleBinding(path,exportName){this.path=path;this.exportName=exportName;Bytecode.call(this)}exportedModuleBinding.prototype=heir(Bytecode.prototype);function simpleModuleBinding(path){this.path=path;Bytecode.call(this)}simpleModuleBinding.prototype=heir(Bytecode.prototype);function ModuleRename(phase,kind,setId,unmarshals,renames,markRenames,plusKern){this.phase=phase;this.kind=kind;this.unmarshals=unmarshals;this.renames=renames;
this.markRenames=markRenames;this.plusKern=plusKern;Bytecode.call(this)}ModuleRename.prototype=heir(Bytecode.prototype);function modulePath(path,base){this.path=path;this.base=base;Bytecode.call(this);this.toBytecode=function(){return'{"$":"module-path","path":'+convertToBytecode(this.path)+',"base":'+convertToBytecode(this.base)+"}"}}modulePath.prototype=heir(Bytecode.prototype);Program.prototype.freeVariables=function(acc,env){return acc};ifExpr.prototype.freeVariables=function(acc,env){return this.alternative.freeVariables(this.consequence.freeVariables(this.predicate.freeVariables(acc,
env),env),env)};beginExpr.prototype.freeVariables=function(acc,env){return this.exprs.reduceRight(function(acc,expr){return expr.freeVariables(acc,env)},acc)};symbolExpr.prototype.freeVariables=function(acc,env){return env.lookup(this.val,0)instanceof unboundStackReference&&acc.indexOf(this)==-1?acc.concat([this]):acc};localExpr.prototype.freeVariables=function(acc,env){var pushLocalBoxedFromSym=function(env,sym){return new plt.compiler.localEnv(sym.val,true,env)},pushLocalFromSym=function(env,sym){return new plt.compiler.localEnv(sym.val,
false,env)};var definedNames=this.defs.reduce(function(names,d){return(d instanceof defVars?d.names:[d.name]).concat(names)},[]),updatedEnv=definedNames.reduce(pushLocalBoxedFromSym,env),freeVarsInBody=this.body.freeVariables(acc,updatedEnv),addFreeVarsInDef=function(acc,d){if(d instanceof defFunc){var envWithArgs=d.args.reduce(function(env,arg){return pushLocalFromSym(env,arg)},updatedEnv);return d.body.freeVariables(acc,envWithArgs)}if(d instanceof defStruct)return acc;else return d.expr.freeVariables(acc,
updatedEnv)};return this.defs.reduce(addFreeVarsInDef,freeVarsInBody)};andExpr.prototype.freeVariables=function(acc,env){return this.exprs.reduceRight(function(acc,expr){return expr.freeVariables(acc,env)},acc)};orExpr.prototype.freeVariables=function(acc,env){return this.exprs.reduceRight(function(acc,expr){return expr.freeVariables(acc,env)},acc)};lambdaExpr.prototype.freeVariables=function(acc,env){var pushLocalFromSym=function(env,sym){return new plt.compiler.localEnv(sym.val,false,env)},envWithArgs=
this.args.slice(0).reverse().reduce(pushLocalFromSym,env);return this.body.freeVariables(acc,envWithArgs)};quotedExpr.prototype.freeVariables=function(acc,env){return acc};callExpr.prototype.freeVariables=function(acc,env){return this.func.freeVariables(acc,env).concat(this.args).reduceRight(function(acc,expr){return expr.freeVariables(acc,env)},acc)};function sortAndUnique(elts,lessThan,equalTo){function unique(elts){return elts.length<=1?elts:equalTo(elts[0],elts[1])?unique(elts.slice(1)):[elts[0]].concat(unique(elts.slice(1)))}
var convertedSortFn=function(x,y){return lessThan(x,y)?-1:lessThan(y,x)};return unique(elts.sort(convertedSortFn))}function compilePrograms(acc,p){var bytecodes=acc[0],pinfo=acc[1],env=acc[2],compiledProgramAndPinfo=p.compile(env,pinfo),compiledProgram=compiledProgramAndPinfo[0],pinfo=compiledProgramAndPinfo[1];return[[compiledProgram].concat(bytecodes),pinfo,env]}Program.prototype.compile=function(env,pinfo){return[this,pinfo]};defFunc.prototype.compile=function(env,pinfo){var compiledFunNameAndPinfo=
this.name.compile(env,pinfo),compiledFunName=compiledFunNameAndPinfo[0],pinfo=compiledFunNameAndPinfo[1];var lambda=new lambdaExpr(this.args,this.body),compiledLambdaAndPinfo=lambda.compile(env,pinfo,false,this.name),compiledLambda=compiledLambdaAndPinfo[0],pinfo=compiledLambdaAndPinfo[1];var bytecode=new defValues([compiledFunName],compiledLambda);return[bytecode,pinfo]};defVar.prototype.compile=function(env,pinfo){var compiledIdAndPinfo=this.name.compile(env,pinfo),compiledId=compiledIdAndPinfo[0],
pinfo=compiledIdAndPinfo[1];var compiledExprAndPinfo=this.expr.compile(env,pinfo),compiledExpr=compiledExprAndPinfo[0],pinfo=compiledExprAndPinfo[1];var bytecode=new defValues([compiledId],compiledExpr);return[bytecode,pinfo]};defVars.prototype.compile=function(env,pinfo){var compiledIdsAndPinfo=this.names.reduceRight(compilePrograms,[[],pinfo,env]),compiledIds=compiledIdsAndPinfo[0],pinfo=compiledIdsAndPinfo[1];var compiledBodyAndPinfo=this.expr.compile(env,pinfo),compiledBody=compiledBodyAndPinfo[0],
pinfo=compiledBodyAndPinfo[1];var bytecode=new defValues(compiledIds,compiledBody);return[bytecode,pinfo]};beginExpr.prototype.compile=function(env,pinfo){var compiledExpressionsAndPinfo=this.exprs.reduceRight(compilePrograms,[[],pinfo,env]),compiledExpressions=compiledExpressionsAndPinfo[0],pinfo1=compiledExpressionsAndPinfo[1];var bytecode=new seq(compiledExpressions);return[bytecode,pinfo1]};lambdaExpr.prototype.compile=function(env,pinfo,isUnnamedLambda,name){if(isUnnamedLambda===undefined)isUnnamedLambda=
true;function maskUnusedGlobals(listOfNames,namesToKeep){return listOfNames.map(function(n){return namesToKeep.indexOf(n)>-1?n:false})}function pushLocal(env,n){return new plt.compiler.localEnv(n,false,env)}function pushLocalBoxed(env,n){return new plt.compiler.localEnv(n,true,env)}function pushGlobals(names,env){return new plt.compiler.globalEnv(names,false,env)}function getClosureVectorAndEnv(args,freeVariables,originalEnv){var freeVariableRefs=freeVariables.map(function(v){return originalEnv.lookup(v.val,
0)}),ormap=function(f,l){return l.length===0?false:f(l[0])?l[0]:ormap(f,l.slice(1))},isLocalStackRef=function(r){return r instanceof localStackReference},isGlobalStackRef=function(r){return r instanceof globalStackReference},isUnboundStackRef=function(r){return r instanceof unboundStackReference},getDepthFromRef=function(r){return r.depth},anyUnboundStackRefs=ormap(isUnboundStackRef,freeVariableRefs);if(anyUnboundStackRefs)throw"Can't produce closure; I don't know where "+anyUnboundStackRefs.name+
" is bound.";else{var lexicalFreeRefs=sortAndUnique(freeVariableRefs.filter(isLocalStackRef),function(x,y){return x.depth<y.depth},function(x,y){return x.depth===y.depth}),lexicalFreeDepths=lexicalFreeRefs.map(getDepthFromRef),globalRefs=freeVariableRefs.filter(isGlobalStackRef),globalDepths=sortAndUnique(globalRefs.map(getDepthFromRef),function(x,y){return x<y},function(x,y){return x===y});var env1=args.reverse().map(function(s){return s.val}).reduce(pushLocal,originalEnv);var env2=lexicalFreeRefs.reverse().reduce(function(env,
ref){return ref.isBoxed?pushLocalBoxed(env,ref.name):pushLocal(env,ref.name)},env1);var env3=globalDepths.reverse().reduce(function(env,depth){var refsAtDepth=globalRefs.filter(function(ref){return ref.depth===depth}),usedGlobals=refsAtDepth.map(function(ref){return ref.name}),newGlobals=maskUnusedGlobals(originalEnv.peek(depth).names,usedGlobals);return pushGlobals(newGlobals,env)},env2);return[globalDepths.concat(lexicalFreeDepths),env3]}}var envWithArgs=this.args.map(function(s){return s.val}).reduce(pushLocal,
new plt.compiler.emptyEnv);freeVarsInBody=this.body.freeVariables([],envWithArgs);var closureVectorAndEnv=getClosureVectorAndEnv(this.args.slice(0),freeVarsInBody,env),closureVector=closureVectorAndEnv[0],extendedEnv=closureVectorAndEnv[1];var compiledBodyAndPinfo=this.body.compile(extendedEnv,pinfo),compiledBody=compiledBodyAndPinfo[0],pinfo1=compiledBodyAndPinfo[1];var getLocs=function(id){return id.location.toVector()},bytecode=new lam(isUnnamedLambda?[]:new symbolExpr(name),[isUnnamedLambda?this.stx:
name].concat(this.args).map(getLocs),[],this.args.length,this.args.map(function(){return new symbolExpr("val")}),false,closureVector,closureVector.map(function(){return new symbolExpr("val/ref")}),0,compiledBody);return[bytecode,pinfo1]};localExpr.prototype.compile=function(env,pinfo){if(this.defs.length===0)return this.body.compile(env,pinfo);var that=this,definedNames=this.defs.reduce(getDefinedNames,[]),pushLocalBoxedFromSym=function(env,sym){return new plt.compiler.localEnv(sym.val,true,env)},
envWithBoxedNames=definedNames.reverse().reduce(pushLocalBoxedFromSym,env);var letVoidBodyAndPinfo=processDefns(this.defs,pinfo,envWithBoxedNames,0),letVoidBody=letVoidBodyAndPinfo[0],pinfo=letVoidBodyAndPinfo[1];return[new letVoid(definedNames.length,true,letVoidBody),pinfo];function getDefinedNames(names,def){return names.concat(def instanceof defVars?def.names:def.name)}function processDefns(defs,pinfo,env,numInstalled){if(defs.length===0)return that.body.compile(envWithBoxedNames,pinfo);var compiledDefAndPInfo=
defs[0].compile(env,pinfo),compiledRhs=compiledDefAndPInfo[0].rhs,pinfo=compiledDefAndPInfo[1];var numToInstall=defs[0]instanceof defVars?defs[0].names.length:1,newBodyAndPinfo=processDefns(defs.slice(1),pinfo,env,numInstalled+numToInstall);newBody=newBodyAndPinfo[0],pinfo=newBodyAndPinfo[1];var bytecode=new installValue(numToInstall,numInstalled,true,compiledRhs,newBody);return[bytecode,pinfo]}};callExpr.prototype.compile=function(env,pinfo){var makeSpace=function(env,operand){return new plt.compiler.unnamedEnv(env)},
extendedEnv=this.args.reduce(makeSpace,env);var compiledOperatorAndPinfo=this.func.compile(extendedEnv,pinfo),compiledOperator=compiledOperatorAndPinfo[0],pinfo1=compiledOperatorAndPinfo[1];var compiledOperandsAndPinfo=this.args.reduceRight(compilePrograms,[[],pinfo,extendedEnv]),compiledOperands=compiledOperandsAndPinfo[0],pinfo2=compiledOperatorAndPinfo[1],app=new application(compiledOperator,compiledOperands);var extractLoc=function(e){return e.location},locs=[this.func.location].concat(this.args.map(extractLoc)),
locVectors=locs.concat(this.location).map(function(loc){return loc.toVector()}),appWithcontMark=new withContMark(new symbolExpr("moby-application-position-key"),locVectors,new withContMark(new symbolExpr("moby-stack-record-continuation-mark-key"),this.location.toVector(),app));return[appWithcontMark,pinfo2]};ifExpr.prototype.compile=function(env,pinfo){var compiledPredicateAndPinfo=this.predicate.compile(env,pinfo),compiledPredicate=compiledPredicateAndPinfo[0],pinfo1=compiledPredicateAndPinfo[1];
var compiledConsequenceAndPinfo=this.consequence.compile(env,pinfo),compiledConsequence=compiledConsequenceAndPinfo[0],pinfo2=compiledConsequenceAndPinfo[1];var compiledAlternateAndPinfo=this.alternative.compile(env,pinfo),compiledAlternate=compiledAlternateAndPinfo[0],pinfo3=compiledAlternateAndPinfo[1];var bytecode=new branch(compiledPredicate,compiledConsequence,compiledAlternate);return[bytecode,pinfo3]};symbolExpr.prototype.compile=function(env,pinfo){var stackReference=env.lookup(this.val,0),
bytecode;if(stackReference instanceof localStackReference)bytecode=new localRef(stackReference.isBoxed,stackReference.depth,false,false,false);else if(stackReference instanceof globalStackReference)bytecode=new topLevel(stackReference.depth,stackReference.pos,false,false,this.location);else if(stackReference instanceof unboundStackReference)throw"Couldn't find '"+this.val+"' in the environment";else throw"IMPOSSIBLE: env.lookup failed for '"+this.val+"'! A reference should be added to the environment!";
return[bytecode,pinfo]};quotedExpr.prototype.compile=function(env,pinfo){function unwrapLiterals(v){return v instanceof literal?unwrapLiterals(v.val):v instanceof Array?v.map(unwrapLiterals):v}result=new literal(unwrapLiterals(this.val));return[result,pinfo]};provideStatement.prototype.compile=function(env,pinfo){};requireExpr.prototype.compile=function(env,pinfo){return[new req(this.spec,new topLevel(0,0,false,false,false)),pinfo]};function compileCompilationTop(program,pinfo){function makeModulePrefixAndEnv(pinfo){var requiredModuleBindings=
pinfo.modules.reduce(function(acc,m){return acc.concat(m.bindings)},[]),isNotRequiredModuleBinding=function(b){return b.moduleSource&&requiredModuleBindings.indexOf(b)===-1},moduleOrTopLevelDefinedBindings=pinfo.usedBindingsHash.values().filter(isNotRequiredModuleBinding),allModuleBindings=requiredModuleBindings.concat(moduleOrTopLevelDefinedBindings),makeGlobalBucket=function(name){return new globalBucket(name)},modulePathIndexJoin=function(path,base){return new modulePath(path,base)},makeModuleVariablefromBinding=
function(b){return new moduleVariable(modulePathIndexJoin(b.moduleSource,b.imported?false:modulePathIndexJoin(false,false)),new symbolExpr(b.name),-1,0)};var globalNames=pinfo.freeVariables.concat(pinfo.definedNames.keys()),uniqueGlobalNames=sortAndUnique(globalNames,function(a,b){return a<b},function(a,b){return a==b}),topLevels=[false].concat(uniqueGlobalNames.map(makeGlobalBucket),allModuleBindings.map(makeModuleVariablefromBinding)),globals=[false].concat(uniqueGlobalNames,allModuleBindings.map(function(b){return b.name}));
return[new prefix(0,topLevels,[]),new plt.compiler.globalEnv(globals,false,new plt.compiler.emptyEnv)]}var toplevelPrefixAndEnv=makeModulePrefixAndEnv(pinfo),toplevelPrefix=toplevelPrefixAndEnv[0],env=toplevelPrefixAndEnv[1];var defns=program.filter(plt.compiler.isDefinition),requires=program.filter(function(p){return p instanceof requireExpr}),exprs=program.filter(plt.compiler.isExpression);var compiledRequiresAndPinfo=requires.reduceRight(compilePrograms,[[],pinfo,env]),compiledRequires=compiledRequiresAndPinfo[0],
pinfo=compiledRequiresAndPinfo[1];var compiledDefinitionsAndPinfo=defns.reduceRight(compilePrograms,[[],pinfo,env]),compiledDefinitions=compiledDefinitionsAndPinfo[0],pinfo=compiledDefinitionsAndPinfo[1];var compiledExpressionsAndPinfo=exprs.reduceRight(compilePrograms,[[],pinfo,env]),compiledExpressions=compiledExpressionsAndPinfo[0],pinfo=compiledExpressionsAndPinfo[1];var forms=new seq([].concat(compiledRequires,compiledDefinitions,compiledExpressions)),zo_bytecode=new compilationTop(0,toplevelPrefix,
forms),response={"bytecode":"/* runtime-version: local-compiler-summer2014 */\n"+zo_bytecode.toBytecode(),"permissions":pinfo.permissions(),"provides":pinfo.providedNames.keys()};return response}plt.compiler.localStackReference=localStackReference;plt.compiler.globalStackReference=globalStackReference;plt.compiler.unboundStackReference=unboundStackReference;plt.compiler.compile=function(program,pinfo,debug){var start=(new Date).getTime();try{var response=compileCompilationTop(program,pinfo)}catch(e){console.log("COMPILATION ERROR");
throw e;}var end=(new Date).getTime();if(debug){console.log("Compiled in "+Math.floor(end-start)+"ms");console.log(JSON.stringify(response))}return response}})();
